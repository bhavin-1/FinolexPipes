'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1010:function(w,D,a){w=a(0);class b{constructor(){this.bge=this.yRc=!1;this.callback=null}neb(e){this.callback=e;this.nsg()}qGf(e){this.yRc||(this.yRc=!0,this.zHg=e,this.nsg())}nsg(){this.yRc&&this.callback&&!this.bge&&(this.bge=!0,this.callback(this.zHg))}}Object(w.a)(b,"CompletionTask",null,[]);a.d(D,"a",function(){return c});class c{constructor(){this.Vpe=new b;this.Tpe=new b}Uxc(e){this.Vpe.neb(e)}Txc(e){this.Tpe.neb(e)}lLb(e){this.Vpe.qGf(e)}kCa(e){this.Tpe.qGf(e)}FId(){this.lLb(2);
this.kCa(2)}}Object(w.a)(c,"MessageStatus",null,[938])},1042:function(w,D,a){a.r(D);a.d(D,"MaxOutstandingThrottler",function(){return f});w=a(0);var b=a(80),c=a(107);D=a(1043);var e=a(1010);class f extends D.a{constructor(d,h=""){super(d,h);this.rdb=this.MFa=0;this.Za=new c.a;this.C0a=!1;this.K2b=this.q_b=this.e_b=this.Z1c=0;this.w5b=[];this.clearTimeout=f.jgd}add(d){this.D0a||this.init(f.xWe,f.nWe);this.RJa++;const h=new e.a;this.cbb?this.LGc(d,h):this.K2b<this.rdb?this.XSb(d,h):(this.LGc(d,h),this.C0a=
!1);return h}XSb(d,h){d=this.$ue(d);const r=this.setTimeout(Object(b.a)(this,this.Vbj,"onMessageWaitTimeExpired"),this.MFa);++this.K2b;Array.add(this.w5b,r);const n=this.e_b;d.Uxc(u=>{h.lLb(u)});d.Txc(u=>{this.e_b===n&&(this.Ubj(n,r),h.kCa(u))})}Ubj(d,h){this.e_b===d&&(--this.K2b,this.clearTimeout(h),Array.remove(this.w5b,h),this.cbb&&this.gOj())}gOj(){this.cbb&&!this.C0a&&(this.Z1c=this.setTimeout(Object(b.a)(this,this.hOj,"sendThrottledMessageFromTimer"),0),this.C0a=!0)}hOj(){this.C0a=!1;if(this.cbb){const d=
this.r5b,h=this.e2a;this.dxb(!1);this.XSb(d,h)}}Vbj(){++this.q_b;this.q_b>Math.floor(this.rdb/2)&&(this.q_b=-1E9,this.Za.raiseEvent("TMUDM"))}Q7b(d){this.Za.addHandler("TMUDM",d)}reset(){this.RJa=this.usb=this.fob=this.q_b=0;++this.e_b;for(const d of this.w5b)this.clearTimeout(d);this.K2b=0;this.w5b=[];this.dxb(!0);this.C0a&&(this.clearTimeout(this.Z1c),this.Z1c=0,this.C0a=!1)}init(d,h){this.D0a||(this.MFa=d,this.rdb=h,this.D0a=!0)}static createInstance(d,h=""){return new f(d,h)}static jgd(d){window.clearTimeout(d)}}
f.xWe=15E3;f.nWe=5;Object(w.a)(f,"MaxOutstandingThrottler",D.a,[935,936])},1043:function(w,D,a){a.d(D,"a",function(){return c});w=a(0);var b=a(15);class c{constructor(e,f=""){this.fob=this.usb=0;this.YVc=!1;this.e2a=this.r5b=null;this.D0a=!1;this.$ue=e;this.Oqg=f;this.setTimeout=c.tgd;this.RJa=this.usb=this.fob=0}fUd(){0<this.RJa&&0<this.fob&&b.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Oqg,this.fob,this.RJa);0<this.RJa&&0<this.usb&&b.ULS.sendTraceTag(36545634,
500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Oqg,this.usb,this.RJa)}get cbb(){return this.YVc}LGc(e,f){this.usb++;this.dxb(!0);this.YVc=!0;this.r5b=e;this.e2a=f}dxb(e){this.YVc=!1;this.e2a&&e&&(this.fob++,this.e2a.FId());this.e2a=this.r5b=null}static tgd(e,f){return window.setTimeout(e,f)}}Object(w.a)(c,"ThrottlerBase",null,[])},1044:function(w,D,a){a.r(D);a.d(D,"MaxRateThrottler",function(){return e});w=a(0);var b=a(80);D=a(1043);var c=a(1010);class e extends D.a{constructor(f,
d=""){super(f,d);this.zdb=0;this.Npb=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(f){this.D0a||(this.zdb=f,this.D0a=!0)}add(f){this.D0a||this.init(e.cWe);this.RJa++;const d=this.currentTime(),h=new c.a;this.Npb>d&&(this.Npb=d);this.cbb?(this.dxb(!0),this.LGc(f,h)):this.Npb+this.zdb<=d?this.XSb(f,h):(this.LGc(f,h),this.setTimeout(Object(b.a)(this,this.fOj,"sendThrottledMessage"),this.Npb+this.zdb-d));return h}fOj(){if(this.cbb){const f=this.r5b,d=this.e2a;this.dxb(!1);this.XSb(f,
d)}}XSb(f,d){this.Npb=this.currentTime();f=this.$ue(f);f.Uxc(h=>{d.lLb(h)});f.Txc(h=>{d.kCa(h)})}static createInstance(f,d=""){return new e(f,d)}}e.cWe=200;Object(w.a)(e,"MaxRateThrottler",D.a,[937,936])},1045:function(w,D,a){a.d(D,"a",function(){return b});w=a(0);class b extends Sys.EventArgs{constructor(c,e,f,d){super();this.type=c;this.fba=e;this.Zyh=f;this.Esa=d}}Object(w.a)(b,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1046:function(w,D,a){a.d(D,"a",function(){return b});w=a(0);class b{}
b.fZd="rr";b.yJj="rd";b.wJj="rbp";b.y_d="sa";Object(w.a)(b,"RtcReconnectParams",null,[])},1047:function(w,D,a){a.d(D,"a",function(){return b});w=a(0);class b{constructor(c,e,f,d){this.$Yi=c;this.MFa=e;this.gYi=f;this.dmi=d}}Object(w.a)(b,"ThrottlerManagerSettings",null,[])},1176:function(w,D,a){w=a(0);class b extends Sys.EventArgs{constructor(F,K){super();this.newState=F;this.oldState=K}}Object(w.a)(b,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class c extends Sys.EventArgs{constructor(F,
K){super();this.lih=F;this.Esa=K}}Object(w.a)(c,"ClientInfoEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(F){super();this.presence=F}}Object(w.a)(e,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(F){super();this.bbd=F}}Object(w.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class d extends Sys.EventArgs{constructor(F,K){super();this.type=F;this.JL=K}}Object(w.a)(d,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var h=a(1247);
class r extends Sys.EventArgs{constructor(F,K=null){super();this.BJ=F;this.QSg=K}get type(){return this.BJ}get fba(){return this.QSg}}Object(w.a)(r,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(){super()}}Object(w.a)(n,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class u extends Sys.EventArgs{constructor(F,K,L,S,W,G){super();this.Ylb=F;this.ycd=K;this.Rlh=L;this.a6e=W;this.Bad=S;this.stopwatch=G}}Object(w.a)(u,"RefreshAllPersistentStateEventArgs",
Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(F){super();this.hubConnection=F}}Object(w.a)(v,"RefreshProxyEventArgs",Sys.EventArgs,[]);class x extends Sys.EventArgs{constructor(F,K){super();this.errorMessage=K}}Object(w.a)(x,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class k extends Sys.EventArgs{constructor(F,K,L){super();this.type=F;this.presence=K;this.Esa=L}}Object(w.a)(k,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var m=a(1045);class t extends Sys.EventArgs{constructor(){super()}}
Object(w.a)(t,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(F){super();this.bbd=F}}Object(w.a)(z,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(F,K){super();this.type=F;this.Zkk=K}}Object(w.a)(y,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var C=a(107);a.d(D,"a",function(){return J});class J{constructor(){this.Za=new C.a}jsj(F,K){this.Za.raiseEvent("CSC",new b(F,K))}btj(F){this.Za.raiseEvent("RP",
new v(F))}mBc(F){this.Za.raiseEvent("RC",F)}dtj(){this.Za.raiseEvent("RMID")}atj(F,K,L,S,W,G){this.Za.raiseEvent("RPS",new u(F,K,L,S,W,G))}s2f(F,K){this.Za.raiseEvent("UPSR",new y(F,K))}b2f(F,K){this.Za.raiseEvent("PU",new h.a(F,K))}Nsj(F){this.Za.raiseEvent("MPU",new e(F))}gTd(F,K,L,S){this.Za.raiseEvent("SUN",new m.a(F,K,L,S))}stj(F,K){this.Za.raiseEvent("UNR",new r(F,K))}k2f(F,K,L){this.Za.raiseEvent("SP",new k(F,K,L))}a2f(F,K){this.Za.raiseEvent("PSU",new d(F,K))}Vsj(F){this.Za.raiseEvent("PSC",
new f(F))}Isj(F){this.Za.raiseEvent("IPSC",new f(F))}ttj(F){this.Za.raiseEvent("UPSC",new z(F))}htj(F,K){this.Za.raiseEvent("SPC",new t(F,K))}h2f(F,K){this.Za.raiseEvent("RCF",new x(F,K))}Bsj(F){this.Za.raiseEvent("CPSWM",new n(F))}rtj(F,K){this.Za.raiseEvent("UCI",new c(F,K))}s6(F){this.Za.addHandler("CSC",F)}baa(F){this.Za.removeHandler("CSC",F)}G0g(F){this.Za.addHandler("RP",F)}F0g(F){this.Za.addHandler("RC",F)}K0g(F){this.Za.addHandler("RMID",F)}E0g(F){this.Za.addHandler("RPS",F)}x1g(F){this.Za.addHandler("UPSR",
F)}b3a(F){this.Za.addHandler("PU",F)}TVa(F){this.Za.removeHandler("PU",F)}n_g(F){this.Za.addHandler("IPU",F)}v1g(F){this.Za.addHandler("UCI",F)}$0g(F){this.Za.addHandler("SUN",F)}o_g(F){this.Za.addHandler("IUNR",F)}d3a(F){this.Za.addHandler("UNR",F)}jRb(F){this.Za.removeHandler("UNR",F)}I7b(F){this.Za.addHandler("PSU",F)}cDc(F){this.Za.removeHandler("PSU",F)}m_g(F){this.Za.addHandler("IPSU",F)}l_g(F){this.Za.addHandler("IPSC",F)}w1g(F){this.Za.addHandler("UPSC",F)}Z0g(F){this.Za.addHandler("SP",F)}b1g(F){this.Za.addHandler("SPC",
F)}static getInstance(){return J.La||(J.La=new J)}}J.La=null;Object(w.a)(J,"RtcEventHub",null,[779])},1181:function(w,D,a){a.r(D);w=a(0);var b=a(15),c=a(80),e=a(200),f=a(934);class d{}d.zdb="throttling_messageDelay";d.uIb="enabled";d.MFa="throttling_timeToWaitForResponse";d.rdb="throttling_maxNumberOfOutstandingMessages";d.Xjf="throttling_globalMaxNumberOfOutstandingMessages";d.errorMessage="errorMessage";d.kmg="url";d.Q$="queryString";d.lF="connectionString";Object(w.a)(d,"RtcFindSessionOutputFieldNameConstants",
null,[]);var h=a(6),r=a(63),n=a(42),u=a(474),v=a(715),x=a(119),k=a(32),m=a(178);class t{constructor(){this.Yjf=this.JGf=this.KGf=this.QGf=0;this.Lrc=!1;this.correlationId=this.lF=this.Q$=this.zcd=this.errorMessage=null}get Tkh(){return this.zcd+"?"+this.Q$}}Object(w.a)(t,"FindSessionResponse",null,[]);class z{}z.clientId="ClientId";z.xlk="UserApp";z.userSessionId="usid";z.userType="UserType";z.Qlk="UserVersion";z.MPb="qs";z.pih="clientProtocol";z.a1i="NoAuth";Object(w.a)(z,"RtcFindSessionInputQueryParamConstants",
null,[]);class y{constructor(T,I,N,R,V,sa){this.pJa=null;const {FindSessionStrategy:U}=a(1181);this.gPg=T;T=String.format("{0}={1}",z.clientId,k.a.Rg(R));T=String.format("{0}&{1}={2}",T,z.userSessionId,k.a.Rg(V));T=String.format("{0}&{1}={2}",T,z.xlk,k.a.Rg(N.toString()));T=String.format("{0}&{1}={2}",T,z.userType,k.a.Rg("1"));T=String.format("{0}&{1}={2}",T,z.Qlk,k.a.Rg(I));T=String.format("{0}&{1}={2}",T,z.pih,k.a.Rg(U.nih));(I=y.$2h(N,sa))&&(T=String.format("{0}&{1}",T,I));this.EHg=T}N4f(){this.pJa=
this.gPg()}Rnd(){this.pJa&&""!==this.pJa||(this.N4f(),b.ULS.sendTraceTag(575784194,500,this.pJa&&""!==this.pJa?50:15,"Query signature delegate called for refresh returned: {0} ",this.pJa));const T=String.format("{0}={1}",z.MPb,k.a.Rg(this.pJa));return String.format("{0}&{1}",T,this.EHg)}static $2h(T,I){return 4===T?String.format("{0}={1}",z.a1i,"1"):I?I.Mki():null}}Object(w.a)(y,"FindSessionQueryStringGenerator",null,[]);var C=a(790),J=a(933),F=a(757),K=a(1047);class L{}L.BWh="FSType";Object(w.a)(L,
"RtcFindSessionRequestHeaders",null,[]);class S{}S.Suj="polling";Object(w.a)(S,"RtcFindSessionTypes",null,[]);var W=a(1046);class G{}G.qnk="RTC-TokenProofkey";G.gNi="RTC-IsWacJsBootFsRequest";Object(w.a)(G,"RtcRequestHeaders",null,[]);a.d(D,"FindSessionStrategy",function(){return O});class O{constructor(T,I,N,R,V,sa,U,ka,ja,Da,qa,Ba,ua=null){this.noe=(new Date(0)).getTime();this.wpe=0;this.m2b=!1;this.eve=null;this.oUd=36E5;this.y_a=O.Qpf;this.rob=0;this.dWa=null;this.yha=0;this.kib=this.PQe=null;
this.LPg=[d.uIb,d.errorMessage,d.kmg,d.lF,d.Q$,d.Xjf,d.rdb,d.MFa,d.zdb];this.KPg=[d.uIb,d.errorMessage];this.lF=this.dTa=null;this.Rje=new y(qa?qa:()=>h.AFrameworkApplication.tk,V,sa,U,T,I);this.Xmb=Ba;this.wj=R;this.Ei=I;this.FJg=N;this.Lm=ka;this.Qi=ja;this.Bob=ua;this.Sje=!1;this.eic=9E4;Da&&Da.execute(pa=>{pa.Ytb(()=>{b.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Lm);this.Rje.N4f()})});2>=100*Math.random()&&(this.oUd=3E5);C.FrequentLoggingMetrics.instance&&
(C.FrequentLoggingMetrics.instance.P9e=this.oUd)}PTj(T){this.kib=T}init(){this.Qi.K0g(Object(c.a)(this,this.MGj,"resetGetMachineIdDelay"));this.Qi.s6(Object(c.a)(this,this.ZY,"onConnectionStateChanged"))}ZY(T,I){this.yha=I.newState;2===I.newState&&(this.rob=0)}bdf(){let T;T=this.dWa.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.dWa.Q$,O.XRe,k.a.Rg(T)),correlationId:T}}Fgi(T,I,N,R,V){this.ANj(()=>{R(V,"GetMachineIdSuccess")&&(b.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",
this.lF,this.Lm),T(this.eve),N(this.xji()))},sa=>{R(V,"GetMachineIdFailure")&&(b.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Lm),I(sa))},R,V)}dCh(){this.bOe();this.Fui()}ANj(T,I,N,R){b.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.lF);if(this.lF)T();else{var V=this.Ych();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(T,I,N,R)},V)}}sendFindSessionRequestToServerInternal(T,
I,N,R){N(R,"RequestMachineId")&&(this.noe=(new Date).getTime(),N=n.a.Kf(),this.cdf(V=>{const sa=n.a.Kf();this.IXf(V);this.e1d();T();V=n.a.Kf()-sa;b.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",V)},V=>{const sa=n.a.Kf();this.bOe();C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.wA(2,3);I(V);V=n.a.Kf()-sa;b.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",V)},!1),N=n.a.Kf()-N,b.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
N))}Fui(){this.y_a+=O.vbi;this.y_a=Math.min(this.y_a,O.TXi)}Ych(){var T=(new Date).getTime();T=this.noe+this.y_a-T;0>T&&(T=0);return T}IXf(T){try{this.dWa=T,this.dTa=T.Tkh,this.lF=T.lF,this.PQe=T.Q$,this.eve=T.zcd}catch(I){b.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",I.toString())}}bOe(){this.lF=null;this.cOe()}e1d(){this.cOe();this.m2b=!0;this.wpe=window.setTimeout(Object(c.a)(this,this.zwj,"refreshMachineId"),this.oUd)}cOe(){this.m2b&&
(window.clearTimeout(this.wpe),this.m2b=!1)}zwj(){this.m2b=!1;this.cdf(T=>{const I=this.PQe!==T.Q$,N=this.lF!==T.lF,R=this.lF;this.IXf(T);0!==this.yha&&(N?(b.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",R||"null",T.lF),this.Qi.mBc()):(this.Qi.htj(I,N),this.e1d()))},()=>{C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.wA(2,3);this.e1d()},!0)}MGj(){this.y_a=O.Qpf}xji(){return new K.a(this.dWa.QGf,this.dWa.KGf,this.dWa.JGf,
this.dWa.Yjf)}dck(T){if(Object.getType(T)!==Object)return null;for(let I in T);return this.Xqh(T)}Xqh(T){if(!(d.uIb in T))return null;const I=T[d.uIb];var N=I?this.LPg:this.KPg;for(const R of N)if(!(R in T))return null;N=Object.assign(new t,{Lrc:T[d.uIb],errorMessage:T[d.errorMessage],correlationId:m.a.create().toString()});I&&(N.zcd=T[d.kmg],N.Q$=T[d.Q$],N.lF=T[d.lF],N.Yjf=T[d.Xjf],N.JGf=T[d.rdb],N.KGf=T[d.MFa],N.QGf=T[d.zdb]);return N}W8h(T,I){b.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");
this.Bob.zWh.continueWith(()=>{this.Bob.zWh.result?(b.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),T(this.Bob.AWh)):(b.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),I(this.Bob.AWh))})}X9f(T,I,N,R,V=!1){return sa=>{J.a.instance.eQb(0,1);T&&T.stop();this.Xmb=this.kib=null;this.MDf(sa.data,!0,I);var U=F.RtcUtils.deserialize(sa.data.Lf,"FindSession",null);if(U)if(U=this.dck(U)){if(U.Lrc&&U.Q$&&U.lF){b.ULS.sendTraceTag(4317446,
500,50,"Successfully retrieved MachineId from server for [{0}]",this.Lm);this.OSi(sa.data);N(U);return}I.FindSessionFailureReason="FindSessionInvalidResponse";I.IsRtcEnabled=U.Lrc;I.IsQueryStringEmpty=!U.Q$;I.IsConnectionStringEmpty=!U.lF;b.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Lm,U.Lrc,!U.Q$,!U.lF)}else I.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",
b.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Lm);else I.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",b.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.Lm);this.i2f(I,V);R(null)}}R9f(T,I,N,R=!1){return V=>{J.a.instance.eQb(0,1);T&&T.stop();this.Xmb=this.kib=null;this.MDf(V.data,!1,I);let sa=null;var U="unknown";let ka="unknown";V.data&&((U=V.data.responseHeaders)&&O.pSb in
U&&(sa=U[O.pSb].toString()),U=v.a[V.data.status],ka=V.data.httpStatus.toString());I.FindSessionFailureReason="FindSessionRequestFailed";I.HttpErrorCode=ka;I.HttpErrorStatus=U;I[O.pSb]=sa;b.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",U,ka,this.Lm,sa,R);this.i2f(I,R);N(ka)}}cdf(T,I,N=!1){let R=null;b.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Lm);const V={};var sa=
this.Rje.Rnd();V[u.a.WJ]=m.a.create().toString();this.kib&&""!==this.kib?sa=String.format("{0}&{1}={2}",sa,W.a.fZd,this.kib):this.Xmb&&""!==this.Xmb&&(sa=String.format("{0}&{1}={2}",sa,W.a.fZd,this.Xmb),V[G.qnk]="True",V[G.gNi]="True");sa=this.FJg+"?"+sa;N&&(V[L.BWh]=S.Suj);const U={};U.IsNetworkOfflineBeforeSendRequest=this.Ei.hbb;U.HasAvailableConnectionsBeforeSendRequest=this.Ei.Ylf;U.MaxConnectionsAllowed=this.Ei.dvc;U.IsRefreshMachineId=N;this.Bob&&!this.Sje?(this.W8h(this.X9f(null,U,T,I,N),
this.R9f(null,U,I,N)),this.Sje=!0):(this.wj&&(R=this.wj.Le("WebServiceCall","GetMachineIdFromTheServer")),C.FrequentLoggingMetrics.instance&&C.FrequentLoggingMetrics.instance.wA(2,0),0>this.Ei.r6(sa,1,null,V,[O.mcc,O.pSb,O.EMb,O.eZd,O.kIf,O.yKf,O.xKf],!1,1,this.X9f(R,U,T,I,N),this.R9f(R,U,I,N),null,null,!1,null,this.eic,"3",null,!0)&&(5<this.rob&&200>this.rob&&b.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",
this.rob),window.setTimeout(()=>{this.rob++;I("-1")},1E3)))}MDf(T,I,N){N||(N={});N.IsNetworkOfflineAfterRequestComplete=this.Ei.hbb;N.IsRequestSucceeded=I;T&&(N.EnqueueTime=T.$fc,N.InvokedTime=T.YH,N.CompletedTime=T.a7,T.responseHeaders&&(O.mcc in T.responseHeaders&&(N.CorrelationId=T.responseHeaders[O.mcc]),O.EMb in T.responseHeaders&&(N[O.EMb]=T.responseHeaders[O.EMb])));b.ULS.sendTraceTag(38633565,500,I?50:15,F.RtcUtils.ceb(N))}i2f(T,I){T||(T={});T.ConnectionState=f.a[this.yha];I||this.Qi.h2f(1,
T)}OSi(T){try{var I=!1,N=!1,R=T.responseHeaders,V=r.a.mK(T.request.get_url());if(R&&O.eZd in R){const Da=R[O.eZd].toString().toLocaleLowerCase();N="true"===Da;I="false"===Da}R=!1;const ja=0<=V.toLocaleLowerCase().indexOf("collab");N&&!ja?R=!0:I&&ja&&(R=!0);if(R){I={};I.HostName=V;I.Status=v.a[T.status];I.HttpStatus=T.httpStatus.toString();var sa=T.request.get_headers();for(let Da in sa){var U=sa[Da];(V=Da)&&0<V.length&&(N=0,U&&(N=U.toString().length),I["r_"+V]=N)}if(T.responseHeaders){const Da=new e.a;
Da.add(O.mcc);Da.add(O.EMb);Da.add(O.pSb);Da.add(O.yKf);Da.add(O.xKf);Da.add(O.kIf);O.qXg(I,T.responseHeaders,Da)}O.cXg(T.request.get_url(),I);var ka=x.a.toJSON(I);b.ULS.sendTraceTag(559437006,500,15,ka)}}catch(ja){b.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",ja.toString())}}static createInstance(T,I,N,R,V,sa,U,ka,ja,Da,qa,Ba=null){return O.Prh(T,I,N,R,V,sa,U,ka,ja,Da,qa,Ba)}static Prh(T,I,N,R,V,sa,U,ka,ja,Da,qa,Ba=null){T=T||m.a.create().toString();T=new O(T,I,N,R,
V,sa,U,ka,ja,Da,null,qa,Ba);T.init();return T}static qXg(T,I,N){for(let R of N)R in I&&(T[R]=I[R])}static cXg(T,I){if(T){var N=T.indexOf("?");if(-1!==N)for(T=T.substr(N+1).split("&"),N=0;N<T.length;++N){var R=T[N].split("=");if(2===R.length){const V=R[0];if(V&&0<V.length){let sa=0;if(R=R[1])sa=R.length;I["q_"+V]=sa}}}}}}O.vbi=3E3;O.TXi=3E5;O.nih="1.0";O.Qpf=1E3;O.mcc="X-CorrelationId";O.XRe="corrid";O.pSb="RtcErrorCode";O.EMb="X-OfficeCluster";O.eZd="X-NewEnv";O.kIf="X-MSEdge-Ref";O.xKf="X-OFFICEFD";
O.yKf="X-OfficeFE";Object(w.a)(O,"FindSessionStrategy",null,[917])},1208:function(w,D,a){a.r(D);w=a(0);var b=a(15),c=a(80),e=a(181),f=a(583),d=a(200);class h{constructor(n){this.messageId=n;this.iOj=(new Date).getTime();this.pFd=new d.a}}Object(w.a)(h,"MessageLatencyDetails",null,[]);a.d(D,"ClientToClientMessageTelemetry",function(){return r});class r{constructor(n,u,v){this.$ba=null;this.LXc=this.v0c=0;this.ig=u;this.Wpe=v;this.Prb=!1;this.Qi=n;this.Qi.d3a(Object(c.a)(this,this.jvj,"receiveMessage"))}start(){if(this.Wpe&&
!this.Prb){const n=this.ig.ubg;this.LXc=this.ig.rbg;n<=this.LXc?(b.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.ig.ubg,this.ig.rbg),this.Wpe=!1):(this.Prb=!0,this.v0c=window.setInterval(Object(c.a)(this,this.sendMessage,"sendMessage"),n))}}sendMessage(){if(this.Prb){const n=f.a.create().toString();this.$ba=new h(n);this.Qi.gTd(16,
n,!1,new e.a);window.setTimeout(()=>{this.NTi(n)},this.LXc)}}NTi(n){this.$ba&&this.$ba.messageId===n&&(0<this.$ba.pFd.count?(n=this.$ba.pFd.toArray().join(","),b.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",n)):b.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.$ba=null)}stop(){this.v0c&&(window.clearInterval(this.v0c),this.Prb=!1)}jvj(n,u){16===u.type?this.Qi.gTd(17,u.fba,!1,new e.a):17===u.type&&this.Prb&&u.fba&&this.cqj(u.fba)}cqj(n){n&&this.$ba&&
n.toString()===this.$ba.messageId&&(n=(new Date).getTime()-this.$ba.iOj,this.$ba.pFd.add(n))}static get instance(){return r.La}static Brd(n,u,v){return r.instance||(r.La=new r(n,u,v))}}r.La=null;Object(w.a)(r,"ClientToClientMessageTelemetry",null,[])},1246:function(w,D,a){a.r(D);a.d(D,"RealtimeChannelMetrics",function(){return d});w=a(0);var b=a(15),c=a(219),e=a(119),f=a(757);class d{constructor(){this.Wqe=this.Xqe=this.Yqe=this.Uqe=this.Tqe=this.Vqe=this.Fqb=this.LYc=0;this.Nba=this.fXc=this.Ppb=
this.aXc=this.pja=this.SWc=this.Pua=this.Jpb=this.L0a=this.RWc=this.v0b=this.X_a=null;this.UXc=this.nqb=this.bve=this.Fge=0;this.Xpe=!1;this.X3f=this.XTd;this.$3f=this.$Td;this.Z3f=this.ZTd;this.d4f=this.bUd;this.c4f=this.aUd;this.gUd=this.hUd;this.fQb=this.eUd;this.sVa=this.cUd;this.tVa=this.dUd;this.Y3f=this.YTd;this.Mdb=this.uKd;this.eMb=this.wKd}XTd(){this.LYc++;this.RWc=new Date;this.X_a||(this.X_a=new Date)}$Td(){this.Fqb++;this.Pua=new Date;this.v0b||(this.v0b=this.Pua);this.Ppb=this.Pua;this.elh()}ZTd(){this.Vqe++;
this.SWc=new Date}bUd(){this.Tqe++;this.L0a=new Date}aUd(){this.Uqe++;this.Jpb=new Date}eUd(){this.pja=new Date;this.Yqe++}dUd(){this.Nba||(this.Nba=new Date);this.Xqe++}cUd(){this.aXc=new Date;this.Wqe++}hUd(){!this.Xpe&&this.LYc&&(b.ULS.sendTraceTag(39321871,500,15,e.a.toJSON(this.sjh())),this.Xpe=!0)}YTd(h){let r,n;({vof:h,xof:r,exception:n}=f.RtcUtils.LTh(h));h&&h!==c.a.zE&&(b.ULS.sendTraceTag(40157596,500,15,e.a.toJSON({["HttpErrorCode"]:h,["HttpErrorStatus"]:r,["Exception"]:n})),c.a.Dsf(h)&&
this.Fge++,c.a.zxf(h)&&this.bve++)}uKd(){this.fXc=new Date}wKd(){this.L0a=this.Ppb=new Date}sjh(){return{["numberOfConnectionAttempts"]:this.LYc,["numberOfSuccessfulConnections"]:this.Fqb,["numberOfFailedConnections"]:this.Vqe,["numberOfDisconnectedConnections"]:this.Tqe,["numberOfExplicitDisconnectedConnections"]:this.Uqe,["numberOfSentMessages"]:this.Yqe,["numberOfReceivedMessages"]:this.Xqe,["numberOfLostMessages"]:this.Wqe,["firstConnectionAttempt"]:this.X_a?this.X_a:null,["firstMessageReceived"]:this.Nba?
this.Nba:null,["firstConnectionSuccess"]:this.v0b?this.v0b:null,["lastConnectionAttempt"]:this.RWc?this.RWc:null,["lastConnectionSuccess"]:this.Pua?this.Pua:null,["lastConnectionFailure"]:this.SWc?this.SWc:null,["lastMessageSent"]:this.pja?this.pja:null,["lastMessageLost"]:this.aXc?this.aXc:null,["lastDisconnect"]:this.L0a?this.L0a:null,["lastExplicitDisconnect"]:this.Jpb?this.Jpb:null,["lastTimeOnline"]:this.Ppb?this.Ppb:null,["lastTimeOffline"]:this.fXc?this.fXc:null,["maxDisconnectedTimeMs"]:this.nqb,
["maxExplicitDisconnectedTimeMs"]:this.UXc,["clientConnectionErrors"]:this.Fge,["serverConnectionErrors"]:this.bve}}elh(){this.X_a&&1===this.Fqb&&(this.nqb=Math.max(this.nqb,this.Pua.getTime()-this.X_a.getTime()));this.L0a&&1<this.Fqb&&(this.nqb=Math.max(this.nqb,this.Pua.getTime()-this.L0a.getTime()));this.Jpb&&1<this.Fqb&&(this.UXc=Math.max(this.UXc,this.Pua.getTime()-this.Jpb.getTime()))}static createInstance(h){d.La||(d.La=new d,b.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",
h));return d.La}}d.La=null;Object(w.a)(d,"RealtimeChannelMetrics",null,[918,94])},1247:function(w,D,a){a.d(D,"a",function(){return b});w=a(0);class b extends Sys.EventArgs{constructor(c,e){super();this.JL=c;this.v7=e}}Object(w.a)(b,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1343:function(w,D,a){a.r(D);var b={};a.r(b);a.d(b,"NamedSheetViewConversionManager",function(){return fb});var c={};a.r(c);a.d(c,"PresenceConverter",function(){return P});var e={};a.r(e);a.d(e,"PresenceTelemetry",function(){return Ea});
var f=a(0),d=a(80);class h{constructor(Oa,Lb){this.sva=null;this.Yqb=Oa;this.JOg=Lb}init(){this.Yqb.continueWith(()=>{this.sva=this.Yqb.result;this.sva.e3a(Object(d.a)(this,this.IQ,"onUsersUpdated"))})}IQ(){h.JGe(this.sva.jza())&&(this.sva.EWd(Object(d.a)(this,this.IQ,"onUsersUpdated")),this.JOg.IsRealCoauthSession=!0)}static JGe(Oa){let Lb=null;for(const Fc of Oa)if(Fc)if(Oa=Fc.isAnonymous||!Fc.email?Fc.clientId:Fc.email.toUpperCase(),!Lb)Lb=Oa;else if(Lb!==Oa)return!0;return!1}}Object(f.a)(h,"CoauthTelemetry",
null,[728]);var r=a(15),n=a(181),u=a(139),v=a(6),x;(function(Oa){Oa[Oa.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";Oa[Oa.notImplemented=1]="notImplemented";Oa[Oa.renderHandled=2]="renderHandled";Oa[Oa.renderHandledWithVeto=3]="renderHandledWithVeto"})(x||(x={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",x);var k=a(105),m=a(119),t=a(62);class z{constructor(Oa,Lb,Fc,Wc,td,na,Pa,lb,Nb){this.hse=this.Pge=this.Iz=null;this.SZa=Oa;this.V4b=new n.a;this.Pa=Fc;this.kRc=Lb;this.Ita=Wc;
this.Oi=td;this.FZc=na;this.nva=Pa;this.KFg=lb;this.Uke=this.Rke=!1;this.u5b=0;this.Nge=1;this.nHa=Nb;this.Yxe=this.Pa.qa("PeoplesWellExtraButtonInfoIsEnabled");this.Hta=Object(u.a)(String,v.AFrameworkApplication.fe.Application)||""}get Nng(){return this.V4b.task}init(){t.Task.WAA.call(null,this.nva,this.kRc,this.FZc).continueWith(()=>{this.Iz=this.nva.result;this.Pge=this.kRc.result;this.hse=this.FZc.result;t.Task.WAA.call(null,this.kRc.result.ubd,this.FZc.result.AKc).continueWith(()=>{this.Nge=
this.Pge.ubd.result;this.u5b=this.hse.AKc.result;this.Iz.e3a(Object(d.a)(this,this.Syc,"onUsersUpdatedEventListener"));this.Iz.jza().length&&this.IQ()})})}Syc(){this.IQ()}IQ(){this.KFg(this.Iz.jza())?(this.Iz.EWd(Object(d.a)(this,this.Syc,"onUsersUpdatedEventListener")),this.t8i(this.Rke)):this.V4b.iy(1);this.Rke=!0}t8i(Oa){this.Uke?this.Nng.continueWith(()=>{r.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",x[this.Nng.result])}):(this.Uke=!0,this.tqj(0===
this.Nge&&!Oa))}tqj(Oa){Oa?this.Ita.$j(4,Object(d.a)(this,this.yNd,"onInteractiveReady")):this.V4b.iy(1)}yNd(){const Oa=this.Oi.PB("AppInitStatus_interactivityReady");r.ULS.shipAssertTag(42259235,325,!!this.u5b);const Lb=this.u5b-Oa,Fc={};Fc.InteractiveTime=Oa;Fc.ReactRenderComplete=this.u5b;Fc.HadTabSwitch=this.nHa();Fc.IsModernGallery=this.Yxe;r.ULS.sendTraceTag(594883104,325,50,m.a.toJSON(Fc));this.Yxe?(r.ULS.sendTraceTag(42062997,325,15,Lb.toString()),this.V4b.iy(this.Hbe(Lb)?3:2)):r.ULS.sendTraceTag(594883103,
325,15,Lb.toString())}Hbe(Oa){const Lb=Oa>this.Pa.Af("CoauthorGalleryTimeToRenderDurationMs",1E4);var Fc="Word"===this.Hta;const Wc="PowerPoint"===this.Hta;if(this.nHa())return r.ULS.sendTraceTag(50455714,325,50,Lb.toString()),!1;Fc&&k.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Lb&&(Fc&&k.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),Fc=v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientCoauthorGalleryRenderLatencyQoSError"),
Wc&&Fc&&k.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),r.ULS.sendTraceTag(42062998,325,15,Oa.toString()));return Lb}}Object(f.a)(z,"CoauthorGalleryTelemetry",null,[727]);class y{constructor(Oa){this.Iz=null;this.$Zb={};this.i3b={};this.gpb=null;this.nva=Oa}glc(Oa){const Lb=new n.a;this.init().continueWith(()=>{Oa in this.$Zb?Lb.iy(this.$Zb[Oa]):this.i3b[Oa]=Lb});return Lb.task}init(){if(this.gpb)return this.gpb.task;
this.gpb=new n.a;this.nva.continueWith(()=>{this.Iz=this.nva.result;this.Iz.e3a(Object(d.a)(this,this.IQ,"onUsersUpdated"));this.Hwg();this.gpb.setResult(null)});return this.gpb.task}Hwg(){const Oa=this.Iz.jza();Oa.sort(Object(d.a)(this,this.Kkh,"comparePresenceUsers"));this.$Zb={};for(let Lb=0;Lb<Oa.length&&Oa[Lb]&&Oa[Lb].hpa;Lb++)this.ZWg(this.$Zb,Oa[Lb].clientId,Lb)}ZWg(Oa,Lb,Fc){Oa[Lb]=Fc;Lb in this.i3b&&(this.i3b[Lb].iy(Fc),delete this.i3b[Lb])}IQ(){this.Hwg()}Kkh(Oa,Lb){return Oa.hpa>Lb.hpa?
1:Oa.hpa<Lb.hpa?-1:0}}Object(f.a)(y,"CoauthorPositionFinder",null,[726]);var C=a(662),J=a(565),F=a(713),K=a(200),L=a(178);class S{constructor(){this.nka=null;this.Qmb=Array(32)}xor(Oa){if(!Oa)throw Error.argumentNull("Guid argument cannot be null");const Lb=new S,Fc=new Sys.StringBuilder;for(let Wc=0;Wc<Oa.Qmb.length;Wc++){const td=this.Qmb[Wc]^Oa.Qmb[Wc];Lb.Qmb[Wc]=td;Fc.append(td.toString(16));7!==Wc&&11!==Wc&&15!==Wc&&19!==Wc||Fc.append("-")}Lb.nka=L.a.Qda(Fc.toString());return Lb}toString(){return this.nka.toString()}equals(Oa){if(!Oa)throw Error.argumentNull("Guid argument cannot be null");
return this.nka.equals(Oa.nka)}static Fnd(Oa){if(!Oa)throw Error.argumentNull("String input cannot be null");const Lb=new S;Lb.nka=L.a.Qda(Oa);const Fc=Lb.nka.toString();let Wc=0;for(let na=0;na<Fc.length;na++){var td=Oa.charAt(na);if(S.eGi(td))td=S.esi(td,Oa.charCodeAt(na)),Lb.Qmb[Wc++]=td;else if(!S.zFi(td))throw Error.argument("String contains characters not valid in Guids");}return Lb}static eGi(Oa){return"0"<=Oa&&"9">=Oa||"A"<=Oa&&"F">=Oa||"a"<=Oa&&"f">=Oa}static zFi(Oa){return"{"===Oa||"}"===
Oa||"-"===Oa}static esi(Oa,Lb){if("0"<=Oa&&"9">=Oa)return Lb-48;if("A"<=Oa&&"F">=Oa)return Lb-65+10;if("a"<=Oa&&"f">=Oa)return Lb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(f.a)(S,"Guid",null,[]);class W{constructor(Oa,Lb,Fc,Wc){this.sva=null;this.Whe=this.pqe=!1;this.Loe=0;this.Yqb=Oa;this.H1c=Lb;this.Pa=Fc;this.c1a=Wc;this.uFg=v.AFrameworkApplication.userNameUnknown||v.AFrameworkApplication.limitedEdit;this.npe=new C.a(J.a.Qh())}get tfd(){return this.Pa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",
!1)}init(){this.Yqb.continueWith(()=>{this.sva=this.Yqb.result;this.sva.e3a(Object(d.a)(this,this.IQ,"onUsersUpdated"))})}IQ(){this.qjh(this.sva.jza())}qjh(Oa){var Lb=0;const Fc=new F.a(J.a.Qh());for(const Wc of Oa)if(Wc&&Wc.isAnonymous){v.AFrameworkApplication.lU("70eb6120;2gfeb930");if(Fc.Wc(Wc.userName))Fc.ma(Wc.userName).add(Wc.clientId);else{let td;Fc.add(Wc.userName,(td=new K.a,td.add(Wc.clientId),td))}Wc.clientId!==this.c1a?(Lb++,2<=Lb&&!this.pqe&&this.QTi()):!this.Whe&&this.tfd&&"Guest"===
Wc.userName&&(r.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.Whe=!0)}if(this.tfd&&this.Loe!==Lb){r.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Lb+(this.uFg?1:0));this.Loe=Lb;for(let Wc of Fc.keys)2<=Fc.ma(Wc).count&&(Oa=this.J7h(Fc.ma(Wc)),this.npe.contains(Oa)||(Lb={},Lb.guestsWithSameName=Fc.ma(Wc).count,Lb.identifier=Oa,r.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Lb),this.npe.add(Oa)))}}QTi(){r.ULS.sendTraceTag(525112603,
302,50,"Multiple guests simultaneously coauthoring");this.pqe=!0;this.tfd&&this.H1c&&this.H1c.continueWith(()=>{window.setTimeout(()=>{this.H1c.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}J7h(Oa){if(!Oa||1>=Oa.count)return"";let Lb=S.Fnd(Oa.ma(0));for(let Fc=1;Fc<Oa.count;Fc++)Lb=Lb.xor(S.Fnd(Oa.ma(Fc)));return Lb.toString()}}Object(f.a)(W,"GuestCoauthTelemetry",null,[]);var G=a(564);class O{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=
!1}}Object(f.a)(O,"PL",null,[]);var T=a(43);class I{constructor(){this.ct=this.vt=this.d=0}static ueg(Oa,Lb,Fc){const Wc=new I;Wc.d=Oa;Wc.vt=Lb;Wc.ct=Fc;return T.c(Wc)}}Object(f.a)(I,"VD",null,[]);var N=a(177);class R{constructor(Oa,Lb,Fc,Wc,td,na,Pa,lb,Nb,xc,Oc){this.jve=!1;this._id=Oa;this.Zq=Lb;this.ewe=Fc;this.yO=Wc;this.vYc=td;this.Y1c=na;this.aKa=Pa;this.KHa=lb;this.$Gg=Nb;this.nHa=xc;this.Gxe=Oc;this.Hta=Object(u.a)(String,v.AFrameworkApplication.fe.Application)||""}veto(Oa){const Lb=[this.vYc,
this.Y1c];this.Gxe&&Lb.push(this.ewe);t.Task.WAA.apply(null,Lb).continueWith(()=>{if(this.vYc.result<=this.Y1c.result)Oa.iy(!1);else{this.Gxe&&(this.Zq=this.ewe.result);var Fc=this.yO-this.Zq,Wc=new O;Wc.id=this._id;Wc.et=this.yO;Wc.st=this.Zq;Wc.d=this.yO-this.Zq;Wc.mp=this.vYc.result;Wc.tp=this.Y1c.result;Wc.ct=this.a5h(this.$Gg);Wc.vc=this.nHa();var td=T.c(Wc),na="Word"===this.Hta,Pa="PowerPoint"===this.Hta;r.ULS.sendTraceTag(42078597,302,15,td);if(na){const lb=new Map;lb.set("data",td);k.Health.instance.recordKpiUsage("PresenceExperienceDegraded",
0,"wordcollabrel",lb)}Fc>this.aKa.value&&!this.jve&&!Wc.vc&&(this.jve=!0,Oa.iy(!0),Wc=Object.assign(new N.a,{inStaging:!0,extendedProperties:new Map}),Wc.extendedProperties.set("data",td),na&&k.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Wc),Fc<this.KHa.value&&(r.ULS.sendTraceTag(42078598,302,15,I.ueg(Fc,this.aKa.value,this.KHa.value)),Fc=v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.PPTClientThumbnailPresenceRenderLatencyQoSError"),
Pa&&Fc&&(Wc.inStaging=!1,k.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!0,!1,Wc))));Oa.task.isCompleted||Oa.iy(!1)}})}a5h(Oa){switch(Oa){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(R,"PresenceLatencyActivityLogger",null,[]);class V{constructor(Oa,Lb,Fc){this.lge=this.Mge=this.QZb=this.ZZb=this.WZa=0;this._id=Oa;this.aKa=Lb;this.KHa=Fc;this.Hta=Object(u.a)(String,v.AFrameworkApplication.fe.Application)||
""}get VDe(){return this.WZa}set VDe(Oa){this.WZa=Oa;this.cad()}get $Oe(){return this.ZZb}set $Oe(Oa){this.ZZb=Oa;this.cad()}get eMe(){return this.QZb}set eMe(Oa){this.QZb=Oa;this.cad()}get aPe(){return 0!==this.Mge}get fMe(){return 0!==this.lge}cad(){!this.aPe&&this.WZa&&this.ZZb&&(this.Mge=this.veto(this.ZZb,"CoauthGalleryLightupDurationTooLong"));!this.fMe&&this.WZa&&this.QZb&&(this.lge=this.veto(this.QZb,"CanvasPresenceLightupDurationTooLong"))}veto(Oa,Lb){const Fc=Oa-this.WZa;var Wc=new O;Wc.id=
this._id;Wc.et=Oa;Wc.st=this.WZa;Wc.d=Fc;var td=T.c(Wc);Oa="Word"===this.Hta;Wc="CanvasPresenceLightupDurationTooLong"===Lb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===Lb?r.ULS.sendTraceTag(572289499,302,15,td):r.ULS.sendTraceTag(571524118,302,15,td);if(Oa){var na=new Map;na.set("data",td);k.Health.instance.recordKpiUsage(Wc,0,"wordcollabrel",na)}return Fc>this.aKa.value?(na=Object.assign(new N.a,{inStaging:!0,extendedProperties:new Map}),
na.extendedProperties.set("data",td),td=Fc<this.KHa.value,na.extendedProperties.set("cash",td?"true":"false"),Oa&&k.Health.instance.recordKpiFailure(Wc,Lb,!1,!0,na),r.ULS.sendTraceTag(572289500,302,15,I.ueg(Fc,this.aKa.value,this.KHa.value)),td?2:1):3}}Object(f.a)(V,"PresenceLightupLatencyLogger",null,[]);var sa=a(55),U=a(331);class ka{constructor(Oa,Lb,Fc,Wc,td,na,Pa,lb=null,Nb=null,xc=null){this.Zse={};this.jRc={};this.Pne=new K.a;this.CZb=this.hpb=this.Iz=this.Drb=null;this.m1c=this.l1c=0;this.aKa=
new G.a(()=>lb.eY("PresenceBootLatencyThreshold",1E4));this.KHa=new G.a(()=>lb.eY("PresenceBootLatencyCutoffThreshold",6E4));this.oTg=new G.a(()=>lb.eY("PresenceLightupLatencyThreshold",2E3));this.dIg=new G.a(()=>lb.eY("PresenceLightupLatencyCutoffThreshold",1E4));this.Ita=Wc;this.Pa=lb;this.MOg=td;this.Oge=Oa;this.tue=Lb;this.nva=Fc;this.Oi=na;this.c1a=Nb;this.nHa=Pa;this.Xke=xc;this.kQc=!1;this.init()}sGh(Oa,Lb,Fc=null){Fc&&(r.ULS.shipAssertTag(42274970,302,!this.c1a||this.c1a===Fc,"_myClientId is already set and you are trying to update it to something different"),
this.c1a=Fc);const Wc=new n.a;this.init().continueWith(()=>{this.idj(Oa);this.tGh(Wc,Oa,Lb)})}get ZJd(){return this.c1a||"{"+v.AFrameworkApplication.userSessionId+"}"}init(){if(this.hpb)return this.hpb.task;this.hpb=new n.a;this.nHa()&&r.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.Oge.continueWith(()=>{const Oa=this.Oge.result,Lb=Oa.ubd,Fc=Oa.$Zi;Fc.continueWith(()=>{Lb.continueWith(()=>{this.Xke&&this.Xke.addQosPillar("RealTimeCoauth");this.P5j(Lb.result,Fc.result);this.hpb.setResult(null)})})});
this.tue.continueWith(()=>{this.Drb=this.tue.result;this.Drb.s6(Object(d.a)(this,this.pej,"onRtcConnection"));this.Drb.d3a(Object(d.a)(this,this.$5i,"onCoauthorBootReceived"))});this.nva.continueWith(()=>{this.Iz=this.nva.result;this.Iz.e3a(Object(d.a)(this,this.Syc,"onUsersUpdatedEventListener"));0<this.Iz.jza().length&&this.IQ()});return this.hpb.task}xbf(){return this.Oi.c7(sa.a.lZa)?this.Oi.PB(sa.a.lZa):U.a.DS?window.performance.timing.fetchStart:-1}pef(){this.CZb||(this.CZb=new n.a,this.Ita.$j(4,
()=>{this.CZb.iy(this.Oi.PB("AppInitStatus_interactivityReady"))}));return this.CZb.task}pej(Oa,Lb){if(!this.kQc&&2===Lb.newState)if(this.RMc){const Fc=this.pef();Fc.continueWith(()=>{const Wc=Date.now()-Fc.result,td={};td.clientId=this.ZJd;td.bootTime=Wc;this.kQc=!0;this.Drb.xaa(15,td)})}else Oa=Date.now()-this.xbf(),Lb={},Lb.clientId=this.ZJd,Lb.bootTime=Oa,this.kQc=!0,this.Drb.xaa(15,Lb)}$5i(Oa,Lb){if(15===Lb.type){Oa=Date.now();Lb=Lb.fba;var Fc=Lb.bootTime;this.Zqd(Lb.clientId).VDe=Oa-Fc}}Syc(){this.IQ()}IQ(){const Oa=
Date.now();var Lb=this.Iz.jza();const Fc=new K.a;for(const Wc of Lb)this.Pne.contains(Wc.clientId)||(this.Pne.add(Wc.clientId),Fc.add(Wc.clientId));if(0<Fc.count)for(let Wc of Fc)Lb=this.Zqd(Wc),Lb.aPe||(Lb.$Oe=Oa)}idj(Oa){Oa=this.Zqd(Oa);Oa.fMe||(Oa.eMe=Date.now())}Zqd(Oa){return Oa in this.jRc?this.jRc[Oa]:this.jRc[Oa]=new V(Oa,this.oTg,this.dIg)}P5j(Oa,Lb=0){this.l1c=Oa;this.m1c=Lb?Lb:(new Date).getTime()}tGh(Oa,Lb,Fc){Fc=Fc?Fc.getTime():(new Date).getTime();if(Lb in this.Zse)Oa.LC();else{const Wc=
this.RMc?0:this.qii(),td=this.RMc?this.rii():null;Fc=new R(Lb,Wc,td,Fc,this.glc(this.ZJd),this.glc(Lb),this.aKa,this.KHa,0,this.nHa,this.RMc);this.Zse[Lb]=Fc;Fc.veto(Oa)}}qii(){return 1===this.l1c?this.m1c:this.xbf()}rii(){return 1===this.l1c?t.Task.Wa(this.m1c):this.pef()}glc(Oa){return this.MOg.glc(Oa)}get RMc(){return this.Pa.qa("UseAppInteractiveBootTimeForPresenceTelemetry")}}Object(f.a)(ka,"PresenceBootTelemetry",null,[646]);var ja=a(144),Da=a(261),qa=a(176),Ba=a(84),ua=a(530);class pa{get name(){return"Common.App.CoauthTelemetry"}Oj(Oa){Oa.register(h,
"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").se().Ae(()=>new h(ua.a.Tq(Oa.Ed("Common.IPeopleInfoProvider")),v.AFrameworkApplication.Jg));Oa.register(z,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").se().Ae(()=>new z(v.AFrameworkApplication.jd,ua.a.Tq(Oa.Ed("Common.ICoauthoringTelemeryInfoProvider")),v.AFrameworkApplication.fa,ja.a.get_instance(),qa.a.instance,ua.a.Tq(Oa.Ed("Common.IPeoplesWell")),ua.a.Tq(Oa.Ed("Common.IPeopleInfoProvider")),
h.JGe,()=>this.yJe()));Oa.register(ka,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").se().Ae(()=>new ka(ua.a.Tq(Oa.Ed("Common.ICoauthoringTelemeryInfoProvider")),ua.a.Tq(Oa.Ed("Common.IRealtimeChannelBasic")),ua.a.Tq(Oa.Ed("Common.IPeopleInfoProvider")),ja.a.get_instance(),Oa.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),qa.a.instance,()=>this.yJe(),v.AFrameworkApplication.fa,null,k.Health.instance));Oa.register(y,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").se().Ae(()=>
new y(ua.a.Tq(Oa.Ed("Common.IPeopleInfoProvider"))));Oa.register(W,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").se().Ae(()=>new W(ua.a.Tq(Oa.Ed("Common.IPeopleInfoProvider")),ua.a.Tq(Oa.Ed("Common.ISystemInitiatedFeedback")),v.AFrameworkApplication.fa,"{"+v.AFrameworkApplication.userSessionId+"}"))}init(){v.AFrameworkApplication.fa.Xw(()=>{Ba.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Ba.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();
v.AFrameworkApplication.fa.qa("CoauthorGalleryTelemetryIsEnabled")&&Ba.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();v.AFrameworkApplication.fa.qa("CashTelemetryIsEnabled")&&(Ba.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Ba.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}yJe(){return U.a.DS&&qa.a.instance.c7(sa.a.QXb)?0<qa.a.instance.PB(sa.a.QXb)[sa.a.qzg]:!1}static main(){Da.a.instance.Mk(new pa)}}Object(f.a)(pa,
"CoauthTelemetryPackage",null,[3,4]);var Ka=a(733),$a=a(39);class ha{}Object(f.a)(ha,"NamedSheetViewConversionEntry",null,[]);var cb=a(9),Ia=a(126),ob=a(35),gb=a(1),Za=a(65);const da=(Oa,Lb,Fc,Wc,td,na=null)=>{na=Oa.Ra(1,na);return Za.g(Oa,"GetNamedSheetViewConversion",na,Lb,Fc,Wc,td,132)};var ya=a(46),ib=a(24);const vb=(Oa,Lb)=>!!Oa&&!!Lb&&Oa.SheetName===Lb.SheetName&&(!!Oa.NamedObjectName&&Oa.NamedObjectName===Lb.NamedObjectName||!Oa.NamedObjectName&&!Lb.NamedObjectName&&ya.E(Oa).Te(ya.E(Lb))),
eb=(Oa,Lb,Fc)=>{if(!Lb||!Lb.Gd)return null;for(let Wc=0;Wc<Lb.Gd.count;Wc++){const td=Lb.Gd.getItem(Wc);if(td&&td.type===Fc&&td.usedRange&&td.usedRange.contains(ya.E(Oa))&&ib.a.equals(td.sheetName,Oa.SheetName,!0))return td}return null};var Ta=a(19),La=a(151);let fb=class extends $a.a{constructor(Oa){super();this.P5a=this.wxa=null;this.WNc=this.fya=!1;this.vh=()=>{const Lb=this.$.da.fp;if(null===Lb||void 0===Lb?0:Lb.SheetChanges)for(const Fc of Lb.SheetChanges)if(2===Fc.Type){if(this.wxa)for(const Wc of this.wxa)Wc.Range.SheetName===
Fc.Name&&(Wc.Range.SheetName=Fc.NewName);if(this.P5a)for(const Wc of this.P5a)Wc.Range.SheetName===Fc.Name&&(Wc.Range.SheetName=Fc.NewName)}};this.RPf=()=>{r.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.WNc=!1;this.$wc(this,Sys.EventArgs.Empty)};this.oe=()=>{r.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.WNc=!0};this.$wc=()=>{r.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.da.yCa}]`);
if(!this.$.isEditMode||!this.$.da.Zd||this.$.da.g$a||this.WNc||this.$.da.yCa===cb.a.Ydc)r.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.da.Zd}] [HasRaisedSessionEnded: ${this.$.da.g$a}] [WorkbookClosed: ${this.WNc}]`);else{this.P5a=this.wxa=null;var Lb=this.$.pa.ua.Ud();da(this.$.pa.ua,this.Z9i,this.Y9i,null,Lb)}};this.Z9i=Lb=>{if(ob.a.Jr(Lb.Errors)){this.fya=!0;const Fc=[-1100324317,
-1857233882];ob.a.aj(Lb.Errors,Fc)&&r.ULS.sendTraceTag(537154392,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${ob.a.me(Lb.Errors)}]`);Lb=ob.a.hE(Lb.Errors,Fc,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.da.Pq(Lb)}else this.fya=!1,Lb=Lb.Result,this.$.da.yCa=Lb.ConversionVersion,this.Tpj(Lb.NamedSheetViewConversionEntries),this.lsj()};this.Y9i=Lb=>{this.fya=!0;Lb=Ia.a.Bg(Lb.data);let Fc=!1;gb.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&
Lb.forEach(Wc=>{-1537615947===Wc.MessageId&&(Fc=!0)});Fc?r.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ob.a.me(Lb)}].`):r.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${ob.a.me(Lb)}].`)};this.$=Oa;r.ULS.shipAssertTag(537154397,0,!!this.$.da,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.sk(this.oe);this.$.da.B0(this.RPf);
this.$.da.T_g(this.$wc);this.$.da.zw(this.vh);this.$.da.Rx&&this.$wc(this,Sys.EventArgs.Empty)}ECe(Oa){this.addHandler("SVCU",Oa)}O7f(Oa){this.removeHandler("SVCU",Oa)}dispose(){this.P5a=this.wxa=null;this.$&&this.$.Ym(this.oe);this.$.da&&(this.$.da.Y3(this.RPf),this.$.da.GCj(this.$wc),this.$.da.Zx(this.vh));this.$=null;super.dispose()}ynh(Oa){return this.fya?null:this.ARe(Oa,this.P5a,"ConvertPresencePublicToPrivate")}xnh(Oa){return this.fya?null:this.ARe(Oa,this.wxa,"ConvertPresencePrivateToPublic")}Tpj(Oa){Oa?
(this.sxh(Oa),this.wxa=Oa,this.P5a=this.Rrh(this.wxa)):r.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}lsj(){r.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");this.raiseEvent("SVCU")}ARe(Oa,Lb,Fc){if(!Lb||!Lb.length)return r.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${Fc}: skipping convert due to ${Lb?
"empty":"null"} ConversionEntries. `),Oa;for(const Wc of Oa){for(const td of Lb)!td.IsRow||!vb(td.Range,Wc)||Wc.FirstRow<=td.Range.FirstRow&&Wc.LastRow>=td.Range.LastRow||(Fc={},Fc.SheetName=Wc.SheetName,Fc.FirstRow=Fc.LastRow=Wc.FirstRow,Fc.FirstColumn=Fc.LastColumn=Wc.FirstColumn,vb(td.Range,Fc)?(Fc=Wc.FirstRow-td.Range.FirstRow,0>Fc||Fc>=td.ConversionMap.length?r.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${Fc}], ConversionMap.Length: ${td.ConversionMap.length}`):
(Fc=td.ConversionMap[Fc]-Fc,Wc.FirstRow+=Fc,Wc.LastRow=Wc.FirstRow,Wc.LastColumn=Math.min(Wc.LastColumn,td.Range.LastColumn))):Wc.FirstRow<td.Range.FirstRow&&Wc.LastRow>=td.Range.FirstRow?Wc.LastRow=td.Range.FirstRow-1:Wc.LastColumn>=td.Range.FirstColumn&&(Wc.LastColumn=td.Range.FirstColumn-1));if(0>Wc.FirstRow||Wc.FirstRow>cb.a.GA)Wc.FirstRow=Math.max(Math.min(Wc.FirstRow,cb.a.GA),0);if(0>Wc.LastRow||Wc.LastRow>cb.a.GA)Wc.LastRow=Math.max(Math.min(Wc.LastRow,cb.a.GA),0);if(0>Wc.FirstColumn||Wc.FirstColumn>
cb.a.$y)Wc.FirstColumn=Math.max(Math.min(Wc.FirstColumn,cb.a.$y),0);if(0>Wc.LastColumn||Wc.LastColumn>cb.a.$y)Wc.LastColumn=Math.max(Math.min(Wc.LastColumn,cb.a.$y),0)}return Oa}Rrh(Oa){if(!Oa||!Oa.length)return r.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.wxa?"empty":"null"} ConversionEntries. `),Oa;const Lb=Array(Oa.length);for(let Fc=0;Fc<Oa.length;++Fc){const Wc=new ha;Wc.Range=Oa[Fc].Range;Wc.IsRow=Oa[Fc].IsRow;
Wc.ConversionMap=Array(Oa[Fc].ConversionMap.length);Wc.IsRow||(this.fya=!0,r.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let td=0;td<Oa[Fc].ConversionMap.length;++td)Wc.ConversionMap[Oa[Fc].ConversionMap[td]]=td;Lb[Oa.length-Fc-1]=Wc}return Lb}sxh(Oa){if(Oa&&Oa.length)for(const Lb of Oa)this.rxh(Lb),Oa=Lb.IsRow?Lb.Range.LastRow-Lb.Range.FirstRow+1:Lb.Range.LastColumn-Lb.Range.FirstColumn+
1,Lb.ConversionMap.length!==Oa&&(r.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${Oa}] | Actual: [${Lb.ConversionMap.length}]`),this.fya=!0)}rxh(Oa){const Lb=Oa.ConversionMap;if(Lb&&Lb.length)if(0>Lb[0])r.ULS.shipAssertTag(537154384,0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.fya=!0;else{var Fc=[];for(let Wc=0;Wc<Lb.length;++Wc)if(0>
Lb[Wc]){const td=Lb[Wc-1],na=-1*Lb[Wc];for(let Pa=1;Pa<=na;++Pa)Fc.push(td+Pa)}else Fc.push(Lb[Wc]);Oa.ConversionMap=Fc}}};fb=Object(Ka.a)([Object(La.d)(Ta.Gb),Object(Ka.b)(0,Object(Ta.R)())],fb);Object(f.a)(fb,"NamedSheetViewConversionManager",$a.a,[737,5]);var Pb=a(649),Sa=a(802);class Wa extends Sys.EventArgs{constructor(Oa){super();this.ti=Oa}}Object(f.a)(Wa,"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var pb=a(92),wa=a(54),hb=a(40),Sb=a(57),Bc=a(56),ab=a(1176);class qb extends $a.a{constructor(Oa){super();
this.aD=this.xbg=this.Gbc=null;this.pme=!1;this.$_d=null;this.wHc=!1;this.ZY=(Lb,Fc)=>{if(2===Fc.newState){if(this.ti){if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Wc=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),td=>{td.result.EUi(Wc)},this.$.ka,3)}this.raiseEvent("connectionCompleted",
new Wa(this.ti),Fc)}else r.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");this.Gbc=Fc}else if(2===Fc.oldState||0===Fc.newState)this.Gbc=null,this.raiseEvent("connectionLostEventKey")};this.hUa=()=>{if(this.ti){const Lb=Object(u.a)(376,this.ti);Lb&&(r.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC for clientID {0}",this.$.workbookContext.ClientId),Lb.disconnect(),
Lb.baa(this.ZY))}this.aD=null};this.$=Oa;this.$.sk(this.hUa);this.$.da.O5c(this.hUa);if(this.wHc=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7654759_PassSessionExpirationManagerToRTC"))this.$_d=Pb.a.create();Oa.ea.Zc(38,Lb=>{this.wHc&&(this.$_d.instance=Lb);Lb.RCe(this.hUa)})}Stb(Oa){this.addHandler("connectionCompleted",Oa)}HCc(Oa){this.removeHandler("connectionCompleted",Oa)}I5c(Oa){this.addHandler("rtcInitialized",Oa)}eRb(Oa){this.removeHandler("rtcInitialized",Oa)}UBe(Oa){this.addHandler("connectionLostEventKey",
Oa)}l7f(Oa){this.removeHandler("connectionLostEventKey",Oa)}get ti(){return this.aD}get yzd(){return this.pme}dispose(){this.ti&&this.ti.baa(this.ZY);this.$&&this.$.Ym(this.hUa);this.aD=this.$=null;super.dispose()}kUe(Oa){hb.TaskExtensions.ya(this.rhf().task,Lb=>{Oa(Lb.result)},this.ka)}NQe(Oa,Lb){this.pme=Lb;this.Cbj(Oa)}f5a(){this.ti&&(this.raiseEvent("rtcInitialized"),2===this.ti.connectionState&&this.Gbc&&this.raiseEvent("connectionCompleted",new Wa(this.ti),this.Gbc))}uRi(){r.ULS.sendTraceTag(537167633,
0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");const Oa=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),Wc=>{Wc.result.HUi(Oa)},this.$.ka,3);var Lb=[];Lb.push(Sb.a.current.gq(65));Lb.push(Sb.a.current.gq(66));Lb=Sb.a.gGd(Lb,this.$.ka);const Fc=Sb.a.loadScript(9,0,1);return t.Task.AG(Lb,Fc)}Cbj(Oa){const Lb=this.uRi();
hb.TaskExtensions.ya(Lb,()=>{r.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===Sa.RealtimeChannel||null===Sa.RealtimeChannel}`);if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Wc=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):
wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),td=>{td.result.IUi(Wc)},this.$.ka,3)}this.aD=Sa.RealtimeChannel.createInstance(Oa,this.$.xa.UserSessionId,v.AFrameworkApplication.ybg,v.AFrameworkApplication.mf,this.wHc?this.$_d:null,2,Bc.b().yjf(),this.$.workbookContext.RtcEndpointUrl,void 0,new ab.a,void 0,void 0,this.$.workbookContext.RtcBootToken);r.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created with clientID {0}",Oa);gb.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled")&&
(Ba.a.instance.register(Sa.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").se().Ae(()=>this.ti),Ba.a.instance.resolve("Common.IRealtimeChannelBasic"));this.rhf().setResult(this.ti);if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Wc=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,
{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),td=>{td.result.GUi(this.yzd,Wc)},this.$.ka,3)}this.raiseEvent("rtcInitialized");r.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const Fc=Object(u.a)(376,this.ti);Fc&&(r.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),Fc.s6(this.ZY),Fc.connect())},this.ka,3)}rhf(){return this.xbg||(this.xbg=new n.a)}static la(Oa){Oa.ea.Ja(26,
new qb(Oa))}}Object(f.a)(qb,"RealTimeChannelController",$a.a,[9,10]);var mc=a(10),yb=a(2),vc=a(107),Db=a(114),Ga=a(28);class Eb{constructor(Oa,Lb,Fc,Wc,td,na,Pa,lb,Nb=!1){this.Ata=null;this.mTc=!0;this.PZc=this.rv=this.WPc=null;this.Za=new vc.a;this.ANg=Oa;this.V5=Lb;this.Kse=Fc;this.Ise=Wc;this.tfe=na;Eb.Uf=td;this.XOg=Pa;this.fva=lb;this.vPg=Nb;t.Task.WAA(Lb,Fc).continueWith(Object(d.a)(this,this.Lvi,"initOnTaskReady"))}t2f(){this.Za.raiseEvent("u",null,this)}Lvi(){this.V5.result&&this.Kse.result&&
(this.rv=this.V5.result,this.PZc=this.Kse.result,this.rv.b3a(Object(d.a)(this,this.nqa,"onPresenceUpdated")),this.WPc=new Db.a(2,2,this.tfe,Object(d.a)(this,this.Zgk,"updateAwayClientsTask"),88),Eb.Uf.Ah(this.WPc))}nqa(Oa,Lb){(this.mTc||this.mvj(Lb.JL))&&Eb.Uf.kra(this.WPc,0)}mvj(Oa){for(let Fc in Oa){var Lb=this.Ise.Bgf({key:Fc,value:Oa[Fc]});if(Lb&&Lb.clientId&&(Lb=Lb.clientId.toLowerCase(),(Lb=this.Ata[Lb]||this.Ata[Lb.toUpperCase()])&&2===Lb.status))return!0}return!1}Zgk(Oa){var Lb=this.rv.A2h();
if(Lb){var Fc=new Date,Wc=!1;if(this.mTc){this.Ata=Lb;this.mTc=!1;var td=this.Ata;for(var na in td){Lb=na;var Pa=td[na];Pa.Dcb<Fc&&(Fc=Pa.Dcb);2===Pa.status&&(Wc=!0,this.PZc.R6f(Lb))}Wc&&this.t2f();Eb.Uf.kra(Oa,this.Aff(Fc))}else{Pa=new K.a;na=!1;var lb=this.Ata;for(td in lb){lb=td;if(!(lb in this.Ata)||this.ANg.clientId===lb)continue;var Nb=this.Ata[lb];const xc=Lb[lb];if(Nb&&xc){Nb=Nb.status;const Oc=xc.status;2===Nb&&1===Oc?(Pa.add(lb),r.ULS.sendTraceTag(38052609,392,50,lb+" returned from away")):
1===Nb&&2===Oc&&(na=Wc=!0,this.PZc.R6f(lb),r.ULS.sendTraceTag(38052610,392,50,lb+" went away"));1===Oc&&xc.Dcb<Fc&&(Fc=xc.Dcb)}}this.Ata=Lb;Eb.Uf.kra(Oa,this.Aff(Fc));(0<Pa.count||Wc)&&this.t2f();0<Pa.count&&!this.vPg?(Oa=this.g5h(Pa),this.oak(Oa)):Oa=new K.a;(na||0<Oa.count)&&this.XOg(Ga.a.tbd,2)}}}oak(Oa){if(Oa.count)for(let Lb of Oa)Oa=this.fva.e1(String.format(CommonUIStrings.l_EditorsToastArriving,Lb),!1),Oa.image=5,Oa.q2="CoAuth_AuthorStatus_16x16x32",this.fva.gD(Oa)}g5h(Oa){const Lb=this.rv.ojc(),
Fc=new K.a;for(let Wc in Lb){const td={key:Wc,value:Lb[Wc]};if(Oa.contains(td.key)){const na=this.Ise.Bgf(td);na&&(Fc.add(na.userName),Oa.remove(td.key))}}Fc.count||r.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Fc}Aff(Oa){const Lb=new Date;return Math.max(Oa.getTime()+this.tfe-Lb.getTime(),0)}}Eb.Uf=null;Object(f.a)(Eb,"AwayManager",null,[]);var Zb=a(443),ic=a(110),mb=a(304),Hb=a(234);class Wb extends Hb.a{constructor(Oa){super();this.manager=null;this.$=Oa;this.Md()}create(){this.qd(this.manager||
(this.manager=new fb(this.$)))}}Object(f.a)(Wb,"NamedSheetViewConversionManagerFactory",Hb.a,[]);var Ob=a(96),Gc=a(548);class Va{static Agf(Oa){return new Zb.a(Oa.User.UserID,Oa.User.UserName,Oa.UserColor,new Gc.a(1),null,Oa.UserEmail,void 0,void 0,void 0,void 0,void 0,Oa.JoinCoauthTime)}}Object(f.a)(Va,"PresenceHelper",null,[]);class Jb{constructor(Oa){this.Ua=new vc.a;this.WMc=this.disposed=!1;this.mOb=()=>{r.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.Ua.raiseEvent("UU",
this)};this.$=Oa;this.$.da.Nca(this.mOb);this.WMc=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}dispose(){this.disposed||(this.$&&this.$.da&&this.$.da.faa(this.mOb),Ob.a.te([this.Ua]),this.$=this.Ua=null,this.disposed=!0)}e3a(Oa){this.Ua.addHandler("UU",Oa)}EWd(Oa){this.Ua.removeHandler("UU",Oa)}jza(){const Oa=[];for(const Lb of this.$.da.Kp)Oa.push(Va.Agf(Lb));r.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${Oa.length}]`);return Oa}}
Object(f.a)(Jb,"PeopleInfoProvider",null,[763,5]);var ub=a(659);class Qa{gD(){r.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}e1(Oa,Lb){return new ub.a(Oa,Lb)}dispose(){}static get instance(){Qa.La||(Qa.La=new Qa);return Qa.La}}Qa.La=null;Object(f.a)(Qa,"NoOpNotificationBar",null,[762,5]);let P=class{Bgf(Oa){const Lb=Oa.key;Oa=Oa.value;if(!Oa)return null;const Fc=Oa.SupportsChat?4:
0;return Object(yb.a)(new Zb.a,{clientId:Lb,bad:Oa.ChatThreadId,$$c:Oa.ChatThreadDiscoveryUri,OFb:Oa.InChat,email:Oa.Cid,capabilities:new Gc.a(Fc),isAnonymous:Oa.IsAnonymous})}};P=Object(Ka.a)([Object(La.d)(Ta.dc)],P);Object(f.a)(P,"PresenceConverter",null,[735]);class ta extends Hb.a{constructor(){super();this.JRe=null;this.Md()}create(){this.qd(this.JRe||(this.JRe=new P))}static la(Oa){Oa.ea.Ja(159,new ta)}}Object(f.a)(ta,"PresenceConverterFactory",Hb.a,[]);var Z=a(142),aa=a(143);let Ea=class{constructor(Oa){this.e_f=
this.uRd=this.g_f=this.c_f=this.gYf=this.cZd=this.obg=this.wbg=this.vbg=!1;this.vRd=this.dQd=this.nSb=this.qSb=this.xEc=this.gZd=0;this.gxf=!1;this.oKd=this.hwb=0;this.Urc=!1;this.Qe=()=>{this.Urc=!0;this.$.da.Vl(this.Qe)};this.$=Oa;U.a.DS&&(this.oKd=window.performance.timing.navigationStart);this.oKd||r.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.da.Pl(this.Qe)}HUi(Oa){this.vbg||(this.gZd=Oa,this.vbg=!0)}IUi(Oa){this.wbg||(this.xEc=Oa,this.wbg=!0)}GUi(Oa,Lb){this.obg||
(this.qSb=Lb,this.gxf=Oa,this.obg=!0)}EUi(Oa){this.cZd||(this.nSb=Oa,this.cZd=!0)}kUi(Oa){!this.uRd&&this.cZd&&(this.vRd=Oa,this.uRd=!0)}fUi(Oa){this.gYf||(this.dQd=Oa,this.gYf=!0)}jUi(Oa){if(!this.c_f&&this.Pka&&!this.Urc){this.c_f=!0;const Lb=this.cpd();Lb.RtcIntializeToPeopleWellServiceCreate=this.dQd-this.qSb;Lb.PeopleWellServiceCreateToPresenceGalleryRender=Oa-this.dQd;Lb.PresenceGalleryRenderTotalTime=Oa-this.Pka;aa.b(this.$).Xe(Z.a.d_f,Lb,void 0,!0)}}mUi(Oa){if(!this.g_f&&this.Pka&&!this.Urc){this.g_f=
!0;const Lb=this.cpd();Lb.RtcIntializeToRtcConnect=this.nSb-this.qSb;Lb.RtcConnectToPresenceSent=Oa-this.nSb;Lb.PresenceSentTotalTime=Oa-this.Pka;aa.b(this.$).Xe(Z.a.h_f,Lb,void 0,!0)}}lUi(Oa){if(!this.e_f&&this.uRd&&this.Pka&&!this.Urc){this.e_f=!0;const Lb=this.cpd();Lb.RtcIntializeToRtcConnect=this.nSb-this.qSb;Lb.RtcConnectToPresenceRenderInitiate=this.vRd-this.nSb;Lb.PresenceRenderInitiateToPresenceRenderFinish=Oa-this.vRd;Lb.PresenceRenderTotalTime=Oa-this.Pka;aa.b(this.$).Xe(Z.a.f_f,Lb,void 0,
!0)}}dispose(){this.$=null}cpd(){const Oa={};Oa.CoAuthorCountsOnBoot=this.$.da.Kp.length;Oa.RtcConnectedLaterInSession=this.gxf;Oa.BrowserVisibilityChanged=this.S9g();Oa.AppInteractiveAbsTime=this.Pka;Oa.NavigationStartTime=this.oKd;Oa.AppInteractiveToRtcSliceDownloadInitialize=this.gZd-this.Pka;Oa.RtcSliceDownloadInitializeToRtcSliceLoad=this.xEc-this.gZd;Oa.AppInteractiveToRtcSliceLoad=this.xEc-this.Pka;Oa.RtcSliceLoadToRtcInitialize=this.qSb-this.xEc;return Oa}get Pka(){if(this.hwb)return this.hwb;
qa.a.instance.c7("AppInitStatus_interactivityReady")&&(this.hwb=qa.a.instance.PB("AppInitStatus_interactivityReady"));this.hwb||r.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.hwb}S9g(){return U.a.DS&&qa.a.instance.c7(sa.a.QXb)?0<qa.a.instance.PB(sa.a.QXb)[sa.a.qzg]:!1}};Ea=Object(Ka.a)([Object(La.d)(Ta.ec),Object(Ka.b)(0,Object(Ta.R)())],Ea);Object(f.a)(Ea,"PresenceTelemetry",null,[736,5]);class za extends Hb.a{constructor(Oa){super();this.$=Oa;this.Md()}create(){this.qd(this.$.ea.Ba(435)||
this.$.ea.Ja(435,new Ea(this.$)))}static la(Oa){Oa.ea.Ja(436,new za(Oa))}}Object(f.a)(za,"PresenceTelemetryFactory",Hb.a,[]);var bb=a(1247),Mb=a(52),zb=a(48),oa=a(34),Xa=a(135),bc=a(16),Ac=a(21),Xc=a(87);class Ed extends $a.a{constructor(Oa){super();this.Txe=Oa;this.VZc=this.pva=null}get VXb(){return this.Txe}get ie(){return this.pva||{}}set ie(Oa){this.VZc=this.pva;this.pva=Oa;this.raiseEvent("userPresenceChanged")}get SRd(){return this.VZc}dispose(){this.raiseEvent("userPresenceChanged");this.raiseEvent("userLeft");
this.VZc=this.pva=this.Txe=null;super.dispose()}}Object(f.a)(Ed,"UserPresence",$a.a,[]);class Qd extends Xc.a{constructor(){super();this.Lse=this.Jse=this.MC=null}get RA(){return this.Jse}V1d(Oa){this.Jse=Oa}get wn(){return this.Lse}hig(Oa){this.Lse=Oa}get ie(){return this.MC.ie}set ie(Oa){this.MC.ie=Oa}h5a(){}v9a(){return null}gqd(){return null}Zlg(){}$lg(){}Ewg(){}WHc(){}inc(){}static Ejk(Oa,Lb){const Fc=Oa.MC.ie;Ob.a.te(Oa.RA);Ob.a.te([Oa.MC]);Oa.MC=null;Oa.MC=new Ed(Lb);Oa.V1d([]);Oa.hig(Lb);
Oa.ie=Fc}}Object(f.a)(Qd,"IUserGridPresence",Xc.a,[]);var zd=a(1178),fe=a(874),jd=a(41),Xb=a(113),Lc=a(1048),Bd=a(42),Nc=a(162),rb=a(13),va=a(128);class yc extends $a.a{constructor(Oa,Lb,Fc,Wc,td){super();this.xA=[];this.J4a=null;this.visible=!1;this.hvb=this.WJb=null;this.xea=!1;this.r2j=()=>{Ob.a.Ma(this.hvb);this.hvb=null;this.visible&&(this.xRa()?this.raiseEvent("showPresenceTooltip"):this.H8(!0))};this.ANd=na=>{this.NVa(na)};this.gC=()=>{this.ivg()};this.qI=()=>{this.ivg()};this.domElement=Oa;
this.gridView=Lb;this.w2c=Oa.id;this.kva=Wc;this.$=td;this.Nrc=!1;this.Unf();this.QZc=Fc;this.yg=null;this.QE={};this.QE.FirstColumn=0;this.QE.FirstRow=0;this.QE.LastColumn=0;this.QE.LastRow=0}o5c(Oa){this.addHandler("hidePresenceTooltip",Oa)}aWd(Oa){this.removeHandler("hidePresenceTooltip",Oa)}S5c(Oa){this.addHandler("showPresenceTooltip",Oa)}zWd(Oa){this.removeHandler("showPresenceTooltip",Oa)}R5c(Oa){this.addHandler("showFullPresenceTooltip",Oa)}yWd(Oa){this.removeHandler("showFullPresenceTooltip",
Oa)}AKa(Oa){this.addHandler("presenceChanged",Oa)}iEa(Oa){this.removeHandler("presenceChanged",Oa)}get eB(){return this.w2c}get CDa(){return this.QZc}get paneType(){return this.kva}get yAc(){if(!this.domElement)return null;var Oa=this.gridView.Ih(this.paneType).Qn,Lb=this.gridView.rtl,Fc=this.domElement.offsetWidth;if(!this.yg&&4>=Fc){if(this.QE){Fc=this.gridView.Yk;var Wc=this.QE.FirstRow;Lb=Lb?this.QE.FirstColumn:this.QE.LastColumn;if(Fc&&!(Wc>=Fc.top&&Wc<=Fc.bottom&&Lb>=Fc.left&&Lb<=Fc.right))return Wc=
Wc<=Fc.top?Oa.y:Oa.y+(Wc>=Fc.bottom?Oa.height:Oa.height/2),Lb=Lb<=Fc.left?Oa.x:Oa.x+(Lb>=Fc.right?Oa.width:Oa.width/2),this.WJb=new Sys.UI.Point(Lb,Wc)}return this.WJb}if(this.yg){Oa=this.domElement.offsetTop-2;Wc=parseInt(this.domElement.style.left,10);let td=0;Lb&&(td=parseInt(this.domElement.parentNode.style.width,10)-Fc-Wc,td-=this.gridView.TU.iSa&&this.gridView.TU.cEd?va.a.$x:0);return this.WJb=new Sys.UI.Point((Lb?td:Wc)+Fc+4,Oa)}return this.WJb=new Sys.UI.Point(parseInt(Lb?this.domElement.style.right:
this.domElement.style.left,10)+Fc,this.domElement.offsetTop)}get range(){return ya.E(this.QE)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.jOe();this.VYa();Ob.a.Ma(this.hvb);this.domElement=this.gridView=null;super.dispose()}X4d(Oa,Lb){const Fc=!!Oa&&!ya.E(Oa).equals(ya.E(this.QE)),Wc=!!Lb&&(!this.yg||this.yg.get_id()!==Lb.get_id());if(Fc||Wc)this.raiseEvent("presenceChanged"),this.jOe(),this.xea=!1,this.QE=Oa,this.yg=Lb,this.WJb=null}H8(Oa){this.visible=
this.xea=!1;Oa&&this.raiseEvent("hidePresenceTooltip")}Aka(Oa){this.xA.push(Oa);this.Unf();Oa.AKa(this.ANd)}csa(Oa,Lb){Oa?(this.visible=!0,Lb&&(this.hvb=Nc.AsyncMethodContext.Or(this.r2j,this.$.xa.ShowTooltipDelayInMs,zb.a.abk,this.hvb))):this.H8(Lb)}KVb(){}slb(){if(this.domElement&&this.visible){this.J4a=rb.DOMElementExtensions.getBoundingClientRect(this.domElement);const Oa=Math.floor(this.J4a.x);this.J4a.x=Oa===this.J4a.x?Oa:Oa+1;this.J4a.y=Math.floor(this.J4a.y)}}xRa(){if(!this.QE)return!1;const Oa=
this.wei();return Oa?this.gridView.nJi(Oa,this.paneType):!1}wei(){if(this.range.isSingle){var Oa=this.gridView.za.Cza(this.range,this.$.activeItemName);return Oa?(Oa=Oa.Fu(this.range))?Oa.CF:null:null}return this.range}jOe(){for(let Oa=0,Lb=this.xA.length;Oa<Lb;Oa++)this.xA[Oa].iEa(this.ANd);this.xA.length=0;this.VYa()}Unf(){!this.Nrc&&1<=this.xA.length&&(this.Nrc=!0,this.gridView.za.GJ(this.gC),this.gridView.za.yw(this.gC),this.gridView.view.uu(this.qI))}VYa(){this.Nrc&&!this.xA.length&&(this.Nrc=
!1,this.gridView&&(this.gridView.za.bL(this.gC),this.gridView.za.Tu(this.gC),this.gridView.view.pt(this.qI)))}NVa(Oa){Oa.iEa(this.ANd);Array.remove(this.xA,Oa);this.VYa()}ivg(){this.slb();for(let Oa=0,Lb=this.xA.length;Oa<Lb;Oa++)this.xA[Oa].slb()}}Object(f.a)(yc,"TooltipNotificationUnit",$a.a,[848,5]);var Zc=a(797);class cc extends $a.a{constructor(Oa,Lb,Fc,Wc,td,na,Pa,lb){super();this.Bd=null;this.eC={};this.lze=0;this.yg=this.ewa=null;this.kva=0;this.rNb=Nb=>{this.ewa&&this.ewa!==Nb||(this.ewa=
null,this.H8(!1));this.raiseEvent("hidePresenceTooltip")};this.YNb=Nb=>{this.ewa&&this.ewa!==Nb||(this.ewa=null,this.csa(!0,!1));this.raiseEvent("showPresenceTooltip")};this.XNb=Nb=>{this.ewa||this.raiseEvent("showFullPresenceTooltip");this.ewa=Nb};this.ONb=()=>{this.H8(!1);this.raiseEvent("presenceChanged")};lb=Fc===bc.a.instance.gd(87)||lb;this.QZc=new Zb.a(Lb,Fc,Wc,new Gc.a,null,null,null,null,lb);this.gridView=Oa;this.w2c=Lb;this.highlight=td;this.$v=na;this.$=Pa}o5c(Oa){this.addHandler("hidePresenceTooltip",
Oa)}aWd(Oa){this.removeHandler("hidePresenceTooltip",Oa)}S5c(Oa){this.addHandler("showPresenceTooltip",Oa)}zWd(Oa){this.removeHandler("showPresenceTooltip",Oa)}R5c(Oa){this.addHandler("showFullPresenceTooltip",Oa)}yWd(Oa){this.removeHandler("showFullPresenceTooltip",Oa)}AKa(Oa){this.addHandler("presenceChanged",Oa)}iEa(Oa){this.removeHandler("presenceChanged",Oa)}get eB(){return this.w2c}get CDa(){return this.QZc}get paneType(){return this.kva}get range(){return this.Bd}get yAc(){return this.Bd||
this.yg?Lc.a(this.gridView.Ih(this.paneType),this.Lza(this.paneType).yAc,!0):null}get xea(){return this.Lza(this.paneType).xea}set xea(Oa){const Lb=this.eC;for(let Fc in Lb)Lb[Fc].xea=Oa}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.$v&&this.$v.sfk(this.eB);const Oa=this.eC;for(let Lb in Oa){const Fc=Oa[Lb];Fc.aWd(this.rNb);Fc.zWd(this.YNb);Fc.yWd(this.XNb);Fc.iEa(this.ONb);Fc.dispose()}this.$v=this.Bd=this.highlight=this.gridView=this.eC=null;super.dispose()}jmg(Oa,
Lb,Fc=null){Oa?(this.Bd=ya.E(Oa),this.kva=this.gridView.Tc.Rj(this.Bd.topRight)):Fc?(this.yg=Fc,this.kva=Fc.Mh.paneType):this.kva=1;this.lze=Lb;this.Lza(this.paneType);this.X4d(Oa,Fc)}X4d(Oa,Lb){const Fc=this.eC;for(let Wc in Fc)Fc[Wc].X4d(Oa,Lb)}H8(Oa){this.Lza(this.paneType).H8(Oa);Oa=this.eC;for(let Lb in Oa)Oa[Lb].H8(!1)}RAe(Oa){const Lb=this.eC;for(let Fc in Lb){const Wc=Lb[Fc];Wc.Aka(Oa.Lza(Wc.paneType))}}Aka(Oa){this.Lza(Oa.paneType).Aka(Oa)}xRa(){let Oa=this.Lza(this.paneType).xRa();const Lb=
this.eC;for(let Fc in Lb)Oa=Lb[Fc].xRa()||Oa;return Oa}csa(Oa,Lb){this.$v.Cae(this);this.Lza(this.paneType).csa(Oa,Lb);Lb=this.eC;for(let Fc in Lb)Lb[Fc].csa(Oa,!1)}KVb(Oa){const Lb=this.eC;for(let Fc in Lb)Lb[Fc].KVb(Oa)}slb(){const Oa=this.eC;for(let Lb in Oa)Oa[Lb].slb();this.$v.Cae(this)}Lza(Oa){return this.udi(Oa,this.lze)}iae(Oa){this.$v.iae(Oa)}udi(Oa,Lb){const Fc=this.highlight?this.highlight.DF(Lb,Oa).Ng:this.yg?Zc.a?this.yg.domElement:this.yg.get_element():null;Lb=cc.kki(Lb,Oa);let Wc=jd.a.Ve(this.eC,
Lb);Wc||(Wc=new yc(Fc,this.gridView,this.CDa,Oa,this.$),this.eC[Lb]=Wc,Wc.o5c(this.rNb),Wc.S5c(this.YNb),Wc.R5c(this.XNb),Wc.AKa(this.ONb));return Wc}static kki(Oa,Lb){return Oa.toString()+Lb.toString()}}Object(f.a)(cc,"PaneInvariantTooltipNotificationUnit",$a.a,[848,5]);class Le{constructor(Oa,Lb,Fc){this.yg=this.objectId=this.z0b=null;this.wn=Oa;this.$=Lb;this.$v=Fc;this.ex=new cc(Ac.h(this.$),this.wn.User.UserID,this.wn.User.UserName,this.wn.UserColor,null,Fc,this.$,this.wn.IsAnonymous)}get yg(){return this.z0b}set yg(Oa){this.z0b=
Oa}dispose(){this.rFb();Ob.a.Ma(this.ex);this.objectId=this.$=this.wn=this.yg=null}Aka(Oa){this.ex.RAe(Oa.ex)}rFb(){var Oa;this.yg&&this.wn&&this.wn.User&&(this.yg.$Lc(!1,this.wn.User.UserID,null),Zc.a&&(null===(Oa=this.yg)||void 0===Oa?void 0:Oa.xVd(this.wn.User.UserID)),this.ex.H8(!0))}ZUb(){fe.a.CUb&&this.yg&&this.wn&&this.wn.User&&(this.yg.$Lc(!0,this.wn.User.UserID,this.wn.UserColor),this.ex.slb())}HI(Oa){var Lb;fe.a.asa&&(Zc.a?this.yg&&(null===(Lb=this.wn)||void 0===Lb?0:Lb.User)&&this.yg.G4c(Va.Agf(this.wn)):
(this.ex.xea=Oa,this.ex.csa(Oa,!0)))}hVb(Oa,Lb){this.ex.jmg(null,0===Lb?50:51,Oa)}}Object(f.a)(Le,"FloatingObjectPresenceHighlight",null,[845,5]);var Re=a(155),Ib=a(642),Yc=a(75),Cb=a(69),pc=a(12),Mc=a(265),xd=a(161);class Nd extends Ib.a{constructor(Oa,Lb,Fc){super(Lb,Ac.h(Lb),!0,!1,Oa.User.UserID);this.vA=[];this.Fqc=this.cVb=!1;this.v3=()=>{gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7486785_FixPresenterPresenceHighlightJSCrash")&&!this.vA||this.wn.User.UserID!==this.LDb()||(r.ULS.sendTraceTag(521143967,
0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.wn.User.UserID}, Logging presenter information: ${this.LDb()}, meetingId: ${this.$.xa.MeetingId}`),this.vA.forEach(Wc=>{this.FYe(Wc)}),this.vA=[])};Nd.J5a||(Nd.J5a={});this.wn=Oa;this.ex=new cc(this.gridView,this.wn.User.UserID,this.wn.User.UserName,this.wn.UserColor,this,Fc,this.$,this.wn.IsAnonymous);this.QAd=xd.j(this.$);this.OIi=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.Szd=xd.a(this.$);this.Otf=this.QAd||this.Szd;this.v3=this.v3.bind(this);
this.Otf&&this.MQi()}dispose(){var Oa;Ob.a.Ma(this.ex);super.dispose();const Lb=Nd.J5a;for(let Wc in Lb){var Fc=Wc;const td=Lb[Wc];td&&!td.children.length&&(rb.DOMElementExtensions.xh(td),Nd.J5a[Fc]=null)}null===(Oa=Nd.excelLiveManager)||void 0===Oa?void 0:Oa.yhb(this.v3);this.vA=null}Aka(Oa){this.ex.RAe(Oa.ex)}HI(Oa){fe.a.asa&&(this.Fqc||(this.ex.xea=Oa,this.ex.csa(Oa,!0)),this.cVb=Oa&&this.Fqc)}hVb(Oa,Lb){this.ex.jmg(Oa,0===Lb?50:51);this.cVb=!1}ZUb(Oa){fe.a.CUb&&(this.ex.csa(!0,!0),this.tt([Oa]))}rFb(Oa){this.H8();
this.Sl(Oa)}DUe(Oa,Lb,Fc){Fc.className=Yc.a.TPh;Fc.style.borderColor=this.wn.UserColor;this.Szd&&Fc.classList.add(Yc.a.S4e);const Wc=document.createElement("div");50!==Oa&&51!==Oa&&(Wc.style.backgroundColor=this.wn.UserColor);Fc.appendChild(Wc);Wc.className=[Yc.a.VPh,Yc.a.UPh][Oa-50];Oa=jd.a.Ve(Nd.J5a,Lb.toString());if(!Oa){const td=this.gridView.Ih(Lb).domElement;Oa=document.createElement("div");td.insertBefore(Oa,td.firstChild);Nd.J5a[Lb.toString()]=Oa}Oa.appendChild(Fc);this.Otf&&this.kCh(Wc)}pFb(){}pgg(Oa,
Lb,Fc,Wc,td){this.wLc&&rb.DOMElementExtensions.setVisible(Lb.Ng,td);td=this.d2g(Wc,Oa,Lb);Mc.c(Fc,this.gridView.rtl,pc.HelperMethods.De(td.x));Fc.width=pc.HelperMethods.De(td.width);Fc.top=pc.HelperMethods.De(td.y);Fc.height=pc.HelperMethods.De(td.height);Lb=Lb.Ng;Fc=Lb.parentNode;51===Oa?Nd.QTd(Fc,Lb,!1):50===Oa&&(Oa=this.DF(51),Wc.equals(Oa.Tsc)?Nd.QTd(Fc,Lb,!1):Nd.QTd(Fc,Lb,!0));this.Knj()}Rjg(){return!1}d2g(Oa,Lb,Fc){let Wc=Oa.y+this.bDb(Fc,!1);Fc=Oa.x+this.bDb(Fc,!0)+va.a.fod(Fc.Ng.parentNode.parentNode,
this.gridView.rtl);let td=Oa.width;Oa=Oa.height+1;1>Fc&&-1<=Fc&&50===Lb&&(td-=1-Fc,Fc=1);1>Wc&&-1<=Wc&&50===Lb&&(Oa-=1-Wc,Wc=1);td=Math.max(0,td-1);Oa=Math.max(0,Oa-2);return new Cb.a(Fc,Wc,td,Oa)}Knj(){this.ex.slb();this.Fqc=!1;this.cVb&&this.HI(!0);this.cVb=!1}H8(){this.Fqc||(this.ex.H8(!0),this.cVb=!1)}static QTd(Oa,Lb,Fc){Fc?Lb!==Oa.firstChild&&(Oa.removeChild(Lb),Oa.insertBefore(Lb,Oa.firstChild)):Lb!==Oa.lastChild&&(Oa.removeChild(Lb),Oa.appendChild(Lb))}kCh(Oa){var Lb;(null===(Lb=Nd.excelLiveManager)||
void 0===Lb?0:Lb.wUa.Ru)?this.wn.User.UserID===this.LDb()&&(r.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.wn.User.UserID}, Logging presenter information: ${this.LDb()}, meetingId: ${this.$.xa.MeetingId}`),this.FYe(Oa)):(r.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.wn.User.UserID}`),this.vA.push(Oa))}FYe(Oa){this.Szd&&this.Ezj(Oa);this.QAd&&(r.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.wn.User.UserID}`),
this.Ssi(Oa));this.QAd&&this.OIi&&this.Njk(Oa)}MQi(){Nd.excelLiveManager?Nd.excelLiveManager.aub(this.v3):this.$.ea.Zc(473,Oa=>{Nd.excelLiveManager=Oa;Nd.excelLiveManager.aub(this.v3)})}Ssi(Oa){Re.a(()=>{Oa.style.backgroundColor=this.wn.UserColor;Oa.classList.add(Yc.a.$Ph);r.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.wn.User.UserID}, Logging presenter information: ${this.LDb()}, meetingId: ${this.$.xa.MeetingId}`)},this.$.ka)}Ezj(Oa){Re.a(()=>{Oa.parentElement.classList.remove(Yc.a.S4e)},
this.$.ka)}Njk(Oa){this.ex.iae(Nd.excelLiveManager.wUa.Ru);Re.a(()=>{Oa.parentElement.classList.add(Yc.a.ZPh)},this.$.ka)}LDb(){return Nd.excelLiveManager.wUa.Ru}}Nd.J5a=null;Object(f.a)(Nd,"PresenceHighlight",Ib.a,[]);class te extends Qd{constructor(Oa,Lb,Fc){super();this.dK=new jd.a(!0);this.countFloatingObjects=this.xdd=this.wdd=0;this.qSd=!1;this.ht=()=>{this.S0d()};this.fDa=()=>{this.S0d()};this.MC=new Ed(Oa);this.hig(Oa);this.$v=Fc;this.V1d([]);this.$=Lb;this.$.va.Fi(this.fDa);Ac.h(this.$).uW(this.ht);
this.qSd=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence")}get ie(){return this.MC.ie}set ie(Oa){this.MC.ie=Oa;this.S0d()}WHc(){var Oa=1===this.ie.PresenceType?51:50;for(let Lb=0;Lb<this.RA.length;Lb++)this.RA[Lb].ZUb(Oa);for(Oa=0;Oa<this.dK.count;Oa++)this.dK.Xh(Oa).ZUb()}inc(){var Oa=1===this.ie.PresenceType?51:50;for(let Lb=0;Lb<this.RA.length;Lb++)this.RA[Lb].rFb([Oa]);for(Oa=0;Oa<this.dK.count;Oa++)this.dK.Xh(Oa).rFb()}dispose(){this.$&&(this.$.va&&this.$.va.hj(this.fDa),
Ac.h(this.$).WQ(this.ht));this.xYe();Ob.a.te(this.RA);Ob.a.te([this.MC]);this.MC=this.$=null;this.V1d(null);this.dK=null;super.dispose()}xYe(){if(this.dK){for(let Oa=0;Oa<this.dK.count;Oa++)this.dK.Xh(Oa).dispose();this.dK.clear()}}h5a(Oa){1===this.ie.Version?this.ygh(Oa):this.zgh(Oa)}ygh(Oa){if(Oa.ie.SelectedRange&&this.ie.SelectedRange){const Lb=this.ie.SelectedRange.length,Fc=Oa.ie.SelectedRange.length;for(let Wc=0;Wc<Lb;Wc++)for(let td=0;td<Fc;td++)if(vb(this.ie.SelectedRange[Wc],Oa.ie.SelectedRange[td])){this.RA[Wc].Aka(Oa.v9a(td));
return}}}zgh(Oa){var Lb;let Fc=0,Wc=0;if(this.ie&&this.ie.Object&&(null===(Lb=Oa.ie)||void 0===Lb?0:Lb.Object)){Lb=this.ie.Object.length;var td=Oa.ie.Object.length;for(var na=0;na<Lb;na++)if(this.ie.Object[na]&&this.zsd(this.ie.Object[na])){Fc++;for(var Pa=0;Pa<td;Pa++)if(Oa.ie.Object[Pa]&&this.zsd(Oa.ie.Object[Pa])&&(Wc++,this.n7c(this.ie.Object[na],Oa.ie.Object[Pa]))){var lb=this.v9a(Fc),Nb=Oa.v9a(Wc);if(lb&&Nb){lb.Aka(Nb);return}}}else if(this.ie.Object[na]&&Oa.ie.Object[na]&&(0===this.ie.Object[na].ObjectType||
2===this.ie.Object[na].ObjectType))for(Pa=0;Pa<td;Pa++)if(Oa.ie.Object[Pa]&&(0===Oa.ie.Object[na].ObjectType||2===Oa.ie.Object[na].ObjectType)&&this.ie.Object[na].ObjectId===Oa.ie.Object[Pa].ObjectId&&(lb=this.gqd(this.ie.Object[na].ObjectId),Nb=Oa.gqd(this.ie.Object[na].ObjectId),lb&&Nb)){lb.Aka(Nb);return}}if(Oa.ie.SelectedRange&&this.ie.SelectedRange)for(Lb=this.ie.SelectedRange.length,td=Oa.ie.SelectedRange.length,na=0;na<Lb;na++)for(Pa=0;Pa<td;Pa++)if(vb(this.ie.SelectedRange[na],Oa.ie.SelectedRange[Pa])&&
(lb=this.v9a(Fc+na),Nb=Oa.v9a(Wc+Pa),lb&&Nb)){lb.Aka(Nb);return}}n7c(Oa,Lb){return!!Oa&&!!Lb&&Lb.ObjectType===Oa.ObjectType&&(1===Oa.ObjectType||3===Oa.ObjectType)&&!Oa.ObjectId.localeCompare(Lb.ObjectId)}v9a(Oa){return 0<=Oa&&this.RA.length>Oa?this.RA[Oa]:null}Zlg(Oa){for(let Lb=0,Fc=this.RA.length;Lb<Fc;Lb++)this.RA[Lb].HI(Oa)}gqd(Oa){return Oa&&this.dK.Wc(Oa)?this.dK.getItem(Oa):null}$lg(Oa,Lb=null){if(Oa)(Oa=this.dK.getItem(Lb))&&Oa.HI(!0);else for(Oa=0;Oa<this.dK.count;Oa++)(Lb=this.dK.Xh(Oa))&&
Lb.HI(!1)}Ewg(Oa){Qd.Ejk(this,Oa)}zed(Oa,Lb){if(Oa<Lb)return this.RA[Oa];if(!this.wn||!this.$||!this.$v)return null;Oa=new Nd(this.wn,this.$,this.$v);this.RA.push(Oa);return Oa}ERj(){const Oa=this.RA.length;var Lb=this.ie.SelectedRange?this.ie.SelectedRange.length:0,Fc=this.$.va.na;for(let Wc=0;Wc<Lb;Wc++){let td=this.zed(Wc,Oa);td&&this.ie.SelectedRange[Wc]&&(this.ie.SelectedRange[Wc].NamedObjectName?td.Sl([51,50]):(td.hVb(this.ie.SelectedRange[Wc],this.ie.PresenceType),te.hae(this.ie.PresenceType,
td,this.ie.SelectedRange[Wc],Fc,this.wn,this.$v)))}Fc=!!this.MC&&!!this.MC.SRd&&this.MC.SRd.PresenceType!==this.MC.ie.PresenceType;for(Lb=Fc?0:Lb;Lb<Oa;Lb++)this.RA[Lb].Sl([1===this.MC.SRd.PresenceType?51:50])}zsd(Oa){return(null===Oa||void 0===Oa?0:Oa.ObjectId)&&(1===this.rff(Oa.ObjectType)||2===this.rff(Oa.ObjectType))&&(Oa=this.$.Gd.mrd(Oa.ObjectId))?ya.w(Oa):null}FRj(){const Oa=this.RA.length,Lb=this.$.va.na,Fc=this.ie.SelectedRange?this.ie.SelectedRange.length:0;var Wc=this.ie.Object?this.ie.Object.length:
0;for(var td=0;td<Oa;td++)this.RA[td].Sl([51,50]);this.Hhh();this.xdd=this.wdd=td=0;for(var na=0;na<Wc;na++){var Pa=this.ie.Object[na],lb=this.zsd(Pa);if(lb){let Nb=this.zed(td,Oa);1===Pa.ObjectType?this.wdd++:3===Pa.ObjectType&&this.xdd++;td++;Nb.hVb(lb,Pa.ObjectPresenceType);te.hae(Pa.ObjectPresenceType,Nb,lb,Lb,this.wn,this.$v)}}for(Wc=0;Wc<Fc;Wc++)this.ie&&this.ie.SelectedRange&&(na=this.ie.SelectedRange[Wc],na.NamedObjectName||(Pa=!!Lb&&na.SheetName===Lb.name,lb=!!eb(na,this.$,1),Pa&&lb||(Pa=
this.zed(td+Wc,Oa),Pa.hVb(na,this.ie.PresenceType),te.hae(this.ie.PresenceType,Pa,na,Lb,this.wn,this.$v))));0<(this.countFloatingObjects=this.Oeg())&&r.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}Hhh(){this.Oeg();this.xYe()}Oeg(){let Oa=0;if(this.ie&&this.ie.Object)for(let Lb=0;Lb<this.ie.Object.length;Lb++)this.fik(this.ie.Object[Lb])&&Oa++;return Oa}Tsh(Oa,Lb){if(this.dK.Wc(Lb))return Lb=this.dK.getItem(Lb),Lb.yg=Oa,Lb;if(!this.wn||!this.$||!this.$v)return null;
const Fc=new Le(this.wn,this.$,this.$v);Fc.yg=Oa;this.dK.add(Lb,Fc);return Fc}fik(Oa){let Lb=!1;if((null===Oa||void 0===Oa?0:Oa.ObjectId)&&(0===Oa.ObjectType||2===Oa.ObjectType||this.qSd&&5===Oa.ObjectType))try{const Fc=this.h9h(Oa);if(Fc){const Wc=this.Tsh(Fc,Oa.ObjectId);Wc.hVb(Fc,Oa.ObjectPresenceType);5!==Oa.ObjectType&&Wc.ZUb();Zc.a&&0===Oa.ObjectType&&Wc.HI(!0);Lb=!0}}catch(Fc){throw r.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${Fc.stack}"}`),Fc;}return Lb}h9h(Oa){if(!Oa)return null;
let Lb=null;this.qSd?-1!=Oa.ObjectType&&(Lb=Xb.a(this.$).yza(Oa.ObjectId)):2===Oa.ObjectType?Lb=Xb.a(this.$).yza(Oa.ObjectId):0===Oa.ObjectType&&(Oa=this.$.Gd.mrd(Oa.ObjectId),null===Oa||void 0===Oa?0:Oa.imageId)&&(Lb=Xb.a(this.$).W$h(Oa.imageId));return Lb}S0d(){try{1===this.ie.Version?(this.ERj(),r.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.FRj(),r.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.wdd}","QueryTables":"${this.xdd}"}`))}catch(Oa){throw r.ULS.sendTraceTag(537154338,
0,10,`{"SetGridHighlight Exception":"${Oa.stack}"}`),Oa;}}rff(Oa){switch(Oa){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static hae(Oa,Lb,Fc,Wc,td,na){const Pa=1===Oa?51:50;Wc&&Fc&&Wc.name===Fc.SheetName?(Lb.sm(ya.E(Fc),[Pa]),Lb.ZUb(Pa),r.ULS.shipAssertTag(537154337,0,Lb.ex.eB===td.User.UserID,"UserID and UnitID should match"),na.ZTb(Lb.ex.eB,1===Oa)):Lb.rFb([Pa])}}Object(f.a)(te,"UserGridPresence",Qd,[]);var tb=a(50),Gb=a(811);class fd{constructor(Oa,Lb){this.Quf=
this.qCd=this.qwf=!1;this.$td=this.Uic=this.tEb=this.z8a=0;this.Fyf=!0;this.mH=Oa;this.$=Lb}vik(){this.z8a||(this.z8a=Bd.a.Kf(),this.WBa())}xik(){this.tEb||(this.tEb=Bd.a.Kf(),this.WBa())}uik(){this.Uic=Bd.a.Kf();this.XDf()}wik(Oa){this.$td=Bd.a.Kf();Oa&&(this.Quf=!0);this.XDf()}dispose(){this.mH=this.$=null}static Z9h(){return fd.Ytd}WBa(){this.z8a&&this.tEb?this.aC():window.setTimeout(()=>{this.aC()},fd.Ytd)}XDf(){this.Uic&&this.$td?this.aC(!0):window.setTimeout(()=>{this.aC(!0)},fd.Ytd)}aC(Oa=
!1){var Lb;if(Oa?!this.qCd:!this.qwf)if(this.tEb||this.z8a)if(null!==(Lb=this.$)&&void 0!==Lb&&Lb.da){Lb=this.$.da.hEb(this.mH);var Fc=this.$.da.Kp;for(var Wc of Fc)this.mH!==Wc.User.UserID&&(null===Lb||void 0===Lb?void 0:Lb.UserEmail)===(null===Wc||void 0===Wc?void 0:Wc.UserEmail)&&(this.Fyf=!1);Wc={};Wc.UserSessionId=this.$.xa.UserSessionId;Wc.ClientID=this.mH;Wc.IsUniqueUser=this.Fyf;Wc.IsUserRemovalLog=Oa;Wc.IsInactive=this.Quf;Oa||(Wc.GridPresenceTime=this.tEb,Wc.GalleryPresenceTime=this.z8a);
Wc.GridPresenceRemovalTime=this.$td;Wc.GalleryPresenceRemovalTime=this.Uic;r.ULS.sendTraceTag(508863559,0,50,`Grid Gallery presence telemetry: ${JSON.stringify(Wc)}`);Oa?this.qCd=!0:this.qwf=!0}else r.ULS.sendTraceTag(508838665,0,50,"Grid Gallery presence telemetry: EwaControl or SessionStateManager is null")}j_j(){return this.z8a&&!this.Uic}}fd.Ytd=12E4;Object(f.a)(fd,"GridGalleryPresenceTelemetry",null,[5]);class lc{constructor(Oa){this.Xtd=null;this.$=Oa;this.kY={};this.Rwb=new Set}dispose(){for(let Oa in this.kY)this.kY[Oa].dispose(),
delete this.kY[Oa];this.kY=null;this.Rwb.clear();this.$=this.Rwb=null}awg(){var Oa=this.$.da.Kp;for(var Lb of Oa)Oa=Lb.User.UserID,Oa===this.$.da.clientId||this.Rwb.has(Oa)||this.Erd(Oa).vik();for(let Fc in this.kY)this.$.da.hEb(Fc)||(Lb=this.Erd(Fc),gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7941503_LogRemovalPostPresence")&&Lb.j_j()&&(Lb.uik(),this.Ocg()))}bwg(Oa,Lb=!1,Fc=!1){Oa===this.$.da.clientId||this.Rwb.has(Oa)||(Oa=this.Erd(Oa),Lb?(Oa.wik(Fc),this.Ocg()):Oa.xik())}Erd(Oa){if(!this.kY[Oa]){const Lb=
new fd(Oa,this.$);this.kY[Oa]=Lb}return this.kY[Oa]}Ami(){for(let Oa in this.kY)this.kY[Oa].qCd&&(this.kY[Oa].dispose(),delete this.kY[Oa],this.Rwb.add(Oa)),this.Xtd=null}Ocg(){this.Xtd||m.a.isEmpty(this.kY)||(this.Xtd=t.Task.delay(fd.Z9h()).continueWith(()=>{this.Ami()}))}}Object(f.a)(lc,"GridGalleryPresenceTelemetryHelper",null,[5]);class $c extends $a.a{constructor(Oa,Lb,Fc,Wc,td=null){super();this.vx={};this.occ=this.pcc=0;this.oFd=this.Lyb=null;this.gDf=3E4;this.Xud=!1;this.Q2d=!0;this.pRd=null;
this.eOf=()=>{var na=this.Cqa;for(let Pa in na)na=Pa,this.OAe(na)?(this.euc(na,!0),delete this.Ffb[na],delete this.Cqa[na]):r.ULS.sendTraceTag(537154377,0,50,`PresenceView.OnEcsUserListChanged: pending userId=[${na}] still not updated`);this.vUb&&this.aQa.awg()};this.xOd=(na,Pa)=>{na={};na.UpdatedCount=Pa.JL?Object.keys(Pa.JL).length:0;na.DisconnectedCount=Pa.v7?Pa.v7.length:0;na.Location="canvas";aa.b(this.$).Xe(Z.a.yRd,na);na=null;this.$.Jd&&(na=this.$.Jd.Yh("ModelUpdate","PresenceRendering"),na.start());
var lb={};if(Pa.JL){if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Sd=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),ve=>{ve.result.kUi(Sd)},this.$.ka,3)}this.uBb||(this.WGd(!0),this.uBb=!0);const yd=Pa.JL;for(var Nb in yd){var xc=yd[Nb];let Sd=Nb;this.kxd[Sd]=oa.a.$a.Wd;if(!xd.i(this.$)||
null==xc.NavigationState)if(this.uPe(Sd,new Date),this.k2g(xc),Sd!==this.Lyb){var Oc=this.vx[Sd];Oc||(this.OAe(Sd)?this.euc(Sd,!0):(Sd in this.Cqa?r.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${Sd}] already pending update`):(this.Ffb[Sd]=oa.a.$a.Wd,lb[Sd]=1),this.Cqa[Sd]=!0,Oc=this.Pdi(Sd),this.vx[Sd]=this.QUe(Oc)),Oc=this.vx[Sd],this.vUb&&this.aQa.bwg(Sd));Oc&&(Oc.ie=xc,xc.SelectedRange&&1<xc.SelectedRange.length?this.pcc++:this.occ++,this.P6f(Sd),this.h5a(Oc))}}if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&
this.$.da&&this.$.da.pQa){const Sd=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),ve=>{ve.result.lUi(Sd)},this.$.ka,3)}}if(Pa.v7)for(let yd=0,Sd=Pa.v7.length;yd<Sd;yd++)Nb=Pa.v7[yd],this.Wgd[Nb]=oa.a.$a.Wd,this.F6f(Nb,!0);if(Pa.v7&&0<Pa.v7.length||0<Gb.a(lb).length||0<Gb.a(this.Cqa).length)Nb=[],Nb.push(...Gb.a(lb)),Nb.push(...Gb.a(this.Cqa)),
(lb=this.$.ea.Ba(292))&&lb.Glb(Nb,Pa.v7);na&&na.stop();this.Xud=!1;na=this.vx;for(let yd in na)if(0===Object(u.a)(Qd,na[yd]).ie.CollabMode){this.Xud=!0;break}this.raiseEvent("pcek",Pa)};this.GGa=(na,Pa)=>{Pa&&this.$.Zs&&(Pa.vub.HasAnyNonOcsCoauthor=this.Xud)};this.FNb=()=>{const na=new bb.a({},null),Pa=this.lta;for(let lb in Pa){const Nb=lb,xc=Pa[lb].ie;xc.SelectedRange=xc.SelectedRangeRaw;na.JL[Nb]=xc}this.xOd(this,na)};this.df=()=>{this.Glf()};this.nVi=()=>{this.oFd&&Xa.a(oa.a.$a,this.oFd)<this.gDf||
(this.oFd=oa.a.$a.Wd,this.xGd(),this.cSi(),this.NSi(),this.uBb||this.WGd(!1))};this.fDa=()=>{this.Glf();const na=this.vx;for(let Pa in na)this.h5a(na[Pa])};this.oe=()=>{this.xGd();this.uBb||this.WGd(!1);this.uBb=!1};this.ESf=()=>{const na=this.vx;for(let Pa in na)na[Pa].dispose();this.vx={};this.JNe();this.Ffb={};this.DZc={};this.xA.length=0;this.ZHc()};this.uga=(na,Pa)=>{this.R5d(Pa.ti)};this.Wgd={};this.kxd={};this.Ffb={};this.DZc={};this.$=Oa;this.sTa=Wc;this.Wm=Lb;this.Yue=Fc;fe.a.CUb=!0;fe.a.asa=
!0;this.s$a();this.$v=new zd.a(Oa);this.$.va&&this.$.va.Fi(this.fDa);this.Wm.Stb(this.uga);Oa.pa&&this.$.pa.Ika(this.GGa);this.xA=[];this.Wm.f5a();Oa.ea.Ja(25,this);this.uBb=!1;this.$.sk(this.oe);this.I7c=Mb.a.instance.pF(this.nVi,this.gDf/2,zb.a.Uoj,!0,!1);this.qRd=td;this.G7g=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7736608_AvoidLoggingForInactiveUser");if(this.vUb=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7958832_LogGridGalleryPresenceTelemetryNew"))this.aQa=this.rrh(),this.aQa.awg()}AKa(Oa){this.addHandler("pcek",
Oa)}iEa(Oa){this.removeHandler("pcek",Oa)}get YN(){return this.Yue}get lta(){return this.vx}isAnonymousUser(Oa){var Lb,Fc;return null===(Fc=null===(Lb=this.lta[Oa])||void 0===Lb?void 0:Lb.ie)||void 0===Fc?void 0:Fc.IsAnonymous}R6f(Oa){this.lta[Oa]&&this.F6f(Oa,!1)}R5d(Oa){this.Lyb&&this.Lyb!==Oa.clientId&&(this.Q2d=!1);!gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.da.pQa&&tb.PageLoadTrackingInfo.instance.bPj||(this.Q2d=!1);this.YN.Plh(Oa);this.Lyb=Oa.clientId}gai(Oa,
Lb){let Fc,Wc;Fc=[];Wc=[];const td=this.lta;for(let na in td){const Pa=td[na];if(Lb){const lb=ya.k(Oa,this.$);this.ljf(lb,Fc,Wc,Pa)}else this.kjf(Oa,Fc,Wc,Pa)}return{Lzi:Fc,sEh:Wc}}oXe(Oa,Lb,Fc,Wc,td){(td=this.lta[td])&&(Lb?this.ljf(Oa,Fc,Wc,td):this.kjf(Oa,Fc,Wc,td))}hli(){const Oa=[],Lb=this.lta;for(let td in Lb){var Fc=Lb[td],Wc=Fc.ie.SelectedRange;if(Wc)for(const na of Wc){Wc=ya.E(na);const Pa=Ac.h(this.$).ha.ra.g8;if(this.$.va.na.sheetName===na.SheetName&&Wc.right===Pa.right&&Wc.top===Pa.top){Fc=
Fc.wn;Fc=new Zb.a(Fc.User.UserID,Fc.User.UserName,Fc.UserColor,new Gc.a(1),null,Fc.UserEmail,void 0,void 0,void 0,void 0,void 0,Fc.JoinCoauthTime);Oa.push(Fc);break}}}return Oa}WHc(){fe.a.CUb=!0;fe.a.asa=!0;const Oa=this.vx;for(let Lb in Oa)Oa[Lb].WHc()}inc(){fe.a.CUb=!1;fe.a.asa=!1;const Oa=this.vx;for(let Lb in Oa)Oa[Lb].inc()}dispose(){this.dXb();this.$&&(this.$.va&&this.$.va.hj(this.fDa),this.$.pa&&this.$.pa.cra(this.GGa),this.$.Ym(this.oe));this.Wm&&this.Wm.HCc(this.uga);this.I7c&&(this.I7c.dispose(),
this.I7c=null);if(this.vx){const Oa=this.vx;for(let Lb in Oa)Oa[Lb].dispose()}this.vUb&&this.aQa&&(this.aQa.dispose(),this.aQa=null);Ob.a.te([this.YN,this.$v]);this.JNe();this.vx=this.$=this.Yue=null;this.xA.length=0;super.dispose()}get Cqa(){return this.DZc}rrh(){return new lc(this.$)}dXb(){this.YN&&(this.YN.iEa(this.xOd),this.YN.yBj(this.eOf),this.YN.bDj(this.ESf),this.YN.vr(this.df));this.sTa.O7f(this.FNb)}QUe(Oa){return new te(Oa,this.$,this.$v)}OAe(Oa){const Lb=this.$.da.hEb(Oa);if(Lb)if(Oa in
this.vx)this.vx[Oa].Ewg(Lb);else{const Fc=this.QUe(Lb);this.vx[Oa]=Fc;this.h5a(Fc)}return!!Lb}ljf(Oa,Lb,Fc,Wc){if(Oa)for(const td of Oa){if(td){if((Oa=eb(td,this.$,1))&&$c.wtd(Oa.ul,Lb,Fc,Wc))break;if((Oa=eb(td,this.$,2))&&$c.wtd(Oa.ul,Lb,Fc,Wc))break}if(Wc.ie.SelectedRange)for(const na of Wc.ie.SelectedRange)if(na&&td&&vb(td,na)){(1===Wc.ie.PresenceType?Fc:Lb).push(Wc.MC.VXb.User);return}}}kjf(Oa,Lb,Fc,Wc){Oa&&$c.wtd(this.n9h(Oa),Lb,Fc,Wc)}k2g(Oa){Oa.SelectedRange&&(Oa.SelectedRangeRaw=this.yxh(Oa.SelectedRange),
Oa.SelectedRange=this.sTa.ynh(Oa.SelectedRange))}yxh(Oa){const Lb=Array(Oa.length);for(let td=0;td<Oa.length;td++){var Fc=td,Wc=Oa[td];const na={};na.SheetName=Wc.SheetName;na.FirstColumn=Wc.FirstColumn;na.FirstRow=Wc.FirstRow;na.LastRow=Wc.LastRow;na.LastColumn=Wc.LastColumn;na.NamedObjectName=Wc.NamedObjectName;Lb[Fc]=na}return Lb}n9h(Oa){if(Oa)switch(Oa.type){case 0:return(Oa=this.$.Gd.qff(Oa.id))?Oa.ul:null;case 2:return Oa.ul}return null}s$a(){this.YN.AKa(this.xOd);this.YN.z0g(this.ESf);this.YN.xZg(this.eOf);
this.YN.cr(this.df);this.sTa.ECe(this.FNb)}EDf(Oa,Lb,Fc,Wc){const td={};td.a=this.$.xa.UserSessionId;td.b=Oa;td.c=Fc?"PendingUserRemoved":"Non-PendingUserRemoved";td.d=Wc?"Disconnected":"Inactivity";td.e=Lb;Bc.b().Wg(22,td,!0)}F6f(Oa,Lb){Oa in this.vx&&(this.P6f(Oa),this.vx[Oa].dispose(),delete this.vx[Oa],r.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${Oa}] removed due to inactivity`),this.EDf(Oa,oa.a.$a.Wd,!1,Lb));Oa in this.Cqa&&(this.euc(Oa,!1),delete this.Ffb[Oa],
delete this.Cqa[Oa],r.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${Oa}] removed due to inactivity`),this.EDf(Oa,oa.a.$a.Wd,!0,Lb));this.vUb&&this.aQa.bwg(Oa,!0,!Lb)}P6f(Oa){for(let Lb=this.xA.length-1;0<=Lb;Lb--)if(this.xA[Lb].User.UserID===Oa){this.xA.splice(Lb,1);for(const Fc of this.vx[Oa].RA)this.$v.Nra(Fc.ex.eB,!1);this.ZHc()}}NSi(){if(this.occ||this.pcc)this.$.Fe(-70383382,-1,0,null),r.ULS.sendTraceTag(537154373,0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.pcc}], Continuous Presence Received with count= [${this.occ}]`);
this.pcc=this.occ=0}JNe(){this.xGd();this.DZc=this.Ffb=null}xGd(){const Oa=this.Cqa;for(let Lb in Oa)this.euc(Lb,!1)}cSi(){var Oa=this.Wgd;for(let Lb in Oa)this.mDf(Lb,!0,Oa[Lb]);Oa=this.kxd;for(let Lb in Oa)this.mDf(Lb,!1,Oa[Lb]);this.Wgd={};this.kxd={}}fs(Oa){var Lb;return(null===(Lb=this.Wm)||void 0===Lb?0:Lb.ti)?(Oa=this.Wm.ti.Ona(Oa),1===(null===Oa||void 0===Oa?void 0:Oa.status)):!1}euc(Oa,Lb){var Fc=this.G7g?this.fs(Oa):!0;if(this.$.Zs&&this.$.da.Zd&&Fc){Fc={};Fc.a=this.$.xa.UserSessionId;Fc.b=
Oa;Fc.c=Lb;Fc.e=!1;Fc.d=-1;Fc.f=oa.a.$a.Wd;this.$.da&&(Fc.e=this.$.da.vP);if(Oa=this.Ffb[Oa])Fc.d=Xa.a(oa.a.$a,Oa);Bc.b().Wg(20,Fc,!0)}}WGd(Oa){if(this.$.Zs){const Lb={e:-1,f:-1,c:!1,d:!1};Lb.b=Oa;Lb.a=this.$.xa.UserSessionId;this.$.da&&(Lb.c=this.$.da.pQa,Lb.d=this.$.da.vP,Lb.e=this.$.da.Kp.length,this.$.da.LGa&&(Lb.f=Xa.a(oa.a.$a,this.$.da.wpk)));Bc.b().Wg(21,Lb,!0)}}mDf(Oa,Lb,Fc){if(this.$.Zs){const Wc={};Wc.a=this.$.xa.UserSessionId;Wc.b=Oa;Wc.c=Lb;Wc.d=Fc;Bc.b().Wg(19,Wc,!0)}}Glf(){const Oa=
[],Lb=this.vx;for(let Fc in Lb){const Wc=Lb[Fc];if(this.YN.Jdg(Wc.ie)){this.BBe(Oa,Wc);Array.remove(this.xA,Wc.MC.VXb);if(1===this.YN.ie.PresenceType){const td={};td.a=1===Wc.ie.PresenceType?"Editing":"Non-Editing";td.b=this.$.xa.UserSessionId;td.c=oa.a.$a.Wd;Bc.b().Wg(18,td)}for(const td of Wc.RA)this.$v.Nra(td.ex.eB,!0)}else for(const td of Wc.RA)this.$v.Nra(td.ex.eB,!1)}this.xA.length=0;this.xA=Oa;this.ZHc()}BBe(Oa,Lb){const Fc=Lb.MC.VXb;if(0===Lb.ie.PresenceType){Lb=Oa.length;let Wc;for(Wc=0;Wc<
Lb&&0===this.vx[Oa[Wc].User.UserID].ie.PresenceType;Wc++);Oa.splice(Wc,0,Fc)}else Oa.push(Fc)}h5a(Oa){this.YN.Jdg(Oa.ie)&&(this.BBe(this.xA,Oa),this.ZHc());const Lb=Oa.MC.VXb.User.UserID,Fc=this.vx;for(let td in Fc){var Wc=Fc[td];td!==Lb&&Oa.h5a(Wc)}}ZHc(){0<this.xA.length&&this.s2j()}s2j(){for(let Oa=0,Lb=this.xA.length;Oa<Lb;Oa++){const Fc=this.vx[this.xA[Oa].User.UserID];if(Fc)if(this.YN.A2f(Fc.ie)){Fc.Zlg(!0);for(const Wc of Fc.RA)this.$v.Nra(Wc.ex.eB,!0)}else{const Wc=this.YN.qef(Fc.ie);Wc&&
Fc.$lg(!0,Wc)}}}Pdi(Oa){const Lb={User:{}};Lb.User.UserID=Oa;Lb.User.UserName=bc.a.instance.gd(87);Lb.UserColor="#AAAAAA";return Lb}uPe(Oa,Lb){this.Q2d&&this.qRd&&(Oa&&Lb?this.pRd?this.pRd.sGh(Oa,Lb,this.Lyb):this.qRd.continueWith(()=>{this.pRd=this.qRd.result;this.uPe(Oa,Lb)}):r.ULS.sendTraceTag(537154372,0,15,`userId: [${Oa}], endTime: [${Lb}]`))}static wtd(Oa,Lb,Fc,Wc){if(!Wc||!Wc.ie||!Wc.ie.Object)return!1;for(const td of Wc.ie.Object)if(Oa&&td&&td.ObjectId&&!td.ObjectId.localeCompare(Oa))return(1===
td.ObjectPresenceType?Fc:Lb).push(Wc.MC.VXb.User),!0;return!1}}Object(f.a)($c,"PresenceView",$a.a,[748,749]);var Md;(function(Oa){Oa[Oa.chart=0]="chart";Oa[Oa.image=1]="image";Oa[Oa.slicer=2]="slicer";Oa[Oa.modernOfficeExtension=3]="modernOfficeExtension";Oa[Oa.interactiveReport=4]="interactiveReport";Oa[Oa.shape=5]="shape";Oa[Oa.cardView=6]="cardView";Oa[Oa.group=7]="group";Oa[Oa.ink=8]="ink";Oa[Oa.E1O=9]="E1O";Oa[Oa.unknown=99]="unknown";Oa[Oa.unsupported=100]="unsupported"})(Md||(Md={}));Object(f.b)("FloatingObjectType",
Md);var dd=a(237),ee=a(328),Tc=a(31);class wd extends $a.a{constructor(Oa){super();this.statusBarManager=null;this.$=Oa;this.$.ea.Zc(29,Lb=>{this.statusBarManager=Lb;Lb.gM(this)})}Ks(Oa){this.addHandler("OSC",Oa)}ot(Oa){this.removeHandler("OSC",Oa)}fC(){this.raiseEvent("OSC")}Du(Oa,Lb){if("QueryOcsConnectionStatus"===Oa)Oa=this.$.da.Ybb?bc.a.instance.ia(924):bc.a.instance.ia(925),Tc.a.Fo()?(Lb.LabelText=Oa,Lb.Visible=!0):Lb.Value=Oa;else return!1;return!0}Jp(){return!0}dispose(){this.statusBarManager&&
(this.statusBarManager.yI(this),this.statusBarManager=null);this.$=null;super.dispose()}}Object(f.a)(wd,"OcsStatusBarManager",$a.a,[5,187,188]);class Kb extends $a.a{constructor(Oa,Lb){super();this.Gqg=this.Hqg=this.ti=null;this.Tzc=this.fDf=this.WMc=this.leg=!1;this.Lp=()=>{this.$&&this.E_d(0,!1)};this.dk=()=>{this.Q7d?this.Hqg(!1):(this.ie.PresenceType=1,this.raiseEvent(Kb.saa),this.sendPresenceToService(!1))};this.kj=()=>{this.Q7d?this.Gqg(!1):(this.Aib(!1),this.z_d())};this.FOf=()=>{this.ha.Va.Yd?
this.E_d(1,!1):this.J_d(0,!1)};this.nqa=(Fc,Wc)=>{this.raiseEvent(Kb.rRd,Wc)};this.df=()=>{this.J_d(Ac.h(this.$).Xc?1:0,!1)};this.Qe=(Fc,Wc)=>{dd.a(Wc)&&(this.pva={})};this.FNb=()=>{this.Tdg()};this.jWf=(Fc,Wc)=>{if(Wc&&Wc.methodName in Kb.Vzc){Fc=!1;switch(Kb.Vzc[Wc.methodName]){case 0:Wc=Wc.parameters.cell;break;case 1:Wc=Wc.parameters.parameters.Location;break;case 2:Wc=ya.v(this.ha.ra.activeRange,this.$);Fc=!0;break;default:return}Wc.LastColumn=Wc.FirstColumn;Wc.LastRow=Wc.FirstRow;Wc.NamedObjectName=
null;this.ie.SelectedRange=[Wc];this.ie.PresenceType=0;if(Fc){Wc=[];for(var td of this.$.Gd.nci())Fc={},Fc.ObjectType=this.Lea(td.type),Fc.ObjectPresenceType=1,Fc.ObjectId=td.ul,Wc.push(Fc);this.ie.Object=Wc}else td=eb(Wc,this.$,1),Wc=null,td&&(Wc={},Wc.ObjectType=this.Lea(td.type),Wc.ObjectPresenceType=0,Wc.ObjectId=td.ul),this.ie.Object=[Wc];this.raiseEvent(Kb.saa);this.sendPresenceToService(!1)}};this.Jo=(Fc,Wc)=>{Wc.context.methodName in Kb.Vzc&&(this.ie.Object=[null],this.Aib(!1))};this.lj=(Fc,
Wc)=>{Wc.context.methodName in Kb.Vzc&&(this.ie.Object=[null],this.Aib(!1))};this.kf=(Fc,Wc)=>{Wc.fQ||(this.pva={},this.$.Zs?this.s$a():this.dXb())};this.oe=()=>{this.Tzc&&this.cDf();this.z_d()};this.Myf=()=>{this.Tdg();this.pKf.fC()};this.$=Oa;this.ha=Ac.h(this.$).ha;this.sTa=Lb;this.$.Pm(this.kf);this.$.sk(this.oe);this.pva={};this.l1a=new Zb.a(null,null,null,null);this.LEa={};this.LEa.b=0;this.LEa.c=0;this.pKf=new wd(this.$);this.Q7d=gb.EwaSettings.rd();this.y8e=60*gb.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.FloatingObjectLogInterval",
10);this.Xya={};this.Q7d&&(this.Hqg=ee.b(Fc=>{this.ie.PresenceType=1;this.raiseEvent(Kb.saa);this.sendPresenceToService(Fc)},40,this.$.ka,"SelectionPresenceManager.SendPresenceToService",!0),this.Gqg=ee.b(Fc=>{this.Aib(Fc);this.z_d()},40,this.$.ka,"SelectionPresenceManager.SendCurrentPresence",!0));this.leg=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence");this.WMc=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2");this.fDf=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7808895_LogFloatingObjectSelection");
(this.Tzc=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7941790_LogFloatingObjectSelectionsPeriodically"))&&this.y8e&&this.cTi(this.y8e)}AKa(Oa){this.addHandler(Kb.rRd,Oa)}iEa(Oa){this.removeHandler(Kb.rRd,Oa)}xZg(Oa){this.$.da.Nca(Oa)}yBj(Oa){this.$.da.faa(Oa)}cr(Oa){this.addHandler(Kb.saa,Oa)}vr(Oa){this.removeHandler(Kb.saa,Oa)}z0g(Oa){this.addHandler(Kb.sRd,Oa)}bDj(Oa){this.removeHandler(Kb.sRd,Oa)}get ie(){return this.pva}get amIAlone(){return!this.$.da||this.$.da.amIAlone}dispose(){this.$&&
(this.dXb(),this.$.Rn(this.kf),this.$.Ym(this.oe));this.ti&&this.ti.TVa(this.nqa);Ob.a.Ma(this.pKf);this.$=this.ti=null;super.dispose()}Plh(Oa){this.ti?this.ti.TVa(this.nqa):this.s$a();(this.ti=Oa)?(this.ti.b3a(this.nqa),this.Aib(!0)):this.dXb()}s$a(){this.ha.cr(this.df);Ac.h(this.$).XG(this.Lp);var Oa=Ac.h(this.$).Vd;Oa.yq(this.kj);Oa.yp(this.dk);this.$.da.Pl(this.Qe);this.$.da.rCe(this.Myf);this.sTa.ECe(this.FNb);Oa=this.$.pa.ua;Oa.BKa(this.jWf);Oa.Ht(this.lj);Oa.Pz(this.Jo);this.$.ea.Zc(16,Lb=>
{Lb.KZg(this.FOf);Lb.JZg(this.kj)})}dXb(){this.ha.vr(this.df);Ac.h(this.$).zI(this.Lp);const Oa=Ac.h(this.$).Vd;Oa.Pp(this.kj);Oa.lp(this.dk);this.$.da.Vl(this.Qe);this.$.da.D7f(this.Myf);this.sTa.O7f(this.FNb);this.$.pa.ua.UVa(this.jWf);this.$.pa.ua.Uu(this.lj);this.$.pa.ua.UA(this.Jo);this.$.ea.Zc(16,Lb=>{Lb.HBj(this.FOf);Lb.GBj(this.kj)});this.raiseEvent(Kb.sRd)}Jdg(Oa){return this.A2f(Oa)||!!this.qef(Oa)}A2f(Oa){if(2===this.ie.Version&&this.ie.Object&&2===Oa.Version&&Oa.Object&&0<this.ie.Object.length&&
0<Oa.Object.length){var Lb=this.ie.Object.length,Fc=Oa.Object.length;for(var Wc=0;Wc<Lb;Wc++)for(var td=0;td<Fc;td++)if(this.n7c(this.ie.Object[Wc],Oa.Object[td]))return!0}if(this.ie.SelectedRange&&Oa.SelectedRange)for(Lb=this.ie.SelectedRange.length,Fc=Oa.SelectedRange.length,Wc=0;Wc<Lb;Wc++)for(td=0;td<Fc;td++)if(Kb.o5g(this.ie.SelectedRange[Wc],Oa.SelectedRange[td]))return!0;return!1}qef(Oa){if(2===this.ie.Version&&this.ie.Object&&2===Oa.Version&&Oa.Object&&0<this.ie.Object.length&&0<Oa.Object.length){const Lb=
this.ie.Object.length,Fc=Oa.Object.length;for(let Wc=0;Wc<Lb;Wc++)for(let td=0;td<Fc;td++)if(Kb.$2i(this.ie.Object[Wc],Oa.Object[td]))return this.ie.Object[Wc].ObjectId}return null}n7c(Oa,Lb){return!!Oa&&!!Lb&&Oa.ObjectType===Lb.ObjectType&&(1===Oa.ObjectType||3===Oa.ObjectType)&&!!Oa.ObjectId&&!!Lb.ObjectId&&!Oa.ObjectId.localeCompare(Lb.ObjectId)}Tdg(){this.Aib(!1)}Aib(Oa){this.ha.Va.Yd?this.E_d(0,Oa):this.J_d(Ac.h(this.$).Vd.Xc?1:0,Oa)}E_d(Oa,Lb){var Fc={};this.$.wl(Fc);var Wc=this.ha.Va.Yd;if(Wc){const td=
Wc.floatingObject;Fc.FirstColumn=-1;Fc.FirstRow=-1;Fc.LastColumn=-1;Fc.LastRow=-1;Fc.NamedObjectName=td?td.Ji():null;this.ie.SelectedRange=[Fc];this.ie.PresenceType=0;Fc=null;if(this.leg){if(null===td||void 0===td?0:td.id)Fc={ObjectType:this.xei(td.type),ObjectPresenceType:Oa,DialogType:0,ObjectId:Wc.ul}}else if(td)switch(td.type){case 0:if(Wc=this.$.Gd.qff(td.id))Fc={},Fc.ObjectType=this.Lea(0),Fc.ObjectPresenceType=Oa,Fc.ObjectId=Wc.ul;break;case 2:td.id&&(Fc={},Fc.ObjectType=this.Lea(9),Fc.ObjectPresenceType=
Oa,Fc.ObjectId=td.ul)}this.ie.Object=[Fc];this.Tzc&&this.Xya&&0<=(null===td||void 0===td?void 0:td.type)&&(Oa=Md[td.type],this.Xya[Oa]=void 0===this.Xya[Oa]?1:this.Xya[Oa]+1);this.fDf&&0<=(null===td||void 0===td?void 0:td.type)&&r.ULS.sendTraceTag(508913565,0,50,`FloatingObjectPresence {"SelectedFloatingObjectType":"${td.type}",
              "SelectedFloatingObjectName":"${Md[td.type]}"}`)}this.raiseEvent(Kb.saa);this.sendPresenceToService(Lb)}J_d(Oa,Lb){if(!Ac.h(this.$).Xc&&!Ac.h(this.$).Jk){const Wc=this.$.Jd.Yh("ModelUpdate","SendRangePresence");Wc.start();var Fc=ya.k(this.ha.ra.selectedRanges,this.$);this.ie.SelectedRange=this.sTa.xnh(Fc);this.ie.Object=[];for(const td of Fc)if(Fc=eb(td,this.$,1)){const na={};na.ObjectType=this.Lea(Fc.type);na.ObjectPresenceType=0;na.ObjectId=Fc.ul;this.ie.Object.push(na)}this.ie.PresenceType=
Oa;this.raiseEvent(Kb.saa);this.ie.SelectedRange||this.ie.Object?this.sendPresenceToService(Lb):r.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.ti.clientId}]`);Wc.stop()}}sendPresenceToService(Oa){if(this.$.da.Lfc||!this.$.da.Fbc||Oa)if(this.amIAlone||++this.LEa.b,this.ti){this.ie.Version=2;this.ie.ClientType=1;this.ie.ChatThreadId=this.l1a.bad;this.ie.ChatThreadDiscoveryUri=this.l1a.$$c;
this.ie.InChat=this.l1a.OFb;this.ie.Cid=this.l1a.email;this.ie.SupportsChat=!!this.l1a.capabilities&&this.l1a.capabilities.lQa(4);this.ie.CollabMode=this.$.da.Ybb?2:0;this.ie.OcsCapable=this.$.da.ocsCapable;this.WMc&&(this.ie.IsAnonymous=v.AFrameworkApplication.userNameUnknown||v.AFrameworkApplication.limitedEdit);this.ti.ieg(this.ie);if(gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.da&&this.$.da.pQa){const Lb=(new Date).getTime();hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",
!1)?Object(pb.d)(La.a.resolve(Ta.ec,{Qa:1})):wa.GetServiceTaskFactory.Vc(this.$.ea,435,436,1),Fc=>{Fc.result.mUi(Lb)},this.$.ka,3)}this.amIAlone||++this.LEa.c}}z_d(){this.$.Zs&&(this.LEa.a=this.$.xa.UserSessionId,Bc.b().Wg(26,this.LEa,!0));this.LEa.b=0;this.LEa.c=0}xei(Oa){switch(Oa){case 0:return 0;case 2:return 2;case 5:return 5;default:return-1}}Lea(Oa){switch(Oa){case 0:return 0;case 1:return 1;case 2:return 3;case 9:return 2;default:return-1}}static get Vzc(){return Kb.vse||(Kb.vse={["ApplyFilter"]:1,
["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static $2i(Oa,Lb){return!!Oa&&!!Oa.ObjectId&&!!Lb&&!!Lb.ObjectId&&(0===Oa.ObjectType||2===Oa.ObjectType)&&Oa.ObjectType===Lb.ObjectType&&!Oa.ObjectId.localeCompare(Lb.ObjectId)}static o5g(Oa,Lb){return!Oa.NamedObjectName&&vb(Oa,Lb)}cDf(){this.Xya&&0<Object.keys(this.Xya).length&&r.ULS.sendTraceTag(508822753,
0,20,`PresenceFloatingObjectSelections: ${JSON.stringify(this.Xya)}`);this.Xya={}}cTi(Oa){const Lb=()=>{this.cDf();Mb.a.instance.create(Lb,1E3*Oa,"FloatingObjectPresence.logFOSelectionsAtSpecifiedInterval",void 0,!0)};Lb.call(this)}}Kb.rRd="presenceChanged";Kb.sRd="presenceDisabled";Kb.saa="selectionChanged";Kb.vse=null;Object(f.a)(Kb,"SelectionPresenceManager",$a.a,[764,5,765]);var Vc=a(86);class Hd extends Hb.a{constructor(Oa){super();this.manager=null;this.$=Oa;this.Md()}create(){this.manager?
this.qd(this.manager):hb.TaskExtensions.ya(Object(Vc.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService")?Object(pb.d)(La.a.resolve(Ta.Gb,{Qa:this.Na})):wa.GetServiceTaskFactory.create(this.$.ea,28,this.ka,this.Na),Oa=>{this.qd(this.manager||(this.manager=new Kb(this.$,Oa.result)))},this.ka,3)}}Object(f.a)(Hd,"SelectionPresenceManagerFactory",Hb.a,[]);var Xd=a(1202),qe=a(7),$d=a(203);class de extends Xc.a{constructor(Oa,Lb,Fc){super();this.QUa=this.tRd=null;this.ONb=(Wc,td)=>{if(td.JL){Wc=
[];const Pa=[];var na=Ac.h(this.$).ha;const lb=!(2===na.ng||128===na.ng);na=lb?ya.k(na.ra.selectedRanges,this.$):na.Va.Yd.floatingObject;td=td.JL;for(let xc in td)this.presenceView.oXe(na,lb,Wc,Pa,xc);for(const xc of this.YMa)Wc.includes(xc)||Pa.includes(xc)||this.presenceView.oXe(na,lb,Wc,Pa,xc.UserID);this.YMa=[];this.YMa.push(...Wc);this.YMa.push(...Pa);this.tRd&&(Ob.a.Ma(this.QUa),this.tRd=this.QUa=null);const Nb=de.TJe(Wc,Pa);this.QUa=new $d.a;this.tRd=hb.TaskExtensions.ya(t.Task.delay(1),()=>
{this.ariaLiveNotifier.kVa(Nb,qe.a.Iwa)},this.QUa.token,3)}};this.$=Lb;this.ariaLiveNotifier=Oa;this.presenceView=Fc;this.YMa=[];Fc.AKa(this.ONb);this.$.ea.Ja(231,this)}sef(Oa,Lb){this.YMa=[];({Lzi:Oa,sEh:Lb}=this.presenceView.gai(Oa,Lb));this.YMa.push(...Oa);this.YMa.push(...Lb);return de.TJe(Oa,Lb)}dispose(){this.presenceView.iEa(this.ONb);this.QUa&&(Ob.a.Ma(this.QUa),this.QUa=null);super.dispose()}static TJe(Oa,Lb){return Oa.length||Lb.length?Lb.length?1===Lb.length?String.format(bc.a.instance.gd(83),
Lb[0].UserName):String.format(bc.a.instance.gd(84),Lb.length):1===Oa.length?String.format(bc.a.instance.gd(85),Oa[0].UserName):String.format(bc.a.instance.gd(86),Oa.length):""}}Object(f.a)(de,"PresenceReadoutHandlerService",Xc.a,[755]);const le=(Oa,Lb,Fc,Wc,td,na,Pa,lb=null)=>{lb=Oa.Ra(1,lb);lb.Id=Lb;lb.OnBehalfOfOcs=Fc;return Za.g(Oa,"CheckPersistedContentUpdate",lb,Wc,td,na,Pa,516)},$b=(Oa,Lb,Fc,Wc,td,na,Pa,lb=null)=>{lb=Oa.Ra(1,lb);lb.clientIdsToAdd=Lb;lb.clientIdsToRemove=Fc;return Za.g(Oa,"UpdatePresenceUsers",
lb,Wc,td,na,Pa,0)},wc=(Oa,Lb,Fc,Wc,td,na=null)=>{na=Oa.Ra(1,na);return Za.g(Oa,"CheckWorkbookFileNameUpdate",na,Lb,Fc,Wc,td,0)},gd=(Oa,Lb,Fc,Wc,td,na,Pa,lb=null)=>{lb=Oa.Ra(1,lb);lb.GenerateNotifications=Lb;lb.DownloadNotifications=Fc;return Za.g(Oa,"UploadLatencyTelemetry",lb,Wc,td,na,Pa,128)};class Ud{constructor(Oa){this.$=Oa}U$e(Oa){return Oa}mYf(Oa){return le(this.$.pa.ua,Oa.Cwh,Oa.Nwc,Oa.MI,null,null,null)}bEe(Oa,Lb){if(!Lb)return Oa;if(!Oa)return r.ULS.shipAssertTag(537154133,0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),
Lb;Oa.Nwc=Lb.Nwc&&Oa.Nwc;return Oa}}Object(f.a)(Ud,"CheckPersistedActionAggregationPerformer",null,[751,752]);class ne{}Object(f.a)(ne,"RevisionGeneratedNotification",null,[]);class rc{}Object(f.a)(rc,"StateDownloadedNotification",null,[]);var kd=a(214);class qd extends Xc.a{constructor(Oa){super();this.mergeSuspensionManager=this.Mf=null;this.gBa=!1;this.bQd=null;this.xJc=this.wJc=this.yJc=this.Ef=!1;this.gOb=(Lb,Fc)=>{this.gBa!==Fc.gBa&&(this.bQd=(this.gBa=Fc.gBa)?null:oa.a.$a.Wd)};this.kf=()=>
{this.$.Zs&&this.l7j()};this.Qe=(Lb,Fc)=>{Fc.Zd||this.Nt(Lb,Fc)};this.Nt=()=>{if(0<this.vEa.length||0<this.bia.count)r.ULS.sendTraceTag(537154128,13,15,`Dropping ${this.vEa.length} revisionGeneratedNotifications and ${this.bia.count} stateDownloadedNotifications.`),this.vEa=[],this.bia=new kd.a;this.jvb.cancel();this.Oug();this.m$d();this.vgk()};this.gTf=(Lb,Fc)=>{this.j7j();this.k7j();Lb=new ne;Lb.Xluid=Fc.ul;Lb.NotificationReceivedOn=oa.a.$a.Wd.toISOString();Lb.CurrentPresenceUserCount=this.$.da.Kp.length;
Lb.OurCollabModeIsUsingOcs=this.$.da.Ybb;Lb.SenderCollabMode=Fc.rOj;Lb.SenderClientType=Fc.qOj;Lb.SessionSiteIdentifier=Fc.zaa;Lb.CommandTimeInMs=Fc.Pjh;r.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(Lb)}`);this.vEa.push(Lb)};this.Uj=()=>{this.oSe(this.$.da.mg,"OnBlockCacheConsistent")};this.kTf=(Lb,Fc)=>{(Lb=Object(u.a)(754,Fc.fg))&&this.oSe(Lb.oM,"OnRenderedContent")};this.flk=()=>{if(!this.$.da.Zd)r.ULS.sendTraceTag(537154122,
13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");else if(this.vEa.length||this.bia.count){var Lb=null;0<this.vEa.length&&(Lb=this.vEa,this.vEa=[]);var Fc=null;if(0<this.bia.count){Fc=Array(this.bia.count);let Wc=0;for(let td of this.bia.values)Fc[Wc++]=td;this.bia=new kd.a}r.ULS.sendTraceTag(537154120,13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${Lb?Lb.length:0} revisionGeneratedNotifications and ${Fc?Fc.length:0} stateDownloadedNotifications.`);
gd(this.$.pa.ua,Lb,Fc,this.hhj,null,null,null)}};this.hhj=Lb=>{Lb.Result&&0<Lb.Result&&this.EId()};this.$=Oa;this.za=Ac.h(this.$).za;this.viewport=Ac.h(this.$).view;this.contentRefreshManager=this.$.ea.Ba(292);this.Ig=this.$.Ig;this.vEa=[];this.bia=new kd.a;this.jvb=Mb.a.instance.pF(this.flk,3E4,zb.a.umh,!1,!1);this.$.Pm(this.kf);this.$.da.Pl(this.Qe);this.$.da.O5c(this.Nt);gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",!1)?void La.a.resolve(Ta.K).then(Lb=>
{this.Mf=Lb}):this.$.ea.Zc(291,Lb=>{this.Mf=Lb});this.$.ea.Zc(343,Lb=>{this.Ef||(this.mergeSuspensionManager=Lb,this.mergeSuspensionManager.P7b(this.gOb),this.mergeSuspensionManager.QPb())});r.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");this.kf(this.$,null)}dispose(){this.Ef=!0;this.jvb&&(this.jvb.dispose(),this.jvb=null);this.contentRefreshManager&&(this.Oug(),this.contentRefreshManager=null);this.za&&(this.m$d(),this.za=null);this.viewport&&(this.m$d(),this.viewport=null);
this.Ig&&(this.Ig=null);this.$&&(this.$.Rn(this.kf),this.$.da.Vl(this.Qe),this.$.da.Y7f(this.Nt),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.iDc(this.gOb),this.mergeSuspensionManager=null);super.dispose()}l7j(){this.yJc||(this.contentRefreshManager.I0g(this.gTf),this.yJc=!0,this.jvb.ps())}Oug(){this.yJc&&(this.contentRefreshManager.hDj(this.gTf),this.yJc=!1)}j7j(){this.wJc||(this.za.su(this.Uj),this.wJc=!0)}m$d(){this.wJc&&(this.za.eu(this.Uj),this.wJc=!1)}k7j(){this.xJc||
(this.viewport.J0g(this.kTf),this.xJc=!0)}vgk(){this.xJc&&(this.viewport.kDj(this.kTf),this.xJc=!1)}oSe(Oa,Lb){if(Oa!==cb.a.$f&&!this.bia.Wc(Oa)){var Fc=oa.a.$a.Wd.toISOString();Fc=Object(yb.a)(new rc,{StateId:Oa,DownloadedOn:Fc,IsHidden:this.Mf?this.Mf.Ui:"visible"!==window.document.visibilityState,DocumentLastUnhidden:this.Mf&&this.Mf.Xsc?this.Mf.Xsc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.vAf?this.contentRefreshManager.vAf.toISOString():null,
LastOffline:this.Ig&&this.Ig.JBa?this.Ig.JBa.toISOString():null});this.mergeSuspensionManager&&(Fc.IsPendingMergeBlockedByClient=this.gBa,this.bQd&&(Fc.PendingMergeBlockedByClientLastEnded=this.bQd.toISOString()));r.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${Lb} - StateDownloadedNotification: ${JSON.stringify(Fc)}`);this.bia.add(Oa,Fc)}}EId(){v.AFrameworkApplication.Jg&&v.AFrameworkApplication.Jg.EId()}}Object(f.a)(qd,"ContentLatencyTracker",
Xc.a,[]);var oe=a(935),Yd=a(936);class We extends Sys.EventArgs{constructor(Oa,Lb,Fc,Wc,td){super();this.ul=Oa;this.rOj=Lb;this.qOj=Fc;this.zaa=Wc;this.Pjh=td}}Object(f.a)(We,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class He{constructor(Oa,Lb,Fc,Wc){this.aNc=this.xAc=this.Kzc=this.Bnc=0;this.Rme=this.Mrf=!1;this.clientId=Oa;this.kwh=Lb;this.$=Wc;this.eVi=Bd.a.Kf()+Fc}get vvf(){return this.Rme}rjk(){this.xAc||(this.xAc=Bd.a.Kf(),this.WBa())}ojk(){this.Bnc||(this.Bnc=Bd.a.Kf(),this.WBa())}qjk(){this.Kzc||
(this.Kzc=Bd.a.Kf(),this.WBa())}sjk(Oa){this.aNc||(this.aNc=Bd.a.Kf(),this.Mrf=Oa,this.WBa())}WBa(Oa=0){this.vvf||(Oa&&Oa>this.eVi?this.aC(!0):this.xAc&&this.Kzc&&this.Bnc&&this.aNc&&this.aC(!1))}dispose(){this.$=null}aC(Oa){const Lb={};Lb.CoAuthorsCount=this.$.da.Kp.length;Lb.HostNotificationTime=this.Bnc;Lb.PeerNotificationTime=this.Kzc;Lb.PresenceNotificationTime=this.xAc;Lb.UserFetchTime=this.aNc;Lb.IsAlreadyFetchedFromServer=this.Mrf;Lb.IsTimeout=Oa;Lb.ClientId=this.clientId;Lb.CurrentUserClientId=
this.kwh;gb.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?r.ULS.sendTraceTag(541388879,0,50,`Host Notification Latency Entry: ${JSON.stringify(Lb)}`):r.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",Lb);this.Rme=!0}}Object(f.a)(He,"HostNotificationLatencyEntry",null,[5]);class bf{constructor(Oa,Lb,Fc){this.Cwh=Oa;this.Nwc=Lb;this.MI=Fc}}Object(f.a)(bf,"PersistedContentUpdateActionParameters",null,[]);class ef{constructor(Oa,Lb,
Fc){this.cRc={};this.dRc={};this.MI=Fc;this.G8b(Oa,this.cRc);this.G8b(Lb,this.dRc)}get Yad(){return Gb.a(this.cRc)}get Zad(){return Gb.a(this.dRc)}get puf(){return!this.Yad.length&&!this.Zad.length}wfk(Oa){this.G8b(Oa.Yad,this.cRc);this.G8b(Oa.Zad,this.dRc)}G8b(Oa,Lb){if(Oa)for(const Fc of Oa)Lb[Fc]=!0}}Object(f.a)(ef,"UpdatePresenceUsersActionParameters",null,[]);class nc extends $a.a{constructor(Oa,Lb,Fc,Wc){super();this.ti=null;this.dLd=!1;this.toe=this.currentUserId=this.pwd=null;this.Kpc=!1;
this.eOd=(td,na)=>{if(na.JL){td=na.JL;for(let Pa in td)(td=Pa)&&td!==this.currentUserId&&!this.k5a.has(td)&&this.Xkc(td).rjk()}};this.XD=()=>{this.f4f()};this.Fga=(td,na)=>{this.dLd=!0;td=Object(u.a)(Object,na.fba);if(1===na.type){var Pa=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled");if(null===td||void 0===td?0:td[cb.a.mti]){if(!Pa||!Object(u.a)(String,td[cb.a.fof]))return;var lb=this.qRe(Object(u.a)(String,td[cb.a.fof]));Object(u.a)(String,td[cb.a.gof])===
cb.a.kti?(lb=[lb],lb[0]===this.currentUserId||this.k5a.has(lb[0])||this.Xkc(lb[0]).ojk(),this.Tjg(lb)&&this.Glb(lb,null)):Object(u.a)(String,td[cb.a.gof])===cb.a.lti&&lb!==this.currentUserId&&this.Glb(null,null)}else{na=Array.isArray(na.fba)?na.fba:null;!na&&td&&(na=Array.isArray(td[cb.a.a_e])?td[cb.a.a_e]:null);if(na&&Pa)for(lb of na)lb===this.currentUserId||this.k5a.has(lb)||this.Xkc(lb).qjk();na&&!this.Tjg(na)||this.Glb(na,null);return}}if(td)if(0===na.type)({O3f:lb}=this.Vub(td)).returnValue?
(this.STa(td),cb.a.mg in td&&(this.$.da.m_(td[cb.a.mg],"ContentRefreshManager.OnUpdateNotificationReceived"),this.gvg())):r.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${lb}. Expected: ${this.$.da.zaa}. Ignoring this update.`);else{if(3===na.type){if(!(cb.a.nbg in td)){r.ULS.sendTraceTag(537154117,13,10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");return}na=td[cb.a.nbg];na===cb.a.EJj?this.Cpi(td):na!==cb.a.CJj&&na!==cb.a.GJj&&
na!==cb.a.HJj&&na!==cb.a.FJj&&na!==cb.a.DJj&&r.ULS.sendTraceTag(537154081,13,50,`RTC WetContentUpdate of unknown type ${na}. Ignoring this update.`);return}if(4===na.type){if(this.Vub(td).returnValue)return;this.$.da.fDi()&&this.rgh();if(this.DAj)return;lb=!1;cb.a.uYf in td&&(lb=td[cb.a.uYf]);if(this.$.da.Ybb&&lb)return;Pa=td[cb.a.vlj];this.$.da.Zd&&Pa&&this.ulj.qYf(new bf(Pa,lb,this.w5i))}else if(8===na.type)return}2===na.type?td&&this.Vub(td).returnValue||(r.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),
wc(this.$.pa.ua,null,null,null,null)):12!==na.type||td&&this.Vub(td).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.w5i=td=>{var na=td.Errors;ob.a.Jr(na)?(na=ob.a.hE(na,[1552731907],"ContentRefreshManager"),ob.a.Qka(na)||this.$.da.Pq(na)):(na=td.StateId+1,td.Result&&this.$.da.mg<na&&this.$.da.m_(cb.a.$f,"ContentRefreshManager.OnCheckForUpdateSuccess"))};this.lj=()=>{this.vJj&&this.dLd&&this.$.da.Lfc&&this.gvg()};this.iNf=()=>{this.dLd=!1;this.$.da.Hha=500;this.toe=oa.a.$a.Wd};this.uga=
(td,na)=>{this.R5d(na.ti)};this.$=Oa;this.Wm=Lb;this.$.pa.Ht(this.lj);this.Wm.Stb(this.uga);this.Wm.UBe(this.iNf);this.ulj=Fc;this.Ljk=Wc;this.zQa={};this.k5a=new Set;this.Kpc=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:8030692_IsEditorsTableNotificationEnabled");this.Wm.f5a();this.Kpc&&(this.currentUserId=this.$.workbookContext.ClientId,this.f4f(),this.$.da.Nca(this.XD));this.DAj=gb.EwaSettings.isChangeGateEnabled("OfficeVSO:7792548_RemoveWebRequestsForPersistedContentUpdates")}I0g(Oa){this.addHandler("ekcrmrrg",
Oa)}hDj(Oa){this.removeHandler("ekcrmrrg",Oa)}Z2a(Oa){this.addHandler("ekcrmmcu",Oa)}uhb(Oa){this.removeHandler("ekcrmmcu",Oa)}A_g(Oa){this.addHandler("LabelUpdateEventKey",Oa)}qCj(Oa){this.removeHandler("LabelUpdateEventKey",Oa)}get vAf(){return this.toe}get vJj(){return!!this.ti&&2===this.ti.connectionState}Glb(Oa,Lb){this.$.da.Zd&&(r.ULS.sendTraceTag(39150978,0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${Oa?Oa.join(","):"null"}] clientIdsToRemove=[${Lb?Lb.join(","):"null"}]`),
this.Ljk.qYf(new ef(Oa,Lb,null)))}dispose(){this.ti&&(this.ti.jRb(this.Fga),this.ti.TVa(this.eOd));this.$&&(this.$.pa.Uu(this.lj),this.$.da.faa(this.XD));this.Wm&&(this.Wm.HCc(this.uga),this.Wm.l7f(this.iNf));this.$=this.ti=this.k5a=this.zQa=null;super.dispose()}R5d(Oa){this.ti&&(this.ti.jRb(this.Fga),this.ti.TVa(this.eOd));this.ti=Object(u.a)(376,Oa);this.ti.d3a(this.Fga);this.Kpc&&this.ti.b3a(this.eOd);this.currentUserId=this.ti.clientId}f4f(){const Oa=!this.ti;var Lb=this.$.da.Kp;for(const Fc of Lb)(Lb=
Fc.User.UserID)&&Lb!==this.currentUserId&&!this.k5a.has(Lb)&&this.Xkc(Lb).sjk(Oa)}Cpi(Oa){if(cb.a.mbg in Oa&&cb.a.lbg in Oa&&cb.a.kbg in Oa){var Lb=Oa[cb.a.kbg];1!==Lb||cb.a.zaa in Oa&&cb.a.wEc in Oa||r.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${cb.a.zaa in Oa}, Has UserOperationTimeInMs: ${cb.a.wEc in Oa}.`);var Fc;({O3f:Fc}=this.Vub(Oa)).returnValue||(Oa=new We(Oa[cb.a.mbg],Oa[cb.a.lbg],Lb,Fc,cb.a.wEc in
Oa?Oa[cb.a.wEc]:0),this.raiseEvent("ekcrmrrg",Oa,this))}else r.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}Vub(Oa){Oa=cb.a.zaa in Oa?Oa[cb.a.zaa]:null;return{returnValue:this.$.da.zaa===Oa,O3f:Oa}}gvg(){this.$.da.Hha=Math.max(nc.M7g,this.$.da.Hha)}Tjg(Oa){for(const Lb of Oa)if(!this.$.da.hEb(Lb))return!0;return!1}rgh(){this.$.Fe(1562177611,-1,0,null)}STa(Oa){cb.a.tHf in Oa&&cb.a.uHf in Oa&&cb.a.xHf in Oa&&(Oa=Object(yb.a)(new oe.a,
{Pending:Oa[cb.a.uHf],Current:Oa[cb.a.tHf],SuspensionStartTimestamp:Oa[cb.a.xHf]}),this.raiseEvent("ekcrmmcu",new Yd.a(Oa),this))}Xkc(Oa){Oa=this.qRe(Oa);if(!this.zQa[Oa]){const Lb=new He(Oa,this.currentUserId,4E4,this.$);this.zQa[Oa]=Lb}this.Pcg();return Object(u.a)(He,this.zQa[Oa])}qRe(Oa){if(!Oa)return Oa;let Lb=Oa.toLocaleLowerCase();Lb.startsWith("{")||(Lb="{"+Oa+"}");return Lb}Pcg(){this.pwd||m.a.isEmpty(this.zQa)||!this.Kpc||(this.pwd=t.Task.delay(2E4).continueWith(()=>{this.jti()}))}jti(){const Oa=
[],Lb=Bd.a.Kf(),Fc=this.zQa;for(let td in Fc){var Wc=td;const na=Object(u.a)(He,Fc[td]);na.WBa(Lb);na.vvf&&(na.dispose(),Oa.push(Wc))}for(const td of Oa)delete this.zQa[td],this.k5a.add(td);this.pwd=null;this.Pcg()}}nc.M7g=3E4;Object(f.a)(nc,"ContentRefreshManager",$a.a,[753]);var id=a(209),Dd=a(79);class fc{constructor(Oa){this.$=Oa}U$e(Oa){return Oa+5E3}mYf(Oa){return this.$.da.Zd?hb.TaskExtensions.ts(hb.TaskExtensions.ts(t.Task.delay(0),()=>$b(this.$.pa.ua,Oa.Yad,Oa.Zad,Oa.MI,null,null,null),id.a.none,
0,Dd.a.current),()=>t.Task.delay(5E3),id.a.none,0,Dd.a.current):t.Task.Wa(!0)}bEe(Oa,Lb){if(!Lb)return Oa;if(!Oa)return r.ULS.shipAssertTag(537154073,0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),Lb;if(Lb.puf)return Lb;if(Oa.puf)return Oa;Lb.wfk(Oa);return Lb}}Object(f.a)(fc,"UpdatePresenceUsersActionAggregationPerformer",null,[751,752]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");pa.main();
Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");mc.a.Fa(qb.la);(()=>{mc.a.Fa(Oa=>{gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceTelemetry",!1)||za.la(Oa));const Lb=Oa.ea,Fc=Object(Vc.b)("OfficeVSO:7624673_NamedSheetViewConversionManagerService");Fc||Lb.Ja(28,new Wb(Oa));Lb.Ja(158,new Hd(Oa));
mc.a.Fa(na=>{gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)||ta.la(na)});const Wc=wa.GetServiceTaskFactory.create(Oa.ea,158,Lb.ka,1),td=Fc?Object(pb.d)(La.a.resolve(Ta.Gb,{Qa:1})):wa.GetServiceTaskFactory.create(Oa.ea,28,Lb.ka,1);hb.TaskExtensions.ya(hb.TaskExtensions.Bf([Wc,td],Lb.ka),()=>{const na=new n.a,Pa=Lb.Ba(26);Pa.kUe(Object(d.a)(na,na.setResult,"setResult"));const lb=new $c(Oa,Pa,Wc.result,td.result,ua.a.Tq(Ba.a.instance.Ed("Common.App.CoauthTelemetry.IPresenceBootTelemetry")));
mb.a.getInstance(Oa.ea).add(lb);gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)||Lb.Ja(159,new ta);hb.TaskExtensions.ya(gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MigratePresenceConverter",!1)?Object(pb.d)(La.a.resolve(Ta.dc,{Qa:1})):wa.GetServiceTaskFactory.create(Lb,159,Lb.ka,1),Nb=>{const xc=new n.a;xc.setResult(lb);new Eb(Object(yb.a)(new Zb.a,{clientId:Oa.workbookContext.ClientId}),na.task,xc.task,Nb.result,ic.a.instance,v.AFrameworkApplication.fa.qa("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:v.AFrameworkApplication.fa.Af("AwayCoauthorThresholdMs",9E5),Object(d.a)(v.AFrameworkApplication.jd,v.AFrameworkApplication.jd.processAction,"processAction"),Qa.instance)},Lb.ka)},Lb.ka,3);Ba.a.instance.register(182,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").se().Ae(()=>Oa.da);Ba.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");Ba.a.instance.register(Jb,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").se().Ae(()=>
new Jb(Oa));Ba.a.instance.resolve("Common.IPeopleInfoProvider")})})();mc.a.Fa(Xd.a.la);mc.a.Fa(Oa=>{const Lb=Oa.ea,Fc=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Migrate2AriaLiveNotifier",!1)?Object(pb.d)(La.a.resolve(Ta.f,{Qa:1})):wa.GetServiceTaskFactory.Vc(Oa.ea,211,212,1);Lb.Zc(25,Wc=>{hb.TaskExtensions.ya(Fc,td=>{Lb.Ba(231)||new de(td.result,Oa,Wc)},Lb.ka,3)})});(()=>{mc.a.Fa(Oa=>{const Lb=Object(pb.d)(La.a.resolve(Ta.tc,{Qa:0}));hb.TaskExtensions.ya(Lb,Fc=>{var Wc=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ConvertDocumentVisibilityObserverService",
!1)?La.a.Ph(Ta.K):Oa.ea.Ba(291);var td=new Ud(Oa);Wc=Fc.result.fSe(td,td,Wc,"persisted");td=new fc(Oa);Fc=Fc.result.fSe(td,td,null,"updatePresence");Oa.ea.Ja(292,new nc(Oa,Oa.ea.Ba(26),Wc,Fc));mb.a.getInstance(Oa.ea).add(new qd(Oa));mb.a.getInstance(Oa.ea).add(Wc)},Oa.ka)})})();String(b);String(e);String(c);window.___1688279196244_closurehack=b;window.___1688279196244_closurehack=e;window.___1688279196244_closurehack=c},757:function(w,D,a){a.r(D);a.d(D,"RtcUtils",function(){return f});w=a(0);var b=
a(15),c=a(802),e=a(43);class f{static ead(d,h=c.RealtimeChannel.LId){let r;try{r=e.c(d)}catch(n){throw d=String.format("Failed to JSON-serialize payload : {0}",n),b.ULS.sendTraceTag(18637072,500,10,d),Error.argument("payload",d);}if(r.length>h)throw d=String.format("Payload exceeds maximum length: {0} > {1}.",r.length,h),b.ULS.sendTraceTag(18637074,500,10,d),Error.argument("payload",d);return r}static deserialize(d,h,r){if(!d)return null;if(Object.getType(d)!==String){var n=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
h,Object.getType(d).getName(),r);b.ULS.sendTraceTag(18637075,500,10,n);return null}n=null;try{n=e.a(d)}catch(u){d=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",h,u,r),b.ULS.sendTraceTag(18637077,500,10,d)}return n}static ceb(d){if(!d)return"";if("string"===typeof d)return d.toString();try{return e.c(d)}catch(h){return d.toString()}}static LTh(d){let h,r,n;h=0;n=r=null;if(!d)return{vof:h,xof:r,exception:n};try{const u=d.source;u&&Object.getType(u)===
String&&(n=u);const v=d.context;v&&(d=v,h=d.status?d.status:0,r=d.statusText?d.statusText:null)}catch(u){}return{vof:h,xof:r,exception:n}}}Object(w.a)(f,"RtcUtils",null,[])},790:function(w,D,a){a.r(D);w=a(0);var b=a(15),c=a(80),e=a(119),f;(function(n){n[n.SendNotification=0]="SendNotification";n[n.SendPersistentState=1]="SendPersistentState";n[n.FindSession=2]="FindSession";n[n.Last=3]="Last"})(f||(f={}));Object(w.b)("ApiType",f);var d;(function(n){n[n.AttemptCount=0]="AttemptCount";n[n.SuccessCount=
1]="SuccessCount";n[n.DropCount=2]="DropCount";n[n.FailedCount=3]="FailedCount";n[n.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";n[n.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";n[n.ThrottledCount=6]="ThrottledCount";n[n.Last=7]="Last"})(d||(d={}));Object(w.b)("EventCountType",d);var h=a(933);a.d(D,"FrequentLoggingMetrics",function(){return r});class r{constructor(n){this.OQe=this.N7e=null;this.MGf=this.P9e=0;this.Tn=null;this.rpe=this.KXc=0;this.Ei=n;this.Lxi();this.QSc=
this.Vje=this.hYc=!1;this.FXc=0}get tTh(){return this.QSc}v5j(n){this.rpe=n;window.setInterval(Object(c.a)(this,this.PGd,"logMetricsBatchAndReset"),n);this.KXc=(new Date).getTime()}wA(n,u){this.iXj(n)&&!this.Vje||this.tTh||!window.navigator.onLine||this.Ei.hbb||(this.Tn[n][u]++,this.hYc=!0)}Lxi(){this.Tn=Array(3);for(let n=0;3>n;n++){this.Tn[n]=Array(7);for(let u=0;7>u;u++)this.Tn[n][u]=0}}hah(){const n={};for(let u=0;3>u;u++)for(let v=0;7>v;v++)this.OMi(u,v)&&(n[f[u]+d[v]]=this.Tn[u][v]);n.FSDomain=
this.N7e;n.ConnectionDomain=this.OQe;n.FSRetryInterval=this.P9e;n.MaxPayloadSize=this.MGf;n.LogNumber=this.FXc;1===this.FXc&&(n.FSLatencies=h.a.instance.V8h(),n.ConLatencies=h.a.instance.G5h());return n}OMi(n,u){return 2===n&&3!==u&&0!==u?!1:!0}iXj(n){return 2===n?!1:!0}PGd(){if(this.hYc){this.FXc++;if((new Date).getTime()-this.KXc<5E3+this.rpe){var n=e.a.toJSON(this.hah());b.ULS.sendTraceTag(50644352,500,15,n)}this.KXc=(new Date).getTime();for(n=0;3>n;n++)for(let u=0;7>u;u++)this.Tn[n][u]=0;this.hYc=
!1}}kXi(){this.Vje=!0}static get instance(){return r.La}static create(n){r.instance||(r.La=new r(n));return r.instance}}r.La=null;Object(w.a)(r,"FrequentLoggingMetrics",null,[899])},802:function(w,D,a){a.r(D);w=a(0);var b=a(15),c=a(80),e=a(181),f=a(934),d=a(108),h=a(6);class r{constructor(Ia,ob){this.status=Ia;this.Dcb=ob}}Object(w.a)(r,"UserStatusInfo",null,[]);var n=a(63),u=a(933);class v{constructor(Ia,ob){this.data=Ia;this.timeStamp=ob}}Object(w.a)(v,"PresenceData",null,[]);class x{constructor(Ia){this.vca=
!1;this.f2a=0;this.ARc=!1;this.setTimeout=x.tgd;this.clearTimeout=x.jgd;this.oVi=Object(c.a)(this,this.FUi,"logRtcConnectingUsageStatement");this.Lm=Ia}k6i(){this.vca||(this.f2a=this.setTimeout(()=>{this.vca=!1;this.NDf()},8E3),this.vca=!0,this.ARc=!1)}n7i(){this.kP()}Xfj(){this.NDf()}NDf(){this.kP();this.ARc||(this.ARc=!0,this.oVi())}FUi(){b.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Lm)}kP(){this.vca&&this.clearTimeout(this.f2a);this.f2a=0;this.vca=
!1}static tgd(Ia,ob){return window.setTimeout(Ia,ob)}static jgd(Ia){window.clearTimeout(Ia)}}Object(w.a)(x,"ConnectedUsageKpiLogger",null,[925]);class k{constructor(){this.X3f=this.XTd;this.$3f=this.$Td;this.Z3f=this.ZTd;this.d4f=this.bUd;this.c4f=this.aUd;this.gUd=this.hUd;this.fQb=this.eUd;this.sVa=this.cUd;this.tVa=this.dUd;this.Y3f=this.YTd;this.Mdb=this.uKd;this.eMb=this.wKd}XTd(){}$Td(){}ZTd(){}bUd(){}aUd(){}eUd(){}dUd(){}cUd(){}hUd(){}YTd(){}uKd(){}wKd(){}}Object(w.a)(k,"NoopRealtimeChannelMetrics",
null,[918,94]);class m{}m.vXb="presenceUpdated";m.updateNotification="updateNotification";m.xYf="persistentStateCleared";m.updatePersistentState="persistentStateUpdated";Object(w.a)(m,"RtcClientMethodNames",null,[]);class t{}t.Ati="realtimeChannelHub";t.vXb="UpdatePresence";t.xaa="SendUpdateNotification";t.dpd="GetCompletePersistentStateWithMetadata";t.updatePersistentState="UpdatePersistentState";t.ulb="UpdateClientInfo";Object(w.a)(t,"RtcHubMethodNames",null,[]);class z{constructor(Ia){this.nu=
Ia}hyj(Ia){this.nu.on(m.vXb,Ia)}Kyj(Ia){this.nu.on(m.updateNotification,Ia)}eyj(Ia){this.nu.on(m.updatePersistentState,Ia)}dyj(Ia){this.nu.on(m.xYf,Ia)}agk(Ia){this.nu.off(m.vXb,Ia)}jgk(Ia){this.nu.off(m.updateNotification,Ia)}$fk(Ia){this.nu.off(m.updatePersistentState,Ia)}Zfk(Ia){this.nu.off(m.xYf,Ia)}vXb(Ia){return this.nu.invoke(t.vXb,Ia)}ulb(Ia){return this.nu.invoke(t.ulb,Ia)}xaa(Ia,ob){return this.nu.invoke(t.xaa,Ia,ob)}dpd(Ia){return this.nu.invoke(t.dpd,Ia)}updatePersistentState(Ia,ob){return this.nu.invoke(t.updatePersistentState,
Ia,ob)}}Object(w.a)(z,"RealtimeChannelProxy",null,[922,923,924]);class y{constructor(){this.XPc=this.sfe=!1;this.VPc=0;this.eRc=this.R0c=this.Q0c=this.rPc=!1;this.fTc=0;this.sue=!1;this.rue=this.que=0;this.X_c=!1;this.b0c=this.$_c=this.c0c=this.Y_c=0;this.a0c=!1}get J7g(){return this.XPc}get I7g(){return this.VPc}get X2g(){return this.rPc}get qYj(){return this.Q0c}get rYj(){return this.R0c}get mih(){return this.eRc}get eic(){return this.fTc}get rtcJsClientFrequentlyLogsMetrics(){return this.sue}get pbg(){return this.que}get BJj(){return this.rue}get rtcClientMessageTelemetryEnabled(){return this.X_c}get xJj(){return this.Y_c}get ubg(){return this.c0c}get rbg(){return this.$_c}get tbg(){return this.b0c}get sbg(){return this.a0c}static createInstance(Ia){const {RealtimeChannel:ob}=
a(802);return Ia?Object.assign(new y,{sfe:Ia.qa("AwayStatusManagerIsEnabled"),XPc:Ia.qa("AwayStatusOneMinuteTimeoutIsEnabled"),VPc:Ia.Af("AwayCoauthorThresholdMs",9E5),rPc:Ia.qa("RtcAllowCrossDomainAccessEnabled"),Q0c:Ia.qa("ShouldLogOnContentNotification"),R0c:Ia.qa("ShouldLogOnHostSubscriptionNotification"),eRc:Ia.qa("RtcClientMetricsEnabled"),fTc:Ia.Af("RtcFindSessionRequestTimeoutInMS",6E4),sue:Ia.qa("RtcJsClientFrequentlyLogsMetrics"),que:Ia.Af("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),rue:Ia.Af("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),X_c:Ia.qa("RtcClientMessageTelemetryEnabled"),Y_c:Ia.Af("RtcClientMessageTelemetrySampleSize",5),c0c:Ia.Af("RtcSendTelemetryMessageIntervalInMS",3E5),$_c:Ia.Af("RtcLogClientMessageMetricsTimeOutInMs",2E4),b0c:Ia.Af("RtcMaxPayloadSizeInCharactersOverride",ob.LId),a0c:Ia.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new y,{sfe:!1,XPc:!1,VPc:9E5,rPc:!1,Q0c:!1,R0c:!0,eRc:!1,fTc:9E4,
X_c:!1,Y_c:5,c0c:3E5,$_c:2E4,b0c:ob.LId,a0c:!1})}}Object(w.a)(y,"RealtimeChannelSettings",null,[921]);var C=a(1176),J=a(139),F=a(388);class K{constructor(Ia){this.vsb=null;this.yha=0;this.mOa=!1;this.Qi=Ia;this.Qi.s6(Object(c.a)(this,this.ZY,"onConnectionStateChanged"))}ZY(Ia,ob){this.yha=ob.newState}Mgj(){b.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Qi.mBc()}lwi(Ia){this.vsb.init(Ia)}}Object(w.a)(K,"ARtcMessageHandler",null,[]);var L=a(373);
class S{constructor(){this.Presence=null;this.TimeStamp=0}}Object(w.a)(S,"PresenceDataEntryForClients",null,[]);var W=a(119);class G{constructor(Ia,ob=""){this.nQg=Ia;this.VL=ob}send(){return this.nQg()}get messageId(){return this.VL}}Object(w.a)(G,"MessageHandler",null,[939]);var O=a(1010);class T extends Sys.EventArgs{constructor(Ia,ob,gb,Za){super();this.aXd=Ia;this.reconnectDelay=ob;this.reason=gb;this.y_d=Za}}Object(w.a)(T,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var I=a(1045);class N{constructor(){this.s1c=
this.Zq=null}get Ee(){return this.Zq?this.s1c?this.s1c.getTime()-this.Zq.getTime():(new Date).getTime()-this.Zq.getTime():0}start(){this.Zq=new Date}stop(){this.s1c=new Date}}Object(w.a)(N,"SimpleStopwatch",null,[]);var R=a(1046),V;(function(Ia){Ia[Ia.contentUpdate=0]="contentUpdate";Ia[Ia.editorsTableUpdate=1]="editorsTableUpdate";Ia[Ia.fileNameUpdate=2]="fileNameUpdate";Ia[Ia.wetContentUpdate=3]="wetContentUpdate";Ia[Ia.persistedContentUpdate=4]="persistedContentUpdate";Ia[Ia.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";Ia[Ia.replicationTelemetry=6]="replicationTelemetry";Ia[Ia.lockUpdate=7]="lockUpdate";Ia[Ia.collabServiceContentUpdate=8]="collabServiceContentUpdate";Ia[Ia.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";Ia[Ia.saveTargetUpdate=10]="saveTargetUpdate";Ia[Ia.uploadToOcsUpdate=11]="uploadToOcsUpdate";Ia[Ia.labelUpdate=12]="labelUpdate";Ia[Ia.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";Ia[Ia.subscribeOrExtend=14]="subscribeOrExtend";
Ia[Ia.elapsedBootTelemetry=15]="elapsedBootTelemetry";Ia[Ia.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";Ia[Ia.clientToClientResponseMessage=17]="clientToClientResponseMessage";Ia[Ia.verifyNotificationPipeline=18]="verifyNotificationPipeline";Ia[Ia.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";Ia[Ia.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";Ia[Ia.last=21]="last"})(V||(V={}));Object(w.b)("UpdateNotificationType",V);var sa=a(594),U=a(613),ka=a(614);class ja extends K{constructor(Ia,
ob,gb,Za,da,ya,ib,vb,eb,Ta){super(ib);this.nu=null;this.eqb=this.lpe=!1;this.VL=0;this.BZc=new F.a;this.GMg=ja.Q5h();this.nZc=h.AFrameworkApplication.fa.Ta("OwningFeatureCrewForRtcNotificationKpis");this.ig=Ia;this.Pqe=this.Oqe=0;this.vsb=ob;this.vsb.Q7b(Object(c.a)(this,this.Mgj,"onTooManyUndeliveredMessages"));this._clientId=gb;this.aPg=da;this.Qi.G0g(Object(c.a)(this,this.Odj,"onRefreshProxyRequired"));this.Qi.E0g(Object(c.a)(this,this.Ndj,"onRefreshAllPersistentStateRequest"));this.Qi.$0g(Object(c.a)(this,
this.xaa,"sendUpdateNotification"));this.Qi.n_g(Object(c.a)(this,this.Oaj,"onInternalPresenceUpdated"));this.Qi.o_g(Object(c.a)(this,this.Paj,"onInternalUpdateNotificationReceived"));this.Qi.m_g(Object(c.a)(this,this.Naj,"onInternalPersistentStateUpdated"));this.Qi.l_g(Object(c.a)(this,this.Maj,"onInternalPersistentStateCleared"));this.Qi.Z0g(Object(c.a)(this,this.ZSb,"sendPersistentState"));this.Qi.v1g(Object(c.a)(this,this.ulb,"updateClientInfo"));this.wj=ya;this.Lm=Za;this.Tn=vb;this.KE=eb;this.oqb=
Ta;this.Hta=Object(J.a)(String,h.AFrameworkApplication.fe.Application)||""}Odj(Ia,ob){this.nu=this.aPg(ob.hubConnection);this.vsb.reset();this.nu.hyj(Object(c.a)(this,this.nqa,"onPresenceUpdated"));this.nu.eyj(Object(c.a)(this,this.u3,"onPersistentStateUpdated"));this.nu.dyj(Object(c.a)(this,this.$Nd,"onPersistentStateCleared"));this.nu.Kyj(Object(c.a)(this,this.Fga,"onUpdateNotificationReceived"))}ZY(Ia,ob){this.yha=ob.newState;2===ob.newState&&this.UNj()}UNj(){for(let Ia of this.BZc)this.xaa(null,
new I.a(Ia.key,Ia.value,!1,new e.a));this.BZc=new F.a}Ndj(Ia,ob){ob.Bad();for(Ia=0;3>Ia;++Ia)this.CNj(Ia,ob)}CNj(Ia,ob){try{this.nu.dpd(Ia).done(gb=>{ob.Ylb(ob.ycd,"GetCompletePresenceSuccess")&&(ob.Rlh.Xfj(),b.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}] of type [{1}]",this.Lm,Ia),this.Qi.dtj(),this.$cj(Ia,gb),this.Qi.Bsj(gb),ob.a6e.Wc(Ia)&&this.Qi.k2f(Ia,ob.a6e.ma(Ia),new e.a))}).fail(gb=>{const {RtcUtils:Za}=a(757);ob.Ylb(ob.ycd,"GetCompletePresenceFail")&&
(b.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}] of type [{2}]",Za.ceb(gb),this.Lm,Ia),this.Qi.mBc())}).always(()=>{ob.stopwatch&&ob.stopwatch.stop()})}catch(gb){b.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",ob.ycd,gb.message)}}ZSb(Ia,ob){var {RtcUtils:gb}=a(757);Ia=ob.presence;let Za;const da=ob.Esa;this.KE.wA(1,
0);try{Za=gb.ead(Ia,this.oqb)}catch(ib){this.KE.wA(1,3);b.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",ib.message);da.setException(ib);return}gb=new d.a;gb.ga(this._clientId,Object.assign(new S,{Presence:Ia,TimeStamp:(new Date).getTime()}));this.Qi.s2f(ob.type,gb);if(2!==this.yha)this.Tn.sVa(),this.KE.wA(1,2),da.setResult(null);else{var ya=this.VL.toString();++this.VL;Ia=new G(()=>this.WNj(ob.type,Za,ya),ya);Ia=this.Nqg(0,ob.type).add(Ia);
Ia.Uxc(ib=>{2===ib&&(this.KE.wA(1,6),this.eqb||2!==ob.type||b.ULS.sendTraceTag(508651234,500,15,"First persistent state update of type LiveMeeting for [{0}] was throttled",this.Lm));da.setResult(null)});Ia.Txc(()=>{})}}WNj(Ia,ob,gb){let Za=null;const da=new N,ya=new O.a;b.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}] of type [{1}]",this.Lm,Ia);if(2!==this.yha)return this.Tn.sVa(),this.KE.wA(1,2),b.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}] of type [{1}]",
this.Lm,Ia),ya.FId(),ya;this.wj&&20>this.Oqe&&(Za=this.wj.Le("WebServiceCall","Send Presence Message"),this.Oqe++);da.start();ya.lLb(1);try{this.nu.updatePersistentState(Ia,ob).done(()=>{this.Tn.fQb();this.KE.wA(1,1);b.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}] of type [{2}]",gb,this.Lm,Ia);ya.kCa(1);da&&(da.stop(),da.Ee>this.ig.pbg?this.KE.wA(1,4):this.KE.wA(1,5))}).fail(ib=>{const {RtcUtils:vb}=a(757);this.mOa||(this.Tn.sVa(),this.KE.wA(1,3),
this.eqb||2!==Ia||b.ULS.sendTraceTag(508651233,500,15,"First persistent state update of type LiveMeeting for [{0}] failed",this.Lm),b.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",gb,vb.ceb(ib),this.Lm));ya.kCa(2)}).always(()=>{Za&&Za.stop()})}catch(ib){b.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",ib.message),this.KE.wA(1,3),this.eqb||2!==Ia||b.ULS.sendTraceTag(508651232,500,
15,"First persistent state update of type LiveMeeting for [{0}] hit an exception",this.Lm),ya.kCa(2)}return ya}ulb(Ia,ob){({RtcUtils:Ia}=a(757));const gb=ob.lih,Za=ob.Esa;let da;try{da=Ia.ead(gb,this.oqb)}catch(ya){b.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",ya.message);Za.setException(ya);return}try{this.nu.ulb(da).done(()=>{b.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(ya=>{const {RtcUtils:ib}=
a(757);this.mOa||b.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",ib.ceb(ya));Za.setResult(null)})}catch(ya){b.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",ya.message),Za.setResult(null)}}xaa(Ia,ob){({RtcUtils:Ia}=a(757));const gb=ob.type,Za=ob.fba,da=ob.Zyh,ya=ob.Esa;let ib;this.KE.wA(0,0);try{ib=Ia.ead(Za,this.oqb)}catch(eb){this.KE.wA(0,3);b.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",
eb.message);ya.setException(eb);return}if(2!==this.yha)da?this.BZc.ga(gb,Za):(this.Tn.sVa(),this.KE.wA(0,2)),ya.setResult(null);else{var vb=this.VL.toString();++this.VL;ob=new G(()=>this.pOj(gb,ib,vb),vb);ob=this.Nqg(1,gb).add(ob);ob.Uxc(eb=>{2===eb&&this.KE.wA(0,6);ya.setResult(null)});ob.Txc(()=>{})}}pOj(Ia,ob,gb){let Za=null;const da=new N,ya=new O.a;b.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}] of type [{1}]",this.Lm,Ia);if(2!==this.yha)return this.Tn.sVa(),this.KE.wA(0,
2),b.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Lm),ya.FId(),ya;this.wj&&3===Ia&&20>this.Pqe&&(Za=this.wj.Le("WebServiceCall","Send WetContent Update"),this.Pqe++);da.start();ya.lLb(1);this.nu.xaa(Ia,ob).done(()=>{this.Tn.fQb();this.KE.wA(0,1);b.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}] of type [{2}]",gb,this.Lm,Ia);ya.kCa(1);da&&(da.stop(),da.Ee>this.ig.pbg?this.KE.wA(0,4):this.KE.wA(0,
5))}).fail(ib=>{const {RtcUtils:vb}=a(757);this.mOa||(this.Tn.sVa(),this.KE.wA(0,3),b.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",gb,vb.ceb(ib),this.Lm));ya.kCa(2)}).always(()=>{Za&&Za.stop()});return ya}jy(){this.nu.agk(Object(c.a)(this,this.nqa,"onPresenceUpdated"));this.nu.$fk(Object(c.a)(this,this.u3,"onPersistentStateUpdated"));this.nu.Zfk(Object(c.a)(this,this.$Nd,"onPersistentStateCleared"));this.nu.jgk(Object(c.a)(this,
this.Fga,"onUpdateNotificationReceived"))}Oaj(Ia,ob){this.nqa(ob.JL,ob.v7)}nqa(Ia){this.Tn.tVa();this.u3(0,Ia)}Naj(Ia,ob){this.u3(ob.type,ob.JL)}$cj(Ia,ob){const gb={};for(let Za in ob)gb[Za]=ob[Za].Presence;this.oSf(Ia,gb,ob)}u3(Ia,ob){this.Tn.tVa();this.oSf(Ia,ob)}oSf(Ia,ob,gb=null){var {RtcUtils:Za}=a(757);if(b.ULS.Pha(500,100))for(var da in ob);delete ob[this._clientId];if(!W.a.isEmpty(ob)){for(var ya in ob)da=ya,ob[da]=Za.deserialize(ob[ya],"Presence",da,!1,this.oqb);Za=new d.a;ya=(new Date).getTime();
for(let ib in ob){da=ob[ib];let vb=ib,eb;gb?(eb=gb[vb],eb.Presence=da):eb=Object.assign(new S,{Presence:da,TimeStamp:ya});Za.ga(vb,eb)}this.Qi.s2f(Ia,Za);switch(Ia){case 0:this.lpe||(b.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Lm),this.lpe=!0,h.AFrameworkApplication.Jg&&h.AFrameworkApplication.Jg.hXi());this.Qi.b2f(ob,[]);break;case 2:this.eqb||(b.ULS.sendTraceTag(508867081,500,50,"Raising first live meeting update notification for [{0}]",this.Lm),
this.eqb=!0);this.Qi.a2f(Ia,ob);break;default:this.Qi.a2f(Ia,ob)}}}Maj(Ia,ob){this.$Nd(ob.bbd)}$Nd(Ia){this.Tn.tVa();if(b.ULS.Pha(500,100))for(let ob=0;ob<Ia.length;++ob);Ia.length&&(this.Qi.ttj(Ia),this.Qi.Vsj(Ia),this.Qi.b2f({},Ia))}Paj(Ia,ob){this.Fga(ob.type,ob.fba)}Fga(Ia,ob=null){this.ig.qYj&&0===Ia&&b.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===Ia&&this.nZc&&0<this.nZc.length){var gb=Object.assign(new sa.a,{topLevelKpiName:"ContentUpdateNotificationReceived",
featureName:"RtcNotification",crewAlias:this.nZc,vetoPillar:"RealTimeCoauth"});(gb=L.a.getInstance(gb))&&gb.logKpiUsage(this.GMg)}this.ig.rYj&&13===Ia&&b.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",ob||"<none>"));this.Tn.tVa();5===Ia?(ob=(Ia=this.qkj(ob))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",Ia.reason,Ia.reconnectDelay):"Received client reconnection request from the server without params.",
b.ULS.sendTraceTag(18637071,500,50,ob),this.Qi.mBc(Ia)):(ob=a(757).RtcUtils.deserialize(ob,String.format("UpdateNotification-{0}",V[Ia]),null,!1,this.oqb),this.Qi.stj(Ia,ob))}qkj(Ia){try{if(!Ia||""===Ia)return null;const ob=JSON.parse(Ia);return new T(ob[R.a.fZd],ob[R.a.wJj],ob[R.a.yJj],ob[R.a.y_d])}catch(ob){return b.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",ob.message),null}}Nqg(Ia,ob){return this.vsb.vji(this.wji(Ia,ob))}wji(Ia,ob){return Ia+","+ob}static Q5h(){var Ia=
new Map;Ia.set("SkipAria","True");Ia=Object.assign(new U.a,{extendedProperties:Ia});return Object.assign(new ka.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:Ia,blockFutureEmissionDurationInMs:3E5})}}Object(w.a)(ja,"RtcMessageHandler",K,[]);class Da{FTe(Ia,ob=""){const {MaxOutstandingThrottler:gb}=a(1042);return gb.createInstance(Ia,ob)}jsh(Ia,ob=""){const {MaxRateThrottler:gb}=a(1044);return gb.createInstance(Ia,ob)}}Object(w.a)(Da,"ThrottlerFactory",null,[920]);var qa=
a(107),Ba=a(1047);class ua{constructor(Ia){this.ig=null;this.Hz=!1;this.Za=new qa.a;this.ZXc=new d.a;this.YXc=new d.a;this.$1c=Ia;this.g0a=this.$1c.FTe(ob=>ob.send(),"GlobalMaxOustandingThrottler");this.g0a.Q7b(()=>{this.Za.raiseEvent("TMUDM")})}init(Ia){this.Hz||(this.ig=Ia,this.g0a.init(this.ig.MFa,this.ig.dmi),this.Hz=!0)}vji(Ia){var {MaxRateThrottler:ob}=a(1044),{MaxOutstandingThrottler:gb}=a(1042);this.Hz||this.init(new Ba.a(ob.cWe,gb.xWe,gb.nWe,ua.hYi));({value:ob}=this.ZXc.Ve(Ia)).returnValue||
(({value:ob}=this.YXc.Ve(Ia)).returnValue||(ob="MaxOutstandingThrottler-"+Ia,ob=this.$1c.FTe(Object(c.a)(this.g0a,this.g0a.add,"add"),ob),ob.init(this.ig.MFa,this.ig.gYi),ob.Q7b(()=>{this.Za.raiseEvent("TMUDM")}),this.YXc.add(Ia,ob)),gb="MaxRateThrottler-"+Ia,ob=this.$1c.jsh(Object(c.a)(ob,ob.add,"add"),gb),ob.init(this.ig.$Yi),this.ZXc.add(Ia,ob));return ob}reset(){for(let Ia of this.ZXc)Ia.value.fUd();for(let Ia of this.YXc)Ia.value.fUd(),Ia.value.reset();this.g0a.fUd();this.g0a.reset()}Q7b(Ia){this.Za.addHandler("TMUDM",
Ia)}}ua.hYi=1E3;Object(w.a)(ua,"ThrottlerManager",null,[919]);var pa;(function(Ia){Ia[Ia.unspecified=0]="unspecified";Ia[Ia.word=1]="word";Ia[Ia.excel=2]="excel";Ia[Ia.powerPoint=3]="powerPoint";Ia[Ia.test=4]="test";Ia[Ia.wacFrontEnd=5]="wacFrontEnd";Ia[Ia.oneNote=6]="oneNote";Ia[Ia.visio=7]="visio";Ia[Ia.officeMobile=8]="officeMobile";Ia[Ia.cosmosDBChangefeed=9]="cosmosDBChangefeed";Ia[Ia.last=10]="last"})(pa||(pa={}));Object(w.b)("RtcClientAppName",pa);const Ka=(Ia,ob,gb,Za,da,ya,ib,vb,eb=null,
Ta=null,La=null,fb=null)=>{const Pb=y.createInstance(h.AFrameworkApplication.fa),Sa=h.AFrameworkApplication.buildVersion?h.AFrameworkApplication.buildVersion:"1.0",Wa=$a(Ia,ob,ib,Sa),pb=Pb.mih?a(1246).RealtimeChannelMetrics.createInstance(Wa):new k;var wa=a(790).FrequentLoggingMetrics.create(da);Pb.rtcJsClientFrequentlyLogsMetrics&&wa.v5j(Pb.BJj);var hb="";hb=eb&&""!==eb?eb:"/rtc2/";wa.N7e=n.a.mK(hb);const Sb=hb+"signalr";eb=hb+"findsession";const Bc=t.Ati;hb=new Da;La=La||C.a.getInstance();b.ULS.shipAssertTag(556867617,
500,Pb.tbg<=a(802).RealtimeChannel.NGf,"Client attempting to override max payload size beyond absolute limit");const ab=Math.min(Pb.tbg,a(802).RealtimeChannel.NGf);wa.MGf=ab;wa=new ja(Pb,new ua(hb),Ia,Wa,qb=>new z(qb.createHubProxy(Bc)),vb,La,pb,wa,ab);Ta||(Ta=a(1181).FindSessionStrategy.createInstance(ob,da,eb,vb,Sa,ib,Ia,Wa,La,ya,Za,fb));Ta.eic=Pb.eic;ob=new x(Wa);gb=gb?gb.split(","):null;Ia=new (a(802).RealtimeChannel)(Ia,gb,Wa,vb,()=>$.hubConnection(Sb),Ta,wa,ob,La,pb,Pb,da);Ia.init();return Ia},
$a=(Ia,ob,gb)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",Ia,ha(pa[gb]),ha("browser"),ob),ha=Ia=>Ia?Ia.charAt(0).toLocaleUpperCase()+Ia.substring(1,Ia.length):Ia;a.d(D,"RealtimeChannel",function(){return cb});class cb{constructor(Ia,ob,gb,Za,da,ya,ib,vb,eb,Ta,La,fb){this.r1c=!1;this.n5=null;this.vJ=new d.a;this.snb=1;this.WR=null;this.uw=!1;this.TWc=(new Date(0)).getTime();this.Rve=0;this._clientId=Ia;this.C5b=ob;this.tO=0;this.wj=Za;this.zRc=vb;this.fQg=ib;this.VEg=eb;this.BHg=
da;this.Lta=ya;this.Lm=gb;this.Tn=Ta;this.ig=La;this.Ei=fb;this.aRg=1>100*Math.random()}get dTa(){return this.Lta.dTa}set dTa(Ia){this.Lta.dTa=Ia}get zEa(){return this.fQg}get Qi(){return this.VEg}init(){this.Qi.F0g(Object(c.a)(this,this.Mec,"disconnectAndCreateNewConnection"));this.Qi.x1g(Object(c.a)(this,this.ahj,"onUpdatePersistentStateRequestReceivedInternal"));this.Qi.w1g(Object(c.a)(this,this.$gj,"onUpdatePersistentStateClearedRequestReceived"));this.Ei.Htb(this.Tn);h.AFrameworkApplication.fkb(()=>
{const {FrequentLoggingMetrics:Ia}=a(790);this.Tn.gUd();Ia.instance&&Ia.instance.PGd()});this.OTe();this.$Ah();this.Qi.b1g(Object(c.a)(this,this.Dhk,"updateConnectionQueryString"))}$Ah(){try{const gb=$.signalR;if(!gb)throw Error.invalidOperation("Failed to retrieve Signalr object");const Za=gb.version;if(!Za)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===Za){var Ia=gb.transports;if(!Ia)throw Error.invalidOperation("Failed to retrieve transports object");
var ob=Ia.longPolling;if(!ob)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!ob.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");ob.supportsKeepAlive=this.Iuh()}}catch(gb){b.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",gb.message)}}Iuh(){return()=>!1}OTe(){const Ia=++this.snb;this.TWc=(new Date(0)).getTime();this.WR=this.BHg();this.Qi.btj(this.WR);this.WR.stateChanged(ob=>
{this.m6i(ob,Ia)});this.WR.connectionSlow(Object(c.a)(this,this.Mfj,"onSlowConnection"));this.WR.error(Object(c.a)(this,this.Cfj,"onSignalRError"));this.WR.log=Object(c.a)(this,this.Dfj,"onSignalRLog")}Ylb(Ia,ob){return Ia!==this.snb?(b.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",ob),!1):!0}connect(){2!==this.tO&&1!==this.tO&&(b.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Lm),this.zRc.k6i(),u.a.instance.x5j(),this.ZY(1,this.tO),
this.mng())}mng(){const Ia=this.snb;this.r1c=!1;this.Tn.X3f();this.Lta.Fgi(Object(c.a)(this,this.Mlh,"connectSignalrConnection"),Object(c.a)(this,this.DOf,"onFailureToConnect"),Object(c.a)(this.zEa,this.zEa.lwi,"initThrottlerManager"),Object(c.a)(this,this.Ylb,"verifyConnectionToken"),Ia)}DOf(Ia=null){this.Tn.Z3f();let ob=null;!Ia||"documentsessiondeleted"!==(ob=Ia.toLowerCase())&&"documentsessionexpired"!==ob?this.Mec():(b.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.Lm,Ia),this.disconnect())}Mec(Ia,ob=null){b.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.n5);Ia=(Ia=2===this.tO||1===this.tO)&&!this.zEa.mOa;let gb=!0,Za=0;ob&&Object.getType(ob)!==Object.getType(Sys.EventArgs.Empty)&&ob.aXd&&""!==ob.aXd&&(Ia=!0,this.Lta.PTj(ob.aXd),gb=ob.y_d,Za=ob.reconnectDelay);Ia&&this.ZY(1,this.tO);++this.snb;this.zEa.jy();this.u6j(gb);this.Lta.dCh();this.OTe();Ia&&window.setTimeout(Object(c.a)(this,this.mng,"startConnecting"),Math.min(Za,3E4))}Dhk(){let Ia=
null;const ob=({correlationId:Ia}=this.Lta.bdf()).returnValue;this.WR.qs=ob;b.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Lm,Ia)}Mlh(Ia){const {FrequentLoggingMetrics:ob}=a(790);this.TWc=(new Date).getTime();let gb=null;this.WR.qs=({correlationId:gb}=this.Lta.bdf()).returnValue;this.ig.X2g&&(this.WR.url=Ia,ob.instance&&(ob.instance.OQe=n.a.mK(Ia)));let Za=null;this.wj&&(Za=this.wj.Le("WebServiceCall","ConnectToServer"));b.ULS.sendTraceTag(3290048,
500,50,"Connecting to server for client [{0}]",this.Lm);Ia={};this.C5b&&(Ia.transport=1===this.C5b.length?this.C5b[0]:this.C5b);Ia.pingInterval=null;u.a.instance.eQb(1,0);Ia.waitForPageLoad=!1;this.WR.start(Ia,null).done(da=>{this.Tn.$3f();u.a.instance.eQb(1,1,!0);b.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",da.id,gb)}).fail(da=>{b.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",
this.Lta.lF,gb,this.Lm);this.DOf();this.Tn.Y3f(da);u.a.instance.eQb(1,1,!1);this.Qi.h2f(0,{["CorrelationId"]:gb,["ErrorDetails"]:da,["ConnectionState"]:f.a[this.tO]})}).always(()=>{const {FrequentLoggingMetrics:da}=a(790);Za&&Za.stop();da.instance&&(da.instance.QSc=!1)})}disconnect(){const {FrequentLoggingMetrics:Ia}=a(790);0===this.tO?b.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Lm):(this.Tn.c4f(),Ia.instance&&(Ia.instance.QSc=
!0),b.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Lm),this.zEa.mOa=!0,this.zRc.n7i(),this.ZY(0,this.tO),this.Mec(),this.zEa.mOa=!1)}u6j(Ia){const ob=this.qdh(),gb=this.WR,Za=this.n5,da=()=>{if(this.r1c)b.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.r1c=!0,gb.stop(!0,Ia)}catch(ya){b.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",ya.message)}};0<ob?(b.ULS.sendTraceTag(4309020,
500,50,"Waiting to stop connection [{0}]: [{1}] ms.",Za,ob),window.setTimeout(da,ob)):(b.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",Za),da())}qdh(){let Ia=0;0===this.WR.state&&(Ia=this.TWc+cb.yok-(new Date).getTime(),0>Ia&&(Ia=0));return Ia}get connectionState(){return this.tO}s6(Ia){this.Qi.s6(Ia)}baa(Ia){this.Qi.baa(Ia)}ieg(Ia){this.ZSb(0,Ia)}ZSb(Ia,ob){const gb=new e.a;this.Qi.k2f(Ia,ob,gb);return gb.task}b3a(Ia){this.Qi.b3a(Ia)}TVa(Ia){this.Qi.TVa(Ia)}I7b(Ia){this.Qi.I7b(Ia)}cDc(Ia){this.Qi.cDc(Ia)}iEb(Ia){return this.Eki(Ia)}ojc(){return this.UOa(0)}UOa(Ia){const ob=
{};for(let gb of this.vJ)gb.value.Wc(Ia)&&(ob[gb.key]=gb.value.ma(Ia).data);return ob}Eki(Ia){return this.vJ.Wc(Ia)&&this.vJ.ma(Ia).Wc(0)?this.vJ.ma(Ia).ma(0).data:null}ahj(Ia,ob){for(let gb of ob.Zkk)this.vJ.Wc(gb.key)||this.vJ.ga(gb.key,new F.a),Ia=gb.value,this.vJ.ma(gb.key).ga(ob.type,new v(Ia.Presence,new Date(Ia.TimeStamp))),gb.key===this._clientId&&0===ob.type&&this.Qi.Nsj(Ia.Presence)}$gj(Ia,ob){for(const gb of ob.bbd)this.vJ.remove(gb)}v2h(){const Ia=new F.a;if(!this.vJ.Wc(this._clientId))return Ia;
for(let ob of this.vJ.ma(this._clientId))Ia.ga(ob.key,ob.value.data);return Ia}xaa(Ia,ob=null,gb=!1){const Za=new e.a;this.Qi.gTd(Ia,ob,gb,Za);return Za.task}d3a(Ia){this.Qi.d3a(Ia)}jRb(Ia){this.Qi.jRb(Ia)}Ona(Ia){let ob,gb;return({value:ob}=this.vJ.Ve(Ia)).returnValue&&({value:gb}=ob.Ve(0)).returnValue?new r(this.Iki(gb),gb.timeStamp):null}A2h(){const Ia={};for(let ob of this.vJ)ob.value.Ve(0).returnValue&&(Ia[ob.key]=this.Ona(ob.key));return Ia}ulb(Ia){const ob=new e.a;this.Qi.rtj(Ia,ob);return ob.task}get clientId(){return this._clientId}get H2j(){return this.aRg}dispose(){const {FrequentLoggingMetrics:Ia}=
a(790);this.uw||(this.zEa.jy(),this.Ei.uVd(this.Tn),this.Tn.gUd(),Ia.instance&&Ia.instance.PGd(),this.uw=!0)}m6i(Ia,ob){this.Ylb(ob,"StateChangedSignalR")&&this.ZY(this.CRe(Ia.newState),this.CRe(Ia.oldState))}ZY(Ia,ob){var {FrequentLoggingMetrics:gb}=a(790),{ClientToClientMessageTelemetry:Za}=a(1208);if((1!==this.tO||0!==ob||1!==Ia)&&this.tO!==ob){const da=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.tO,
ob,Ia]));b.ULS.sendTraceTag(3290053,500,10,da)}if(this.tO!==Ia){switch(Ia){case 2:gb.instance&&gb.instance.kXi();this.n5=this.WR.id;b.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.n5,this.Lm);this.gVi(this.WR);b.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");gb=null;this.wj&&(gb=this.wj.Le("WebServiceCall","Receive First Presence"));Za=this.snb;this.Qi.atj(Object(c.a)(this,this.Ylb,"verifyConnectionToken"),Za,this.zRc,Object(c.a)(this,this.Bad,
"clearExistingPersistentState"),this.v2h(),gb);this.ig.rtcClientMessageTelemetryEnabled&&(gb=100*Math.random()<=this.ig.xJj,a(1208).ClientToClientMessageTelemetry.Brd(this.Qi,this.ig,gb).start());break;case 1:2===ob&&b.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.n5);break;case 0:if(Za.instance&&Za.instance.stop(),this.zEa.mOa)b.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.n5);else{1===ob&&(b.ULS.sendTraceTag(7672737,
500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.n5),this.Tn.d4f());2===ob&&b.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.n5);this.Mec();return}}this.tO=Ia;this.Qi.jsj(Ia,ob)}}gVi(Ia){if(Ia&&Ia.transport&&Ia.transport.name){Ia=Ia.transport.name;var ob=Ia.toLowerCase();
"websockets"===ob?b.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",Ia,this.Lm):"serversentevents"===ob?b.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",Ia,this.Lm):"foreverframe"===ob?b.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",Ia,this.Lm):"longpolling"===ob?b.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",Ia,this.Lm):"mocktransport"!==ob&&b.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
Ia)}else b.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}Mfj(){if(this.ig.sbg){const Ia=n.a.Tv(this.dTa,"mid");b.ULS.sendTraceTag(3249544,500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.n5,Ia)}else b.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.n5)}Cfj(){b.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.n5)}Dfj(Ia){Ia=a(757).RtcUtils.ceb(Ia);if(this.ig.sbg&&Ia.startsWith("Keep alive timed out.")){const ob=
n.a.Tv(this.dTa,"mid");b.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",Ia,ob)}else this.H2j&&2E3>this.Rve&&!Ia.startsWith("Invok")&&!Ia.startsWith("Trigger")&&(b.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",Ia),this.Rve++)}Bad(){let Ia;const ob=[];({value:Ia}=this.vJ.Ve(this._clientId)).returnValue&&this.vJ.remove(this._clientId);for(let gb of this.vJ.keys)Array.add(ob,gb);for(const gb of ob)this.vJ.remove(gb);Ia&&this.vJ.ga(this._clientId,Ia);this.Qi.Isj(ob)}CRe(Ia){switch(Ia){case 0:return 1;
case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",Ia,"Unknown SignalR state");}}Iki(Ia){return Ia&&Ia.timeStamp?(new Date).getTime()-Ia.timeStamp.getTime()>(this.ig.J7g?6E4:this.ig.I7g)?2:1:1}static createInstance(Ia,ob,gb,Za,da,ya,ib,vb=null,eb=null,Ta=null,La=null,fb=null,Pb=null){return Ka(Ia,ob,gb,Pb,Za,da,ya,ib,vb,eb,Ta,fb,La)}}cb.NGf=31E3;cb.LId=8E3;cb.yok=15E3;Object(w.a)(cb,"RealtimeChannel",null,[376,852])},933:function(w,D,a){a.d(D,"a",function(){return b});
w=a(0);class b{constructor(){this.wwe=!1;this.WZc=null;this.whe=0;this.eTc=this.TUe();this.d_b=this.TUe();this.BHa=this.e0a=0;this.Ly=()=>new Date}get t7j(){return this.wwe}TUe(){const c=Array(6);for(let e=0;e<c.length;e++)c[e]=0;return c}V8h(){return this.eTc.toString()}G5h(){return this.d_b.toString()}x5j(){this.WZc=this.Ly()}eQb(c,e,f=!1){this.t7j||(f&&(this.wwe=!0),f=this.Ly(),0===c&&5<this.e0a||1===c&&5<this.BHa||(this.whe<c?(1===this.e0a%2&&(this.eTc[this.e0a]=-1,this.e0a++),this.whe=c,1===
e&&(this.d_b[this.BHa]=-1,this.BHa++),this.d_b[this.BHa]=this.x6d(f),this.BHa++):0===c?(this.eTc[this.e0a]=this.x6d(f),this.e0a++):(this.d_b[this.BHa]=this.x6d(f),this.BHa++)))}x6d(c){const e=c.getTime()-this.WZc.getTime();this.WZc=c;return e}static get instance(){b.La||(b.La=new b);return b.La}static set instance(c){b.La=c}}b.La=null;Object(w.a)(b,"LatencyMetrics",null,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.cl.js.map/6047c0ee55a7a98c65ad4ca9780c44c7/EwaTS.cl.js.map