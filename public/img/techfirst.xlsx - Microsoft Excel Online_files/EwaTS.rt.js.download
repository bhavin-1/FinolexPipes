'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[46],{1363:function(w,D,a){a.r(D);w=a(0);var b=a(15),c=a(80);class e extends Sys.EventArgs{constructor(){super()}}Object(w.a)(e,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var f;(function(ka){ka[ka.notYetStarted=0]="notYetStarted";ka[ka.polling=1]="polling";ka[ka.subscribed=2]="subscribed";ka[ka.blocked=3]="blocked";ka[ka.permanentlyStopped=4]="permanentlyStopped"})(f||(f={}));Object(w.b)("RtcHostNotificationSubscriptionState",
f);var d=a(114);class h extends Sys.EventArgs{constructor(ka,ja,Da,qa){super();this.OAc=ka;this.newState=ja;this.qpj=Da;this.rpj=qa}}Object(w.a)(h,"StateChangedEventArgs",Sys.EventArgs,[]);var r=a(107);class n{constructor(ka){this.Za=new r.a;this.gwe=new Date;this.Che=ka;this.MSc=0}get currentState(){return this.Che}get n1e(){return this.MSc}event(ka,ja=null){this.currentState!==ka&&(this.TWh(this.currentState,ka,this.n1e,ja),this.MSc=0,this.gwe=new Date);this.Che=ka;this.MSc=this.n1e+1}TWh(ka,ja,
Da,qa){ka=new h(ka,ja,Da,this.gwe,qa);this.Za.raiseEvent("c",ka)}T5c(ka){this.Za.addHandler("c",ka)}c8f(ka){this.Za.removeHandler("c",ka)}}Object(w.a)(n,"StateMachine",null,[160]);class u{constructor(ka,ja,Da,qa,Ba,ua,pa,Ka,$a){this.So=!1;this.s4b=this.t1a=this.nS=this.Oja=null;this.jsb=u.EOc;this.Za=new r.a;this.Kva=new n(0);this.Kva.T5c(Object(c.a)(this,this.Sfj,"onStateMachineChanged"));this.eQg=ka;this.c4b=ja;this.dQg=Da;this.Z_c=qa;this.Uf=Ba;this.eW=ua;pa.execute(ha=>{this.So||(this.t1a=ha,
this.t1a.d3a(Object(c.a)(this,this.Fga,"onUpdateNotificationReceived")),this.start())});Ka.execute(ha=>{this.So||(this.s4b=ha,ha.Ytb(Object(c.a)(this,this.eUa,"onTokenRefreshed")))});this.cxe=$a}get gkb(){return this.Kva.currentState}get Bxf(){return!this.eW||this.eW.Syf}get v9(){return 2===this.gkb&&this.cxe()<this.jsb}start(){0!==this.gkb?b.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",f[this.gkb]):(this.Kva.event(1),this.L_d(null))}L_d(){this.Oja=
null;if(this.Bxf){b.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",f[this.gkb]);let ka=null;this.Z_c&&this.Z_c.length&&(ka={},ka.etts=this.Z_c);this.t1a.xaa(14,ka,!0);this.Tcg(this.eQg)}else this.Kva.event(3)}Tcg(ka){this.Oja=d.a.Scc(1E3*ka,Object(c.a)(this,this.L_d,"sendSubscribeEvent"),this.c4b,192,"RtcHostNotificationSubscribe");this.Uf.Ah(this.Oja)}wLj(ka){ka=1E3*(ka+this.dQg);const ja=this.cxe().getTime()+ka;this.jsb=new Date(ja);ka-=this.c4b;
this.nS?this.Uf.kra(this.nS,ka):(this.nS=d.a.Scc(ka,Object(c.a)(this,this.Vbk,"transitionToPollingEvent"),this.c4b/2,194,"RtcHostNotificationTransitionToPolling"),this.Uf.Ah(this.nS))}Vbk(){this.nS=null;2===this.gkb&&(this.Kva.event(1),b.ULS.shipAssertTag(573100185,502,!!this.Oja,"Missing task to ensure that we re-subscribe."))}eUa(){this.mni()}mni(){3===this.gkb&&this.Bxf&&(this.Kva.event(this.v9?2:1),this.L_d(null))}Fga(ka,ja){if(13===ja.type&&(ka=ja.fba,b.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",
{["SerializableHostNotificationSubscription"]:ka,["DurationBeforeExpirationToResubscribeInSec"]:this.c4b}),ja=ka.cts,!this.kek(ja))){if(ka.sb){var Da=2;this.wLj(ka.cts)}else Da=1,this.jsb=u.EOc,this.nS&&(this.Uf.hr(this.nS),this.nS=null);this.Kva.event(Da);this.Oja?this.Uf.kra(this.Oja,1E3*ja):this.Tcg(ja)}}kek(ka){if(!isNaN(ka)&&isFinite(ka)&&0<ka)return!1;this.hog(!1);return!0}hog(ka){this.Oja&&(this.Uf.hr(this.Oja),this.Oja=null);this.nS&&(this.Uf.hr(this.nS),this.nS=null);this.t1a&&(this.t1a.jRb(Object(c.a)(this,
this.Fga,"onUpdateNotificationReceived")),this.t1a=null);this.s4b&&(this.s4b.ZCc(Object(c.a)(this,this.eUa,"onTokenRefreshed")),this.s4b=null);ka||this.Kva.event(4)}Sfj(ka,ja){ka=ja.newState;const Da=ja.OAc,qa={};qa.NewState=f[ka];qa.PreviousState=f[Da];qa.PreviousStateHits=ja.qpj;qa.PreviousStateTransitionTime=ja.rpj.toISOString();qa.IsSubscribed=this.v9;this.jsb!==u.EOc&&(qa.SubscriptionExpiringTime=this.jsb.toISOString());b.ULS.sendTraceTag(572346515,502,4===ka?15:50,"HostNotificationChanged: {0}",
qa);this.Za.raiseEvent("HN",new e(Da,ka))}dispose(){this.So||(this.So=!0,this.hog(!0),this.nS&&(this.Uf.hr(this.nS),this.nS=null))}}u.EOc=new Date(0);Object(w.a)(u,"RtcHostNotificationSubscriptionManager",null,[637,5]);var v=a(6),x=a(261),k=a(664),m=a(84);class t{constructor(){this.Hz=this.So=!1}get name(){return"RtcHostNotificationSubscription"}Oj(ka){ka.register(u,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").se().Ae(()=>
{const ja=v.AFrameworkApplication.fa;return new u(ja.Af("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),ja.Af("RtcHostNotificationRetryIntervalBufferInSeconds",120),ja.Af("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.Ogi(ja),v.AFrameworkApplication.Lj,k.SessionStatusManager.instance,ka.Ed("Common.IRealtimeChannelBasic"),ka.Ed("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.fa.Xw(()=>{!this.So&&v.AFrameworkApplication.fa.qa("RtcHostNotificationEnabled")&&
(this.Hz=!0,m.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.So||(this.So=!0,this.Hz&&m.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}Ogi(ka){return ka.Mr("RtcEventTypesToSubscribe")?ka.Ox("RtcEventTypesToSubscribe"):null}static main(){x.a.instance.Mk(new t)}}Object(w.a)(t,"RtcHostNotificationSubscriptionPackage",null,[3,4]);var z=a(116),y=a(28);class C{constructor(ka,
ja){this.Oa=ka;this.T0a=ja}Mi(){this.Oa.Pd(y.a.PBf,z.a.frame,Object(c.a)(this,this.QBf,"livePersonaCardActionHandler"))}eXb(){this.Oa.sC(y.a.PBf,z.a.frame,Object(c.a)(this,this.QBf,"livePersonaCardActionHandler"))}QBf(ka,ja,Da,qa,Ba){if(!Ba||3===Da)return 2;if(1===Da)return this.u2a(this.T0a.yLe(Ba.upn||Ba.aadObjectId));if(!this.kHh(Ba))return 8;switch(Ba.action){case 0:return this.u2a(this.T0a.eVg(Ba));case 1:return this.u2a(this.T0a.dVg(Ba));case 2:return this.u2a(this.T0a.fVg(Ba));case 3:return this.u2a(this.T0a.openCard(Ba));
case 4:return this.u2a(this.T0a.vzj(Ba));default:return 2}}kHh(ka){const ja=ka.upn||ka.aadObjectId;return ka.targetElement&&(4===ka.action||ja&&""!==ja)?!0:!1}u2a(ka){return ka?32:8}}Object(w.a)(C,"LivePersonaCardActor",null,[]);var J=a(181),F=a(139);class K{}Object(w.a)(K,"BootstrapperConfig",null,[]);class L{}Object(w.a)(L,"LivePersonaCardInitializerResult",null,[]);class S{}S.fJe=null;Object(w.a)(S,"LivePersonaCardModule",null,[]);var W=a(569);class G{constructor(ka,ja,Da,qa=null){this.ym=new J.a;
this.jOg=ka;this.cNg=ja;this.Pa=Da;this.Pob=qa}init(){this.svf()?this.jOg.oRi().continueWith(Object(c.a)(this,this.Ncj,"onPackageLoaded")):this.ym.setResult(Object.assign(new L,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.ym.task}Ncj(){const ka=S.fJe;if(ka){const ja=this.E3h();try{ka.initializeLivePersonaCardAsync(ja).then(()=>{this.ym.setResult(Object.assign(new L,{isInitialized:!0,isEnabled:!0}))}).catch(Da=>{const qa=Object(F.a)(String,Da);qa?this.ym.setException(Error.create(qa)):
this.ym.setException(Error.create(JSON.stringify(Da)))})}catch(Da){this.ym.setException(Da)}}else this.ym.setResult(Object.assign(new L,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))}E3h(){const ka=W.a.XM(v.AFrameworkApplication.lcid);return Object.assign(new K,{culture:ka?ka.name.toLocaleLowerCase():"en-us",clientType:this.Pa.Ta("LivePersonaCardClientType"),clientContextType:"Generic",clientCorrelationId:v.AFrameworkApplication.userSessionId,
complianceEnvironment:this.D5h(),logMessage:Object(c.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(c.a)(this,this.getAuthToken,"getAuthToken")})}svf(){if(!this.Pa.qa("LivePersonaCardIsEnabled")||!this.G3g())return!1;const ka=this.Pa.Ta("SovereignEnvironmentName");return ka&&""!==ka?ka.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||ka.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}G3g(){return this.Pa.qa("CoauthorGalleryLivePersonaCardIsEnabled")||!!v.AFrameworkApplication.sa&&
v.AFrameworkApplication.sa.Sa.uXa}D5h(){return this.Pa.Ta("LivePersonaCardComplianceEnvironment")}logMessage(ka,ja,Da){ka=JSON.stringify({["Log Type"]:ka,["Log Result Type"]:ja,["Message"]:Da});b.ULS.sendTraceTag(50431106,3006,50,ka)}getAuthToken(ka,ja){v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.Pob.continueWith(Da=>{Da.jj||Da.Gh?ja("LokiTokenManagerTask is either canceled or faulted.",v.AFrameworkApplication.userSessionId):this.Pob.result.drd().then(qa=>
{qa.isSuccess&&qa.token&&qa.token.length?ka(qa.token,v.AFrameworkApplication.userSessionId):ja(qa.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(qa=>b.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(qa)))}):this.cNg.drd().then(Da=>{Da.isSuccess&&Da.token&&Da.token.length?ka(Da.token,v.AFrameworkApplication.userSessionId):ja(Da.errorMessage,v.AFrameworkApplication.userSessionId)}).catch(Da=>b.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",
JSON.stringify(Da)))}}Object(w.a)(G,"LivePersonaCardInitializer",null,[]);class O{}Object(w.a)(O,"Behavior",null,[]);class T{}Object(w.a)(T,"Identifiers",null,[]);class I{}Object(w.a)(I,"LivePersonaCardParameters",null,[]);class N{}Object(w.a)(N,"PersonaInfo",null,[]);class R{constructor(ka){this.iLg=ka}yLe(ka){return this.iLg.svf()&&ka&&""!==ka?!!window.self.LPC:!1}eVg(ka){return this.XWb("addedPersonaToPageV2",ka,0)}dVg(ka){return this.XWb("addedPersonaToPageV2",ka,1)}fVg(ka){return this.XWb("addedPersonaToPageV2",
ka,2)}openCard(ka){return this.XWb("openCard",ka)}vzj(ka){return this.XWb("removedPersonaFromPage",ka)}Sdh(ka){return!!ka.targetElement&&(this.yLe(ka.upn||ka.aadObjectId)||4===ka.action)}XWb(ka,ja,Da=3){if(!this.Sdh(ja))return!1;Da=4!==ja.action?this.csh(ja,Da):null;const qa=window.self.LPC;if(qa&&qa[ka]){if(Da)qa[ka](ja.targetElement,Da);else qa[ka](ja.targetElement);return!0}return!1}csh(ka,ja=3){const Da=Object.assign(new T,{PersonaType:"User",Upn:ka.upn,AadObjectId:ka.aadObjectId});return Object.assign(new I,
{personaInfo:Object.assign(new N,{identifiers:Da,displayName:ka.name,personaCoinColor:ka.color}),behavior:Object.assign(new O,{onCardOpen:()=>{b.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(ka.onCardOpen)ka.onCardOpen()},onCardClose:ka.onCardClose,disableClick:2===ja||3===ja,disableHover:0===ja||3===ja})})}}Object(w.a)(R,"LivePersonaCardManager",null,[]);class V{constructor(ka){this.xQg=ka}oRi(){const ka=v.AFrameworkApplication.SU("midgardbootstrapper.js",5);return this.xQg.oGd(ka).continueWith(()=>
{S.fJe=window.self.MidgardBootstrapper})}}Object(w.a)(V,"LivePersonaCardPackageLoader",null,[896]);var sa=a(530);class U{constructor(){this.Rc=null}get name(){return"Common.App.LivePersonaCard"}init(){v.AFrameworkApplication.fa&&v.AFrameworkApplication.fa.Xw(Object(c.a)(this,this.VD,"onFullAppSettingsReady"))}dispose(){}Oj(ka){this.Rc=ka}VD(){let ka;ka=v.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new G(new V(this.Rc.resolve("Common.ISharedDependencyLoader")),
null,v.AFrameworkApplication.fa,sa.a.Tq(this.Rc.Ed("Common.ILokiTokenManager"))):new G(new V(this.Rc.resolve("Common.ISharedDependencyLoader")),this.Rc.resolve("Common.ILokiTokenManager"),v.AFrameworkApplication.fa);ka.init().continueWith(ja=>{ja.Gh&&ja.exception?b.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",ja.exception.message):((ja=ja.result)||b.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),ja.isInitialized?
b.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):b.ULS.sendTraceTag(595067867,3006,ja.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",ja.failureMessage))});(new C(v.AFrameworkApplication.jd,new R(ka))).Mi()}static main(){x.a.instance.Mk(new U)}}Object(w.a)(U,"LivePersonaCardPackage",null,[3,4]);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");t.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");
Type.registerNamespace("Common.App.LivePersonaCard");U.main();Type.registerNamespace("AppRealtimeChannel")}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaTS.rt.js.map/bf1b96f5d88040d4f00fbaaef9ffb27f/EwaTS.rt.js.map